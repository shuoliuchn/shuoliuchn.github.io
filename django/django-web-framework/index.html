<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="Tu5vqPaUb8svfkPx5eetJFD84ciQCcWVXNatdsWtj9Q">
  <meta name="baidu-site-verification" content="baidu_verify_FBq9PG4BBb">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"sliu.vip","root":"/","scheme":"Mist","version":"7.7.2","exturl":false,"sidebar":{"position":"right","width":240,"display":"hide","padding":12,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"appID":"PXY1Z6GHKT","apiKey":"eb82f2e78e3053f26aa408e9caa96d93","indexName":"blog","hits":{"per_page":10},"labels":{"input_placeholder":"要查点什么(✿◡‿◡)","hits_empty":"没有找到任何关于 ${query} 的结果╥﹏╥...","hits_stats":"搜索到 ${hits} 条记录，用时 ${time} ms o(*￣▽￣*)ブ"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Web 框架的原理，通过亲自搭建 Web 框架的方式进行讨论，由浅到深，由简易到复杂，功能也越来越强大。虽然不足以真的用做 Web 框架，但是对于学习来说，受用很大。">
<meta property="og:type" content="article">
<meta property="og:title" content="动手搭建 Web 框架深入了解 Web 框架的本质">
<meta property="og:url" content="https://sliu.vip/django/django-web-framework/index.html">
<meta property="og:site_name" content="刘硕的技术查阅手册">
<meta property="og:description" content="Web 框架的原理，通过亲自搭建 Web 框架的方式进行讨论，由浅到深，由简易到复杂，功能也越来越强大。虽然不足以真的用做 Web 框架，但是对于学习来说，受用很大。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://sliu.vip/django/django-web-framework/988061-20190217161553642-1455488905.png">
<meta property="og:image" content="https://sliu.vip/django/django-web-framework/988061-20190217161740583-1253868814.png">
<meta property="og:image" content="https://sliu.vip/django/django-web-framework/988061-20190217165555288-1404955543.png">
<meta property="og:image" content="https://sliu.vip/django/django-web-framework/988061-20190217165848448-2082569292.png">
<meta property="og:image" content="https://sliu.vip/django/django-web-framework/988061-20190217171401085-1669271307.png">
<meta property="og:image" content="https://sliu.vip/django/django-web-framework/988061-20190217171827604-1319061425.png">
<meta property="og:image" content="https://sliu.vip/django/django-web-framework/988061-20190217180502464-365178390.png">
<meta property="og:image" content="https://sliu.vip/django/django-web-framework/988061-20190217205314200-934222566.png">
<meta property="og:image" content="https://sliu.vip/django/django-web-framework/988061-20190217210153254-1291193522.png">
<meta property="og:image" content="https://sliu.vip/django/django-web-framework/988061-20190217210402034-1514551154.png">
<meta property="og:image" content="https://sliu.vip/django/django-web-framework/988061-20190217210751685-1433657612.png">
<meta property="og:image" content="https://sliu.vip/django/django-web-framework/988061-20190217211604118-1129260335.png">
<meta property="og:image" content="https://sliu.vip/django/django-web-framework/988061-20190217211533384-439814169.png">
<meta property="og:image" content="https://sliu.vip/django/django-web-framework/988061-20190217212514109-1556720401.png">
<meta property="og:image" content="https://sliu.vip/django/django-web-framework/988061-20190217213105264-177729435.png">
<meta property="og:image" content="https://sliu.vip/django/django-web-framework/988061-20190218175649497-215686790.png">
<meta property="article:published_time" content="2020-03-13T05:53:10.716Z">
<meta property="article:modified_time" content="2020-03-21T05:30:10.989Z">
<meta property="article:author" content="刘硕">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Django">
<meta property="article:tag" content="Web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://sliu.vip/django/django-web-framework/988061-20190217161553642-1455488905.png">

<link rel="canonical" href="https://sliu.vip/django/django-web-framework/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true
  };
</script>

  <title>动手搭建 Web 框架深入了解 Web 框架的本质 | 刘硕的技术查阅手册</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f14f123935d6183fdd06f8f1c4bc378f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="刘硕的技术查阅手册" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">刘硕的技术查阅手册</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">Python 全栈开发学习笔记</h1>
      
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-toc">

    <a href="/toc/" rel="section"><i class="fa fa-fw fa-book"></i>总目录</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-fw fa-heartbeat"></i>公益 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

  
</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/django/django-web-framework/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          动手搭建 Web 框架深入了解 Web 框架的本质
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-13 13:53:10" itemprop="dateCreated datePublished" datetime="2020-03-13T13:53:10+08:00">2020-03-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-21 13:30:10" itemprop="dateModified" datetime="2020-03-21T13:30:10+08:00">2020-03-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Django/" itemprop="url" rel="index"><span itemprop="name">Django</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/django/django-web-framework/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/django/django-web-framework/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>28k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>50 分钟</span>
            </span>
            <div class="post-description">Web 框架的原理，通过亲自搭建 Web 框架的方式进行讨论，由浅到深，由简易到复杂，功能也越来越强大。虽然不足以真的用做 Web 框架，但是对于学习来说，受用很大。</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="Web-框架的本质及自定义-Web-框架"><a href="#Web-框架的本质及自定义-Web-框架" class="headerlink" title="Web 框架的本质及自定义 Web 框架"></a>Web 框架的本质及自定义 Web 框架</h3><p>我们可以这样理解：所有的 Web 应用本质上就是一个 socket 服务端，而用户的浏览器就是一个 socket 客户端，基于请求做出响应。客户都先请求，服务端做出对应的响应，按照 HTTP 协议的请求协议发送请求，服务端按照 HTTP 协议的响应协议来响应请求。依据这样的原理进行网络通信，我们就可以实现自己的 Web 框架了。</p>
<p>通过对 socket 的学习，我们已经知道如何网络通信，我们完全可以自己写了。因为 socket 就是做网络通信用的。下面我们就基于 socket 来自己实现一个 Web 框架。写一个 Web 服务端，让浏览器来请求，并通过自己的服务端把页面返回给浏览器，浏览器渲染出我们想要的效果。在后面的学习中，大家提前准备一些文件：</p>
<p>HTML 文件内容如下，名称为 <code>test.html</code>：　　</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"test.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">href</span>=<span class="string">"wechat.ico"</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!--直接写在html页面里面的css样式是直接可以在浏览器上显示的--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;style&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--h1&#123;--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--background-color: green;--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--color: white;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&#125;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;/style&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>姑娘，你好，我是Jaden，请问约吗？嘻嘻~~<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--直接写在html页面里面的img标签的src属性值如果是别人网站的地址（网络地址）是直接可以在浏览器上显示的--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1550395461724&amp;di=c2b971db12eef5d85aba410d1e2e8568&amp;imgtype=0&amp;src=http%3A%2F%2Fy0.ifengimg.com%2Fifengimcp%2Fpic%2F20140822%2Fd69e0188b714ee789e97_size87_w800_h1227.jpg" alt=""&gt;--&gt;</span> <span class="comment">&lt;!--如果都是网络地址，那么只要你的电脑有网，就可以看到，不需要自己在后端写对应的读取文件，返回图片文件信息的代码，因为别人的网站已经做了这个事情了--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"meinv.png"</span> <span class="attr">alt</span>=<span class="string">""</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">height</span>=<span class="string">"100"</span>&gt;</span> <span class="comment">&lt;!--如果你是本地的图片想要返回给页面，你需要对页面上的关于这个图片的请求要自己做出响应，这个src就是来你本地请求这个图片，你只要将图片信息读取出来，返回给页面，页面拿到这个图片的数据，就能够渲染出来了，是不是很简单--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--直接写在html页面里面的js操作是直接可以在浏览器上显示的--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;script&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--alert('这是我们第一个网页')--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;/script&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"test.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>css文件内容如下，名称为<code>test.css</code>：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: green;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>js文件内容如下，名称为<code>test.js</code> ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="string">'这是我们第一个网页'</span>);</span><br></pre></td></tr></table></figure>

<p>再准备一个图片，名称为 <code>meinv.jpg</code>，再准备一个 ico 文件，名称为 <code>wechat.ico</code>，其实就是个图片文件，微信官网打开之后，在浏览器最上面能够看到<img src="/django/django-web-framework/988061-20190217161553642-1455488905.png" class="" title="988061-20190217161553642-1455488905">，把它保存下来</p>
<p>上面的文件都准备好之后，你用 PyCharm 新建一个项目，把文件都放到一个文件夹里面去，留着备用，像下面这个样子：</p>
<img src="/django/django-web-framework/988061-20190217161740583-1253868814.png" class="" title="988061-20190217161740583-1253868814">





<p>然后开始写我们的 Web 框架，我们分这么几步来写：</p>
<h4 id="一、简单的-Web-框架"><a href="#一、简单的-Web-框架" class="headerlink" title="一、简单的 Web 框架"></a>一、简单的 Web 框架</h4><p>创建一个 Python 文件，内容如下，名称为 <code>test.py</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>,<span class="number">8001</span>))</span><br><span class="line">sk.listen()</span><br><span class="line">conn,addr = sk.accept()</span><br><span class="line">from_b_msg = conn.recv(<span class="number">1024</span>)</span><br><span class="line">str_msg = from_b_msg.decode(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="comment">#socket是应用层和传输层之间的抽象层，每次都有协议，协议就是消息格式，那么传输层的消息格式我们不用管，因为socket帮我们搞定了，但是应用层的协议还是需要咱们自己遵守的，所以再给浏览器发送消息的时候，如果没有按照应用层的消息格式来写，那么你返回给浏览器的信息，浏览器是没法识别的。而应用层的协议就是我们的HTTP协议，所以我们按照HTTP协议规定的消息格式来给浏览器返回消息就没有问题了，关于HTTP我们会细说，首先看一下直接写conn.send(b'hello')的效果，然后运行代码，通过浏览器来访问一下，然后再看这一句conn.send(b'HTTP/1.1 200 ok \r\n\r\nhello')的效果</span></span><br><span class="line"><span class="comment">#下面这句就是按照http协议来写的</span></span><br><span class="line"><span class="comment"># conn.send(b'HTTP/1.1 200 ok \r\n\r\nhello')</span></span><br><span class="line"><span class="comment">#上面这句还可以分成下面两句来写</span></span><br><span class="line">conn.send(<span class="string">b'HTTP/1.1 200 ok \r\n\r\n'</span>)</span><br><span class="line">conn.send(<span class="string">b'hello'</span>)</span><br></pre></td></tr></table></figure>

<p>我们来浏览器上看一下浏览器发送的请求：</p>
<img src="/django/django-web-framework/988061-20190217165555288-1404955543.png" class="" title="988061-20190217165555288-1404955543">

<p>目前我们还没有写如何返回一个 HTML 文件给浏览器，所以这里暂时不用管它。那么我们点开这个 <code>127.0.0.1</code> 看看：</p>
<img src="/django/django-web-framework/988061-20190217165848448-2082569292.png" class="" title="988061-20190217165848448-2082569292">

<p>我们在 Python 文件中打印一下浏览器发送过来的请求信息是啥：</p>
<img src="/django/django-web-framework/988061-20190217171401085-1669271307.png" class="" title="988061-20190217171401085-1669271307">

<p>重启我们的代码，然后在网址中输入这个：</p>
<img src="/django/django-web-framework/988061-20190217171827604-1319061425.png" class="" title="988061-20190217171827604-1319061425">

<p>再重启我们的代码，然后在网址中输入这个：</p>
<img src="/django/django-web-framework/988061-20190217180502464-365178390.png" class="" title="988061-20190217180502464-365178390">



<p>浏览器发过来一堆的消息，我们给浏览器回复（响应）信息的时候，也要按照一个消息格式来写，这些都是 HTTP 协议规定的。要了解 HTTP 协议的更多内容，可以参考 <a href="/django/django-http">HTTP 协议</a>。</p>
<h4 id="二、返回-HTML-文件的-Web-框架"><a href="#二、返回-HTML-文件的-Web-框架" class="headerlink" title="二、返回 HTML 文件的 Web 框架"></a>二、返回 HTML 文件的 Web 框架</h4><p>我们刚刚写过一个名称为 <code>test.html</code> 的 HTML 文件，先把 CSS、JS 和图片相关的注释取消掉，让它们可以直接显示：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"test.css"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--直接写在html页面里面的css样式是直接可以在浏览器上显示的--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        h1&#123;</span><br><span class="line">            background-color: green;</span><br><span class="line">            color: white;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>姑娘，你好，我是Jaden，请问约吗？嘻嘻~~<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--直接写在html页面里面的img标签的src属性值如果是别人网站的地址（网络地址）是直接可以在浏览器上显示的--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1550395461724&amp;di=c2b971db12eef5d85aba410d1e2e8568&amp;imgtype=0&amp;src=http%3A%2F%2Fy0.ifengimg.com%2Fifengimcp%2Fpic%2F20140822%2Fd69e0188b714ee789e97_size87_w800_h1227.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--如果都是网络地址，那么只要你的电脑有网，就可以看到，不需要自己在后端写对应的读取文件，返回图片文件信息的代码，因为别人的网站就做了这个事情了--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--直接写在html页面里面的js操作是直接可以在浏览器上显示的--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    alert(<span class="string">'这是我们第一个网页'</span>)</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>准备我们的 Python 代码，服务端程序，文件内容如下，文件名称为 <code>test.py</code>：　　　　　　　</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>,<span class="number">8001</span>))</span><br><span class="line">sk.listen()</span><br><span class="line">conn,addr = sk.accept()</span><br><span class="line">from_b_msg = conn.recv(<span class="number">1024</span>)</span><br><span class="line">str_msg = from_b_msg.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">print(<span class="string">'浏览器请求信息：'</span>,str_msg)</span><br><span class="line"></span><br><span class="line"><span class="comment"># conn.send(b'HTTP/1.1 200 ok \r\ncontent-type:text/html;charset=utf-8;\r\n') </span></span><br><span class="line">conn.send(<span class="string">b'HTTP/1.1 200 ok \r\n\r\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'test1.html'</span>,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_data = f.read()</span><br><span class="line"><span class="comment"># 将HTML页面返回</span></span><br><span class="line">conn.send(f_data)</span><br></pre></td></tr></table></figure>

<p>页面上输入网址看效果，css 和 js 代码的效果也有，very good：</p>
<img src="/django/django-web-framework/988061-20190217205314200-934222566.png" class="" title="988061-20190217205314200-934222566">

<p>但是我们知道，我们的 css 和 js 基本都是写在本地的文件里面的啊，而且我们的图片基本也是我们自己本地的啊。怎么办？我们将上面我们提前准备好的 js 和 css 还有那个 <code>.ico</code> 结尾的图片文件都准备好，来我们在来一个升级版的 Web 框架。其实 css、js、图片等文件都叫做网站的静态文件。</p>
<p>首先我们先看一个效果，如果我们直接将我们写好的 css 和 js 还有 <code>.ico</code> 和图片文件插入到我们的 HTML 页面里面，就是下面这个 HTML 文件。</p>
<p>名称为 <code>test.html</code>，内容如下：　　　　</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"test.css"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--加上下面这句，那么我们看浏览器调试窗口中的那个network里面就没有那个favicon.ico的请求了，其实这就是页面title标签文字左边的那个页面图标,但是这个文件是我们自己本地的，所以我们需要在后端代码里面将这个文件数据读取出来返回给前端--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">href</span>=<span class="string">"wechat.ico"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--直接写在html页面里面的css样式是直接可以在浏览器上显示的--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;style&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--h1&#123;--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--background-color: green;--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--color: white;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&#125;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;/style&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>姑娘，你好，我是Jaden，请问约吗？嘻嘻~~<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--直接写在html页面里面的img标签的src属性值如果是别人网站的地址（网络地址）是直接可以在浏览器上显示的--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1550395461724&amp;di=c2b971db12eef5d85aba410d1e2e8568&amp;imgtype=0&amp;src=http%3A%2F%2Fy0.ifengimg.com%2Fifengimcp%2Fpic%2F20140822%2Fd69e0188b714ee789e97_size87_w800_h1227.jpg" alt=""&gt;--&gt;</span> <span class="comment">&lt;!--如果都是网络地址，那么只要你的电脑有网，就可以看到，不需要自己在后端写对应的读取文件，返回图片文件信息的代码，因为别人的网站就做了这个事情了--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"meinv.png"</span> <span class="attr">alt</span>=<span class="string">""</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">height</span>=<span class="string">"100"</span>&gt;</span> <span class="comment">&lt;!--如果你是本地的图片想要返回给页面，你需要对页面上的关于这个图片的请求要自己做出响应，这个src就是来你本地请求这个图片，你只要将图片信息读取出来，返回给页面，页面拿到这个图片的数据，就能够渲染出来了，是不是很简单--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--直接写在html页面里面的js操作是直接可以在浏览器上显示的--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;script&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--alert('这是我们第一个网页')--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;/script&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"test.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>同样使用我们之前的 Python 程序，来看效果：</p>
<img src="/django/django-web-framework/988061-20190217210153254-1291193522.png" class="" title="988061-20190217210153254-1291193522">

<p>发现 js 和 css 的效果都没有出来，并且我们看一下浏览器调试窗口的那个 network：</p>
<img src="/django/django-web-framework/988061-20190217210402034-1514551154.png" class="" title="988061-20190217210402034-1514551154">

<p>在下来我们在 network 里面点击那个 <code>test.css</code> 文件，看看请求是什么：</p>
<img src="/django/django-web-framework/988061-20190217210751685-1433657612.png" class="" title="988061-20190217210751685-1433657612">

<p>还有就是当我们直接在浏览器上保存某个页面的时候，随便一个页面，我们到页面上点击右键另存为，然后存到本地的一个目录下，你会发现这个页面的 html、css、js、图片等文件都跟着保存下来了，我保存了一下博客园首页的页面，看，是一个文件夹和一个 HTML 文件：</p>
<img src="/django/django-web-framework/988061-20190217211604118-1129260335.png" class="" title="988061-20190217211604118-1129260335">



<p>我们点开博客园那个文件夹看看里面都有什么：</p>
<img src="/django/django-web-framework/988061-20190217211533384-439814169.png" class="" title="988061-20190217211533384-439814169">

<p>发现 js、css 还有图片什么的都被保存了下来。这说明什么？说明这些文件本身就存在浏览器上了。哦，原来就是将 HTML 页面需要的 css、js、图片等文件也发送给浏览器就可以了。并且这些静态文件都是浏览器单独过来请求的，其实和标签的属性有有关系。css 文件是 link 标签的 href 属性：<code>&lt;link rel=&quot;stylesheet&quot; href=&quot;test.css&quot;&gt;</code>，js 文件是 script 标签的 src 属性：<code>&lt;script src=&quot;test.js&quot;&gt;&lt;/script&gt;</code>，图片文件是 img 标签的 src 属性：<code>&lt;img src=&quot;meinv.png&quot; alt=&quot;&quot; width=&quot;100&quot; height=&quot;100&quot;&gt;</code>，那个 .ico 文件是 link 标签的属性：<code>&lt;link rel=&quot;icon&quot; href=&quot;wechat.ico&quot;&gt;</code>。其实这些属性都会在页面加载的时候，单独到自己对应的属性值里面取请求对应的文件数据。而且我们如果在值里面写的都是自己本地的路径，那么都会来自己的本地路径来找。如果我们写的是相对路径，就会到我们自己的网址 + 文件名称，这个路径来找它需要的文件。所以我们只需要将这些请求做一些响应，将对应的文件数据相应给浏览器就可以了！</p>
<p>并且我们通过前面的查看，能够发现，浏览器 url 的请求路径我们知道是什么，静态文件不是也这样请求的吗，好，我们针对不同的路径给它返回不同的文件，<img src="/django/django-web-framework/988061-20190217212514109-1556720401.png" class="" title="988061-20190217212514109-1556720401">非常好！我们来尝试一下！</p>
<h4 id="三、返回静态文件的高级-Web框架"><a href="#三、返回静态文件的高级-Web框架" class="headerlink" title="三、返回静态文件的高级 Web框架"></a>三、返回静态文件的高级 Web框架</h4><p>还是用第二个 Web 框架里面的那个 HTML 文件，我们只需要写一些我们的服务端程序就可以了。同样是 <code>test.py</code> 文件，内容如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>,<span class="number">8001</span>))</span><br><span class="line">sk.listen()</span><br><span class="line"></span><br><span class="line"><span class="comment">#首先浏览器相当于给我们发送了多个请求，一个是请求我们的html文件，而我们的html文件里面的引入文件的标签又给我们这个网站发送了请求静态文件的请求，所以我们要将建立连接的过程循环起来，才能接受多个请求，没毛病</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    conn,addr = sk.accept()</span><br><span class="line">    from_b_msg = conn.recv(<span class="number">1024</span>)</span><br><span class="line">    str_msg = from_b_msg.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="comment">#通过http协议我们知道，浏览器请求的时候，有一个请求内容的路径，通过对请求信息的分析，这个路径我们在请求的所有请求信息中可以提炼出来，下面的path就是我们提炼出来的路径</span></span><br><span class="line">    path = str_msg.split(<span class="string">'\r\n'</span>)[<span class="number">0</span>].split(<span class="string">' '</span>)[<span class="number">1</span>]</span><br><span class="line">    print(<span class="string">'path&gt;&gt;&gt;'</span>,path)</span><br><span class="line">    conn.send(<span class="string">b'HTTP/1.1 200 ok \r\n\r\n'</span>)</span><br><span class="line">    <span class="comment">#由于整个页面需要html、css、js、图片等一系列的文件，所以我们都需要给人家浏览器发送过去，浏览器才能有这些文件，才能很好的渲染你的页面</span></span><br><span class="line">    <span class="comment">#根据不同的路径来返回响应的内容</span></span><br><span class="line">    <span class="keyword">if</span> path == <span class="string">'/'</span>: <span class="comment">#返回html文件</span></span><br><span class="line">        print(from_b_msg)</span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'test.html'</span>,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># with open('Python开发.html','rb') as f:</span></span><br><span class="line">            data = f.read()</span><br><span class="line">        conn.send(data)</span><br><span class="line">        conn.close()</span><br><span class="line">    <span class="keyword">elif</span> path == <span class="string">'/meinv.png'</span>: <span class="comment">#返回图片</span></span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'meinv.png'</span>,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            pic_data = f.read()</span><br><span class="line">        <span class="comment"># conn.send(b'HTTP/1.1 200 ok \r\n\r\n')</span></span><br><span class="line">        conn.send(pic_data)</span><br><span class="line">        conn.close()</span><br><span class="line">    <span class="keyword">elif</span> path == <span class="string">'/test.css'</span>: <span class="comment">#返回css文件</span></span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'test.css'</span>,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            css_data = f.read()</span><br><span class="line">        conn.send(css_data)</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> path == <span class="string">'/wechat.ico'</span>:<span class="comment">#返回页面的ico图标</span></span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'wechat.ico'</span>,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            ico_data = f.read()</span><br><span class="line">        conn.send(ico_data)</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> path == <span class="string">'/test.js'</span>: <span class="comment">#返回js文件</span></span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'test.js'</span>,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            js_data = f.read()</span><br><span class="line">        conn.send(js_data)</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#注意：上面每一个请求处理完之后，都有一个conn.close()是因为，HTTP协议是短链接的，一次请求对应一次响应，这个请求就结束了，所以我们需要写上close，不然浏览器自己断了，你自己写的服务端没有断，就会出问题。</span></span><br></pre></td></tr></table></figure>

<p>运行起来我们的 py 文件，然后在浏览器访问一下我们的服务端，看效果：</p>
<img src="/django/django-web-framework/988061-20190217213105264-177729435.png" class="" title="988061-20190217213105264-177729435">

<p>666666，完全搞定了。自己通过 socket 已经完全搞定了 web 项目，激动不。哈哈，我们再来完善一下。</p>
<h4 id="四、函数版高级-Web-框架"><a href="#四、函数版高级-Web-框架" class="headerlink" title="四、函数版高级 Web 框架"></a>四、函数版高级 Web 框架</h4><p>HTML 文件和其他的静态文件还是我们上面使用的，我们这次只是用函数把方法封装一下。</p>
<p>Python 代码如下：　</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>,<span class="number">8001</span>))</span><br><span class="line">sk.listen()</span><br><span class="line"></span><br><span class="line"><span class="comment">#处理页面请求的函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">(conn)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'test.html'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># with open('Python开发.html','rb') as f:</span></span><br><span class="line">        data = f.read()</span><br><span class="line">    conn.send(data)</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">#处理页面img标签src属性值是本地路径的时候的请求</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">(conn)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'meinv.png'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        pic_data = f.read()</span><br><span class="line">    <span class="comment"># conn.send(b'HTTP/1.1 200 ok \r\n\r\n')</span></span><br><span class="line">    conn.send(pic_data)</span><br><span class="line">    conn.close()</span><br><span class="line"><span class="comment">#处理页面link（ &lt;link rel="stylesheet" href="test.css"&gt;）标签href属性值是本地路径的时候的请求</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func3</span><span class="params">(conn)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'test.css'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        css_data = f.read()</span><br><span class="line">    conn.send(css_data)</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">#处理页面link（&lt;link rel="icon" href="wechat.ico"&gt;）标签href属性值是本地路径的时候的请求</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func4</span><span class="params">(conn)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'wechat.ico'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        ico_data = f.read()</span><br><span class="line">    conn.send(ico_data)</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">#处理页面script（&lt;script src="test.js"&gt;&lt;/script&gt;）标签src属性值是本地路径的时候的请求</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func5</span><span class="params">(conn)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'test.js'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        js_data = f.read()</span><br><span class="line">    conn.send(js_data)</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    conn,addr = sk.accept()</span><br><span class="line">    <span class="comment"># while 1:</span></span><br><span class="line">    from_b_msg = conn.recv(<span class="number">1024</span>)</span><br><span class="line">    str_msg = from_b_msg.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    path = str_msg.split(<span class="string">'\r\n'</span>)[<span class="number">0</span>].split(<span class="string">' '</span>)[<span class="number">1</span>]</span><br><span class="line">    print(<span class="string">'path&gt;&gt;&gt;'</span>,path)</span><br><span class="line">    conn.send(<span class="string">b'HTTP/1.1 200 ok \r\n\r\n'</span>)</span><br><span class="line">    print(from_b_msg)</span><br><span class="line">    <span class="keyword">if</span> path == <span class="string">'/'</span>:</span><br><span class="line">        func1(conn)</span><br><span class="line">    <span class="keyword">elif</span> path == <span class="string">'/meinv.png'</span>:</span><br><span class="line">        func2(conn)</span><br><span class="line">    <span class="keyword">elif</span> path == <span class="string">'/test.css'</span>:</span><br><span class="line">        func3(conn)</span><br><span class="line">    <span class="keyword">elif</span> path == <span class="string">'/wechat.ico'</span>:</span><br><span class="line">        func4(conn)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> path == <span class="string">'/test.js'</span>:</span><br><span class="line">        func5(conn)</span><br></pre></td></tr></table></figure>

<h4 id="五、更高级版（多线程版）Web-框架"><a href="#五、更高级版（多线程版）Web-框架" class="headerlink" title="五、更高级版（多线程版）Web 框架"></a>五、更高级版（多线程版）Web 框架</h4><p>应用上我们并发编程的内容，反正 HTML 文件和静态文件都直接给浏览器，那大家就一块并发处理。HTML 文件和静态文件还是上面的。</p>
<p>Python 代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="comment"># 注意一点，因为HTTP是无连接的，一次请求完成即断开连接。</span></span><br><span class="line"><span class="comment"># 所以即便有打开多个页面，只要不恰好同时发出请求，不开多线程完全是可以搞定的。</span></span><br><span class="line"><span class="comment"># 在这里只是教大家要有并发编程的思想，所以我使用了多线程</span></span><br><span class="line"></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>,<span class="number">8001</span>))</span><br><span class="line">sk.listen()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">(conn)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'test.html'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    conn.send(data)</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">(conn)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'meinv.png'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        pic_data = f.read()</span><br><span class="line">    <span class="comment"># conn.send(b'HTTP/1.1 200 ok \r\n\r\n')</span></span><br><span class="line">    conn.send(pic_data)</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func3</span><span class="params">(conn)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'test.css'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        css_data = f.read()</span><br><span class="line">    conn.send(css_data)</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func4</span><span class="params">(conn)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'wechat.ico'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        ico_data = f.read()</span><br><span class="line">    conn.send(ico_data)</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func5</span><span class="params">(conn)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'test.js'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        js_data = f.read()</span><br><span class="line">    conn.send(js_data)</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    conn,addr = sk.accept()</span><br><span class="line">    <span class="comment"># while 1:</span></span><br><span class="line">    from_b_msg = conn.recv(<span class="number">1024</span>)</span><br><span class="line">    str_msg = from_b_msg.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    path = str_msg.split(<span class="string">'\r\n'</span>)[<span class="number">0</span>].split(<span class="string">' '</span>)[<span class="number">1</span>]</span><br><span class="line">    print(<span class="string">'path&gt;&gt;&gt;'</span>,path)</span><br><span class="line">    conn.send(<span class="string">b'HTTP/1.1 200 ok \r\n\r\n'</span>)</span><br><span class="line">    print(from_b_msg)</span><br><span class="line">    <span class="keyword">if</span> path == <span class="string">'/'</span>:</span><br><span class="line">        <span class="comment"># func1(conn)</span></span><br><span class="line">        t = Thread(target=func1,args=(conn,))</span><br><span class="line">        t.start()</span><br><span class="line">    <span class="keyword">elif</span> path == <span class="string">'/meinv.png'</span>:</span><br><span class="line">        <span class="comment"># func2(conn)</span></span><br><span class="line">        t = Thread(target=func2, args=(conn,))</span><br><span class="line">        t.start()</span><br><span class="line">    <span class="keyword">elif</span> path == <span class="string">'/test.css'</span>:</span><br><span class="line">        <span class="comment"># func3(conn)</span></span><br><span class="line">        t = Thread(target=func3, args=(conn,))</span><br><span class="line">        t.start()</span><br><span class="line">    <span class="keyword">elif</span> path == <span class="string">'/wechat.ico'</span>:</span><br><span class="line">        <span class="comment"># func4(conn)</span></span><br><span class="line">        t = Thread(target=func4, args=(conn,))</span><br><span class="line">        t.start()</span><br><span class="line">    <span class="keyword">elif</span> path == <span class="string">'/test.js'</span>:</span><br><span class="line">        <span class="comment"># func5(conn)</span></span><br><span class="line">        t = Thread(target=func5, args=(conn,))</span><br><span class="line">        t.start()</span><br></pre></td></tr></table></figure>

<h4 id="六、更更高级版-Web-框架"><a href="#六、更更高级版-Web-框架" class="headerlink" title="六、更更高级版 Web 框架"></a>六、更更高级版 Web 框架</h4><p>if 判断太多了，开线程的方式也比较恶心，有多少个if判断，就写多少次创建线程，简化一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>,<span class="number">8001</span>))</span><br><span class="line">sk.listen()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">(conn)</span>:</span></span><br><span class="line"></span><br><span class="line">    conn.send(<span class="string">b'HTTP/1.1 200 ok\r\ncontent-type:text/html\r\ncharset:utf-8\r\n\r\n'</span>)</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'test.html'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># with open('Python开发.html','rb') as f:</span></span><br><span class="line">        data = f.read()</span><br><span class="line">    conn.send(data)</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">(conn)</span>:</span></span><br><span class="line">    conn.send(<span class="string">b'HTTP/1.1 200 ok\r\n\r\n'</span>)</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'meinv.png'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        pic_data = f.read()</span><br><span class="line">    <span class="comment"># conn.send(b'HTTP/1.1 200 ok \r\n\r\n')</span></span><br><span class="line">    conn.send(pic_data)</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func3</span><span class="params">(conn)</span>:</span></span><br><span class="line">    conn.send(<span class="string">b'HTTP/1.1 200 ok\r\n\r\n'</span>)</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'test.css'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        css_data = f.read()</span><br><span class="line">    conn.send(css_data)</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func4</span><span class="params">(conn)</span>:</span></span><br><span class="line">    conn.send(<span class="string">b'HTTP/1.1 200 ok\r\n\r\n'</span>)</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'wechat.ico'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        ico_data = f.read()</span><br><span class="line">    conn.send(ico_data)</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func5</span><span class="params">(conn)</span>:</span></span><br><span class="line">    conn.send(<span class="string">b'HTTP/1.1 200 ok\r\n\r\n'</span>)</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'test.js'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        js_data = f.read()</span><br><span class="line">    conn.send(js_data)</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义一个路径和执行函数的对应关系，不再写一堆的if判断了</span></span><br><span class="line">l1 = [</span><br><span class="line">    (<span class="string">'/'</span>,func1),</span><br><span class="line">    (<span class="string">'/meinv.png'</span>,func2),</span><br><span class="line">    (<span class="string">'/test.css'</span>,func3),</span><br><span class="line">    (<span class="string">'/wechat.ico'</span>,func4),</span><br><span class="line">    (<span class="string">'/test.js'</span>,func5),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">#遍历路径和函数的对应关系列表，并开多线程高效的去执行路径对应的函数，</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">(path,conn)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> l1:</span><br><span class="line">        <span class="keyword">if</span> i[<span class="number">0</span>] == path:</span><br><span class="line">            t = Thread(target=i[<span class="number">1</span>],args=(conn,))</span><br><span class="line">            t.start()</span><br><span class="line">    <span class="comment"># else:</span></span><br><span class="line">    <span class="comment">#     conn.send(b'sorry')</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    conn,addr = sk.accept()</span><br><span class="line">    <span class="comment">#看完这里面的代码之后，你就可以思考一个问题了，很多人要同时访问你的网站，你在请求这里是不是可以开起并发编程的思想了，多进程+多线程+协程，妥妥的支持高并发，再配合服务器集群，这个网页就支持大量的高并发了，有没有很激动，哈哈，但是咱们写的太low了，而且功能很差，容错能力也很差，当然了，如果你有能力，你现在完全可以自己写web框架了，写一个nb的，如果现在没有这个能力，那么我们就来好好学学别人写好的框架把，首先第一个就是咱们的django框架了，其实就是将这些功能封装起来，并且容错能力强，抗压能力强，总之一个字：吊。</span></span><br><span class="line">    from_b_msg = conn.recv(<span class="number">1024</span>)</span><br><span class="line">    str_msg = from_b_msg.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    path = str_msg.split(<span class="string">'\r\n'</span>)[<span class="number">0</span>].split(<span class="string">' '</span>)[<span class="number">1</span>]</span><br><span class="line">    print(<span class="string">'path&gt;&gt;&gt;'</span>,path)</span><br><span class="line">    <span class="comment"># 注意：因为开启的线程很快，可能导致你的文件还没有发送过去，其他文件的请求已经来了，导致你文件信息没有被浏览器正确的认识，所以需要将发送请求行和请求头的部分写道前面的每一个函数里面去，并且防止出现浏览器可能不能识别你的html文件的情况，需要在发送html文件的那个函数里面的发送请求行和请求头的部分加上两个请求头content-type:text/html\r\ncharset:utf-8\r\n</span></span><br><span class="line">    <span class="comment"># conn.send(b'HTTP/1.1 200 ok\r\n\r\n')  不这样写了</span></span><br><span class="line">    <span class="comment"># conn.send(b'HTTP/1.1 200 ok\r\ncontent-type:text/html\r\ncharset:utf-8\r\n\r\n')  不这样写了</span></span><br><span class="line">    print(from_b_msg)</span><br><span class="line">    <span class="comment">#执行这个fun函数并将路径和conn管道都作为参数传给他</span></span><br><span class="line">    fun(path,conn)</span><br></pre></td></tr></table></figure>



<h4 id="七、根据不同路径返回不同页面的-Web-框架"><a href="#七、根据不同路径返回不同页面的-Web-框架" class="headerlink" title="七、根据不同路径返回不同页面的 Web 框架"></a>七、根据不同路径返回不同页面的 Web 框架</h4><p>既然知道了我们可以根据不同的请求路径来返回不同的内容，那么我们可不可以根据用户访问的不同路径，返回不同的页面啊，嗯，应该是可以的。</p>
<p>自己创建两个 HTML 文件，写几个标签在里面，名为 <code>index.html</code> 和 <code>home.html</code>。然后根据不同的路径返回不同的页面，我就给大家写上 Python 代码吧：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">根据URL中不同的路径返回不同的内容</span></span><br><span class="line"><span class="string">返回独立的HTML页面</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">"127.0.0.1"</span>, <span class="number">8080</span>))  <span class="comment"># 绑定IP和端口</span></span><br><span class="line">sk.listen()  <span class="comment"># 监听</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将返回不同的内容部分封装成函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="comment"># 读取index.html页面的内容</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"index.html"</span>, <span class="string">"r"</span>, encoding=<span class="string">"utf8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        s = f.read()</span><br><span class="line">    <span class="comment"># 返回字节数据</span></span><br><span class="line">    <span class="keyword">return</span> bytes(s, encoding=<span class="string">"utf8"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"home.html"</span>, <span class="string">"r"</span>, encoding=<span class="string">"utf8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        s = f.read()</span><br><span class="line">    <span class="keyword">return</span> bytes(s, encoding=<span class="string">"utf8"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个url和实际要执行的函数的对应关系</span></span><br><span class="line">list1 = [</span><br><span class="line">    (<span class="string">"/index/"</span>, index),</span><br><span class="line">    (<span class="string">"/home/"</span>, home),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="comment"># 等待连接</span></span><br><span class="line">    conn, add = sk.accept()</span><br><span class="line">    data = conn.recv(<span class="number">8096</span>)  <span class="comment"># 接收客户端发来的消息</span></span><br><span class="line">    <span class="comment"># 从data中取到路径</span></span><br><span class="line">    data = str(data, encoding=<span class="string">"utf8"</span>)  <span class="comment"># 把收到的字节类型的数据转换成字符串</span></span><br><span class="line">    <span class="comment"># 按\r\n分割</span></span><br><span class="line">    data1 = data.split(<span class="string">"\r\n"</span>)[<span class="number">0</span>]</span><br><span class="line">    url = data1.split()[<span class="number">1</span>]  <span class="comment"># url是我们从浏览器发过来的消息中分离出的访问路径</span></span><br><span class="line">    conn.send(<span class="string">b'HTTP/1.1 200 OK\r\n\r\n'</span>)  <span class="comment"># 因为要遵循HTTP协议，所以回复的消息也要加状态行</span></span><br><span class="line">    <span class="comment"># 根据不同的路径返回不同内容</span></span><br><span class="line">    func = <span class="literal">None</span>  <span class="comment"># 定义一个保存将要执行的函数名的变量</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> list1:</span><br><span class="line">        <span class="keyword">if</span> i[<span class="number">0</span>] == url:</span><br><span class="line">            func = i[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> func:</span><br><span class="line">        response = func(url)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        response = <span class="string">b"404 not found!"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 返回具体的响应消息</span></span><br><span class="line">    conn.send(response)</span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>



<h4 id="八、返回动态页面的-Web-框架"><a href="#八、返回动态页面的-Web-框架" class="headerlink" title="八、返回动态页面的 Web 框架"></a>八、返回动态页面的 Web 框架</h4><p>这网页能够显示出来了，但是都是静态的啊。页面的内容都不会变化的，我想要的是动态网站，动态网站的意思是里面有动态变化的数据，而不是页面里面有动态效果，这个大家要注意啊。</p>
<p>没问题，我也有办法解决。我选择使用字符串替换来实现这个需求。（这里使用时间戳来模拟动态的数据，还是只给大家 Python 代码吧）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">根据URL中不同的路径返回不同的内容</span></span><br><span class="line"><span class="string">返回HTML页面</span></span><br><span class="line"><span class="string">让网页动态起来</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">"127.0.0.1"</span>, <span class="number">8080</span>))  <span class="comment"># 绑定IP和端口</span></span><br><span class="line">sk.listen()  <span class="comment"># 监听</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将返回不同的内容部分封装成函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"index.html"</span>, <span class="string">"r"</span>, encoding=<span class="string">"utf8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        s = f.read()</span><br><span class="line">        now = str(time.time())</span><br><span class="line">        s = s.replace(<span class="string">"@@oo@@"</span>, now)  <span class="comment"># 在网页中定义好特殊符号，用动态的数据去替换提前定义好的特殊符号</span></span><br><span class="line">    <span class="keyword">return</span> bytes(s, encoding=<span class="string">"utf8"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"home.html"</span>, <span class="string">"r"</span>, encoding=<span class="string">"utf8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        s = f.read()</span><br><span class="line">    <span class="keyword">return</span> bytes(s, encoding=<span class="string">"utf8"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个url和实际要执行的函数的对应关系</span></span><br><span class="line">list1 = [</span><br><span class="line">    (<span class="string">"/index/"</span>, index),</span><br><span class="line">    (<span class="string">"/home/"</span>, home),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="comment"># 等待连接</span></span><br><span class="line">    conn, add = sk.accept()</span><br><span class="line">    data = conn.recv(<span class="number">8096</span>)  <span class="comment"># 接收客户端发来的消息</span></span><br><span class="line">    <span class="comment"># 从data中取到路径</span></span><br><span class="line">    data = str(data, encoding=<span class="string">"utf8"</span>)  <span class="comment"># 把收到的字节类型的数据转换成字符串</span></span><br><span class="line">    <span class="comment"># 按\r\n分割</span></span><br><span class="line">    data1 = data.split(<span class="string">"\r\n"</span>)[<span class="number">0</span>]</span><br><span class="line">    url = data1.split()[<span class="number">1</span>]  <span class="comment"># url是我们从浏览器发过来的消息中分离出的访问路径</span></span><br><span class="line">    conn.send(<span class="string">b'HTTP/1.1 200 OK\r\n\r\n'</span>)  <span class="comment"># 因为要遵循HTTP协议，所以回复的消息也要加状态行</span></span><br><span class="line">    <span class="comment"># 根据不同的路径返回不同内容</span></span><br><span class="line">    func = <span class="literal">None</span>  <span class="comment"># 定义一个保存将要执行的函数名的变量</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> list1:</span><br><span class="line">        <span class="keyword">if</span> i[<span class="number">0</span>] == url:</span><br><span class="line">            func = i[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> func:</span><br><span class="line">        response = func(url)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        response = <span class="string">b"404 not found!"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 返回具体的响应消息</span></span><br><span class="line">    conn.send(response)</span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>

<p>这八个框架让大家满意了吧，这下子明白整个 Web 框架的原理了吧，哈哈。但是我们写的框架还是太 low 了，不够强壮。那别人已经开发好了很多nb的框架了，如：Django、Flask、Tornado 等等，我们学学怎么用就可以啦。但是注意一个问题，我们在里面获取路径的时候，是按照 <code>\r\n</code> 来分割然后再通过空格来分割获取到的路径。但是如果不是 HTTP 协议的话，你自己要注意消息格式了。</p>
<p>接下来我们看一个别人写好的模块来搞的 Web 框架，这个模块叫做 wsgiref。</p>
<h4 id="九、wsgiref-模块版-Web-框架"><a href="#九、wsgiref-模块版-Web-框架" class="headerlink" title="九、wsgiref 模块版 Web 框架"></a>九、wsgiref 模块版 Web 框架</h4><p>wsgiref 模块其实就是将整个请求信息给封装了起来，不需要你自己处理了。假如它将所有请求信息封装成了一个叫做 request 的对象，那么你直接 <code>request.path</code> 就能获取到用户这次请求的路径，<code>request.method</code> 就能获取到本次用户请求的请求方式（get 还是 post）等。那这个模块用起来，我们再写 Web 框架是不是就简单了好多啊。</p>
<p>对于真实开发中的 Python Web 程序来说，一般会分为两部分：服务器程序和应用程序。</p>
<p>服务器程序负责对 socket 服务器进行封装，并在请求到来时，对请求的各种数据进行整理。</p>
<p>应用程序则负责具体的逻辑处理。为了方便应用程序的开发，就出现了众多的 Web 框架，例如：Django、Flask、<code>web.py</code> 等。不同的框架有不同的开发方式，但是无论如何，开发出的应用程序都要和服务器程序配合，才能为用户提供服务。</p>
<p>这样，服务器程序就需要为不同的框架提供不同的支持。这样混乱的局面无论对于服务器还是框架，都是不好的。对服务器来说，需要支持各种不同框架，对框架来说，只有支持它的服务器才能被开发出的应用使用。最简单的 Web 应用就是先把 HTML 用文件保存好，用一个现成的 HTTP 服务器软件，接收用户请求，从文件中读取HTML，返回。如果要动态生成 HTML，就需要把上述步骤自己来实现。不过，接受 HTTP 请求、解析 HTTP 请求、发送 HTTP 响应都是苦力活，如果我们自己来写这些底层代码，还没开始写动态 HTML 呢，就得花个把月去读 HTTP 规范。</p>
<p>正确的做法是底层代码由专门的服务器软件实现，我们用 Python 专注于生成 HTML 文档。因为我们不希望接触到 TCP 连接、HTTP 原始请求和响应格式。所以，需要一个统一的接口协议来实现这样的服务器软件，让我们专心用 Python 编写 Web 业务。</p>
<p>这时候，标准化就变得尤为重要。我们可以设立一个标准，只要服务器程序支持这个标准，框架也支持这个标准，那么他们就可以配合使用。一旦标准确定，双方各自实现。这样，服务器可以支持更多支持标准的框架，框架也可以使用更多支持标准的服务器。</p>
<p>WSGI（Web Server Gateway Interface）就是一种规范，它定义了使用 Python 编写的 Web 应用程序与 Web 服务器程序之间的接口格式，实现 Web 应用程序与 Web 服务器程序间的解耦。</p>
<p>常用的 WSGI 服务器有 uwsgi、Gunicorn。而 Python 标准库提供的独立 WSGI 服务器叫 wsgiref。Django 开发环境用的就是这个模块来做服务器。</p>
<p>好，接下来我们就看一下（能理解就行，了解就可以了）：先看看 wsfiref 怎么使用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"><span class="comment"># wsgiref本身就是个web框架，提供了一些固定的功能（请求和响应信息的封装，不需要我们自己写原生的socket了也不需要咱们自己来完成请求信息的提取了，提取起来很方便）</span></span><br><span class="line"><span class="comment">#函数名字随便起</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">application</span><span class="params">(environ, start_response)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    :param environ: 是全部加工好的请求信息，加工成了一个字典，通过字典取值的方式就能拿到很多你想要拿到的信息</span></span><br><span class="line"><span class="string">    :param start_response: 帮你封装响应信息的（响应行和响应头），注意下面的参数</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    start_response(<span class="string">'200 OK'</span>, [(<span class="string">'k1'</span>,<span class="string">'v1'</span>),])</span><br><span class="line">    print(environ)</span><br><span class="line">    print(environ[<span class="string">'PATH_INFO'</span>])  <span class="comment">#输入地址127.0.0.1:8000，这个打印的是'/',输入的是127.0.0.1:8000/index，打印结果是'/index'</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="string">b'&lt;h1&gt;Hello, web!&lt;/h1&gt;'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#和咱们学的socketserver那个模块很像啊</span></span><br><span class="line">httpd = make_server(<span class="string">'127.0.0.1'</span>, <span class="number">8080</span>, application)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Serving HTTP on port 8080...'</span>)</span><br><span class="line"><span class="comment"># 开始监听HTTP请求:</span></span><br><span class="line">httpd.serve_forever()</span><br></pre></td></tr></table></figure>

<p>来一个完整的 Web 项目，用户登录认证的项目。我们需要连接数据库了，所以先到 MySQL 数据库里面准备一些表和数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database db1;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use db1;</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; create table userinfo(id int primary key auto_increment,username char(20) not null unique,password char(20) not null);</span><br><span class="line">Query OK, 0 rows affected (0.23 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into userinfo(username,password) values(&#39;chao&#39;,&#39;666&#39;),(&#39;sb1&#39;,&#39;222&#39;);</span><br><span class="line">Query OK, 2 rows affected (0.03 sec)</span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from userinfo;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | chao     | 666      |</span><br><span class="line">|  2 | sb1      | 222      |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>然后再创建这么几个文件：</p>
<p>Python 文件名称 <code>webmodel.py</code>，内容如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建表，插入数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">createtable</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">import</span> pymysql</span><br><span class="line">    conn = pymysql.connect(</span><br><span class="line">        host=<span class="string">'127.0.0.1'</span>,</span><br><span class="line">        port=<span class="number">3306</span>,</span><br><span class="line">        user=<span class="string">'root'</span>,</span><br><span class="line">        password=<span class="string">'666'</span>,</span><br><span class="line">        database=<span class="string">'db1'</span>,</span><br><span class="line">        charset=<span class="string">'utf8'</span></span><br><span class="line">    )</span><br><span class="line">    cursor = conn.cursor(pymysql.cursors.DictCursor)</span><br><span class="line">    sql = <span class="string">'''</span></span><br><span class="line"><span class="string">        -- 创建表</span></span><br><span class="line"><span class="string">        create table userinfo(id int primary key auto_increment,username char(20) not null unique,password char(20) not null);</span></span><br><span class="line"><span class="string">        -- 插入数据</span></span><br><span class="line"><span class="string">        insert into userinfo(username,password) values('chao','666'),('sb1','222');</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    conn.commit()</span><br><span class="line">    cursor.close()</span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>

<p>Python 的名为 <code>webauth.py</code> 文件，内容如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#对用户名和密码进行验证</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth</span><span class="params">(username,password)</span>:</span></span><br><span class="line">    <span class="keyword">import</span> pymysql</span><br><span class="line">    conn = pymysql.connect(</span><br><span class="line">        host=<span class="string">'127.0.0.1'</span>,</span><br><span class="line">        port=<span class="number">3306</span>,</span><br><span class="line">        user=<span class="string">'root'</span>,</span><br><span class="line">        password=<span class="string">'123'</span>,</span><br><span class="line">        database=<span class="string">'db1'</span>,</span><br><span class="line">        charset=<span class="string">'utf8'</span></span><br><span class="line">    )</span><br><span class="line">    print(<span class="string">'userinfo'</span>,username,password)</span><br><span class="line">    cursor = conn.cursor(pymysql.cursors.DictCursor)</span><br><span class="line">    sql = <span class="string">'select * from userinfo where username=%s and password=%s;'</span></span><br><span class="line">    res = cursor.execute(sql, [username, password])</span><br><span class="line">    <span class="keyword">if</span> res:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>用户输入用户名和密码的文件，名为 <code>web.html</code>，内容如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--如果form表单里面的action什么值也没给，默认是往当前页面的url上提交你的数据，所以我们可以自己指定数据的提交路径--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;form action="http://127.0.0.1:8080/auth/" method="post"&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://127.0.0.1:8080/auth/"</span> <span class="attr">method</span>=<span class="string">"get"</span>&gt;</span></span><br><span class="line">    用户名<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">    密码 <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>用户验证成功后跳转的页面，显示成功，名为 <code>websuccess.html</code>，内容如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        h1&#123;</span><br><span class="line"><span class="css">            <span class="selector-tag">color</span><span class="selector-pseudo">:red</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>宝贝儿，恭喜你登陆成功啦<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Python 服务端代码（主逻辑代码），名为 <code>web_python.py</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> parse_qs</span><br><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"><span class="keyword">import</span> webauth</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">application</span><span class="params">(environ, start_response)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># start_response('200 OK', [('Content-Type', 'text/html'),('k1','v1')])</span></span><br><span class="line">    <span class="comment"># start_response('200 OK', [('Content-Type', 'text/html'),('charset','utf-8')])</span></span><br><span class="line">    start_response(<span class="string">'200 OK'</span>, [(<span class="string">'Content-Type'</span>, <span class="string">'text/html'</span>)])</span><br><span class="line">    print(environ)</span><br><span class="line">    print(environ[<span class="string">'PATH_INFO'</span>])</span><br><span class="line">    path = environ[<span class="string">'PATH_INFO'</span>]</span><br><span class="line">    <span class="comment">#用户获取login页面的请求路径</span></span><br><span class="line">    <span class="keyword">if</span> path == <span class="string">'/login'</span>:</span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'web.html'</span>,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            data = f.read()</span><br><span class="line">    <span class="comment">#针对form表单提交的auth路径，进行对应的逻辑处理</span></span><br><span class="line">    <span class="keyword">elif</span> path == <span class="string">'/auth/'</span>:</span><br><span class="line">        <span class="comment">#登陆认证</span></span><br><span class="line">        <span class="comment">#1.获取用户输入的用户名和密码</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#2.去数据库做数据的校验，查看用户提交的是否合法</span></span><br><span class="line">        <span class="comment"># user_information = environ['']</span></span><br><span class="line">        <span class="keyword">if</span> environ.get(<span class="string">"REQUEST_METHOD"</span>) == <span class="string">"POST"</span>:</span><br><span class="line">            <span class="comment">#获取请求体数据的长度,因为提交过来的数据需要用它来提取,注意POST请求和GET请求的获取数据的方式不同</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                request_body_size = int(environ.get(<span class="string">'CONTENT_LENGTH'</span>, <span class="number">0</span>))</span><br><span class="line">            <span class="keyword">except</span> (ValueError):</span><br><span class="line">                request_body_size = <span class="number">0</span></span><br><span class="line">            <span class="comment">#POST请求获取数据的方式</span></span><br><span class="line">            request_data = environ[<span class="string">'wsgi.input'</span>].read(request_body_size)</span><br><span class="line">            print(<span class="string">'&gt;&gt;&gt;&gt;&gt;'</span>,request_data) <span class="comment"># &gt;&gt;&gt;&gt;&gt; b'username=chao&amp;password=123'，是个bytes类型数据</span></span><br><span class="line">            print(<span class="string">'?????'</span>,environ[<span class="string">'QUERY_STRING'</span>]) <span class="comment">#????? 空的，因为post请求只能按照上面这种方式取数据</span></span><br><span class="line">            <span class="comment">#parse_qs可以帮我们解析数据</span></span><br><span class="line">            re_data = parse_qs(request_data)</span><br><span class="line">            print(<span class="string">'拆解后的数据'</span>,re_data) <span class="comment">#拆解后的数据 &#123;b'password': [b'123'], b'username': [b'chao']&#125;</span></span><br><span class="line">            <span class="comment">#post请求的返回数据我就不写啦</span></span><br><span class="line">　　　　　　  <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> environ.get(<span class="string">"REQUEST_METHOD"</span>) == <span class="string">"GET"</span>:</span><br><span class="line">            <span class="comment">#GET请求获取数据的方式，只能按照这种方式取</span></span><br><span class="line">            print(<span class="string">'?????'</span>,environ[<span class="string">'QUERY_STRING'</span>]) <span class="comment">#????? username=chao&amp;password=123,是个字符串类型数据</span></span><br><span class="line">            request_data = environ[<span class="string">'QUERY_STRING'</span>]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># parse_qs可以帮我们解析数据</span></span><br><span class="line">            re_data = parse_qs(request_data)</span><br><span class="line">            print(<span class="string">'拆解后的数据'</span>, re_data) <span class="comment">#拆解后的数据 &#123;'password': ['123'], 'username': ['chao']&#125;</span></span><br><span class="line">            username = re_data[<span class="string">'username'</span>][<span class="number">0</span>]</span><br><span class="line">            password = re_data[<span class="string">'password'</span>][<span class="number">0</span>]</span><br><span class="line">            print(username,password)</span><br><span class="line">            <span class="comment">#进行验证：</span></span><br><span class="line">            status = webauth.auth(username,password)</span><br><span class="line">            <span class="keyword">if</span> status:</span><br><span class="line">            <span class="comment"># 3.将相应内容返回</span></span><br><span class="line">                <span class="keyword">with</span> open(<span class="string">'websuccess.html'</span>,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    data = f.read()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                data = <span class="string">b'auth error'</span></span><br><span class="line">        <span class="comment"># 但是不管是post还是get请求都不能直接拿到数据，拿到的数据还需要我们来进行分解提取，所以我们引入urllib模块来帮我们分解</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">#注意昂，我们如果直接返回中文，没有给浏览器指定编码格式，默认是gbk，所以我们需要gbk来编码一下，浏览器才能识别</span></span><br><span class="line">        <span class="comment"># data='登陆成功！'.encode('gbk')</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        data = <span class="string">b'sorry 404!,not found the page'</span></span><br><span class="line">    <span class="keyword">return</span> [data]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#和咱们学的socketserver那个模块很像啊</span></span><br><span class="line">httpd = make_server(<span class="string">'127.0.0.1'</span>, <span class="number">8080</span>, application)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Serving HTTP on port 8080...'</span>)</span><br><span class="line"><span class="comment"># 开始监听HTTP请求:</span></span><br><span class="line">httpd.serve_forever()</span><br></pre></td></tr></table></figure>

<p>把代码拷走，创建文件，放到同一个目录下，运行一下 <code>we_python.py</code> 文件的代码就能看到效果。注意先输入的网址是 <code>127.0.0.1:8080/login</code> ，还要注意你的 MySQL 数据库没有问题。</p>
<img src="/django/django-web-framework/988061-20190218175649497-215686790.png" class="" title="988061-20190218175649497-215686790">



<h4 id="十、起飞版-Web-框架"><a href="#十、起飞版-Web-框架" class="headerlink" title="十、起飞版 Web 框架"></a>十、起飞版 Web 框架</h4><p>我们上一个 Web 框架把所有的代码都写在了一个 py 文件中，我们拆到其他文件里面去，并且针对不用的路径来进行分发请求的时候都用的if判断，很多值得优化的地方，好，结合我们前面几个版本的优势我们来优化一下，分几个文件和文件夹。</p>
<p>文件的目录结构为：</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">web_framework/</span><br><span class="line">   ├── templates/    <span class="meta"># 用于存放 HTML 文档</span></span><br><span class="line">   <span class="string">|       ├── index.html/</span></span><br><span class="line">   <span class="string">|       ├── web.html/</span></span><br><span class="line">   <span class="string">|       ├── websuccess.html/</span></span><br><span class="line">   ├── manage.py/    <span class="meta"># 主应用</span></span><br><span class="line">   ├── model.py/    <span class="meta"># 数据库相关操作</span></span><br><span class="line">   ├── urls.py/    <span class="meta"># </span></span><br><span class="line">   ├── views.py/</span><br><span class="line">   └── webauth.py/</span><br></pre></td></tr></table></figure>

<p>首先是三个 HTML 文件。</p>
<p><code>index.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--看一下百度的登陆--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://127.0.0.1:8080/login"</span>&gt;</span>请登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>web.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;form action="http://127.0.0.1:8080/auth/" method="post"&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://127.0.0.1:8080/auth/"</span> <span class="attr">method</span>=<span class="string">"get"</span>&gt;</span></span><br><span class="line">    用户名<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">    密码 <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>websuccess.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        h1&#123;</span><br><span class="line"><span class="css">            <span class="selector-tag">color</span><span class="selector-pseudo">:red</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>宝贝儿，恭喜你登陆成功啦<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后就是整个框架的入口，<code>manage.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urls <span class="keyword">import</span> urlpatterns</span><br><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#这个文件里面是框架的主体内容</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">application</span><span class="params">(environ, start_response)</span>:</span></span><br><span class="line">    start_response(<span class="string">'200 OK'</span>, [(<span class="string">'Content-Type'</span>, <span class="string">'text/html'</span>)])</span><br><span class="line">    path = environ[<span class="string">'PATH_INFO'</span>]</span><br><span class="line">    <span class="keyword">for</span> url_tuple <span class="keyword">in</span> urlpatterns:</span><br><span class="line">        <span class="keyword">if</span> url_tuple[<span class="number">0</span>] == path:</span><br><span class="line">            data = url_tuple[<span class="number">1</span>](environ) <span class="comment">#environ要传进去，因为处理逻辑里面可能要用</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data = <span class="string">b'sorry 404!,not found the page'</span></span><br><span class="line">    <span class="keyword">return</span> [data]</span><br><span class="line">        <span class="comment">#注意昂，我们如果直接返回中文，没有给浏览器指定编码格式，默认是gbk，所以我们需要gbk来编码一下，浏览器才能识别</span></span><br><span class="line">        <span class="comment"># data='登陆成功！'.encode('gbk')</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#和咱们学的socketserver那个模块很像啊</span></span><br><span class="line">httpd = make_server(<span class="string">'127.0.0.1'</span>, <span class="number">8080</span>, application)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Serving HTTP on port 8080...'</span>)</span><br><span class="line"><span class="comment"># 开始监听HTTP请求:</span></span><br><span class="line">httpd.serve_forever()</span><br><span class="line"></span><br><span class="line"><span class="comment">#整个框架写好了，那么我们将来想添加一些新的功能，比如说有人想在网址里面输入http://127.0.0.1:8080/timer 来查看当前时间，你只需要两步，写一个url映射关系，写一个应对的处理函数就搞定了，有了框架就不需要你在重新写一遍这所有的逻辑了，简单两步搞定新功能</span></span><br></pre></td></tr></table></figure>

<p>然后是数据库相关的 <code>model.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建表，插入数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">createtable</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">import</span> pymysql</span><br><span class="line">    conn = pymysql.connect(</span><br><span class="line">        host=<span class="string">'127.0.0.1'</span>,</span><br><span class="line">        port=<span class="number">3306</span>,</span><br><span class="line">        user=<span class="string">'root'</span>,</span><br><span class="line">        password=<span class="string">'666'</span>,</span><br><span class="line">        database=<span class="string">'db1'</span>,</span><br><span class="line">        charset=<span class="string">'utf8'</span></span><br><span class="line">    )</span><br><span class="line">    cursor = conn.cursor(pymysql.cursors.DictCursor)</span><br><span class="line">    sql = <span class="string">'''</span></span><br><span class="line"><span class="string">        -- 创建表</span></span><br><span class="line"><span class="string">        create table userinfo(id int primary key auto_increment,username char(20) not null unique,password char(20) not null);</span></span><br><span class="line"><span class="string">        -- 插入数据</span></span><br><span class="line"><span class="string">        insert into userinfo(username,password) values('chao','666'),('sb1','222');</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    conn.commit()</span><br><span class="line">    cursor.close()</span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>

<p>url 相关的 <code>urls.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> views <span class="keyword">import</span> login,auth,favicon,index,timer</span><br><span class="line"></span><br><span class="line"><span class="comment">#url与视图函数的对应关系</span></span><br><span class="line">urlpatterns=[</span><br><span class="line">    (<span class="string">'/login'</span>,login),</span><br><span class="line">    (<span class="string">'/auth/'</span>,auth),</span><br><span class="line">    (<span class="string">'/favicon.ico'</span>,favicon),</span><br><span class="line">    (<span class="string">'/'</span>,index),</span><br><span class="line">    (<span class="string">'/timer'</span>,timer),</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>每一个请求方法的 <code>views.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> webauth</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> parse_qs</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(environ)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'templates/web.html'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth</span><span class="params">(environ)</span>:</span></span><br><span class="line">    <span class="comment"># 登陆认证</span></span><br><span class="line">    <span class="comment"># 1.获取用户输入的用户名和密码</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.去数据库做数据的校验，查看用户提交的是否合法</span></span><br><span class="line">    <span class="comment"># user_information = environ['']</span></span><br><span class="line">    <span class="keyword">if</span> environ.get(<span class="string">"REQUEST_METHOD"</span>) == <span class="string">"POST"</span>:</span><br><span class="line">        <span class="comment"># 获取请求体数据的长度,因为提交过来的数据需要用它来提取,注意POST请求和GET请求的获取数据的方式不同</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            request_body_size = int(environ.get(<span class="string">'CONTENT_LENGTH'</span>, <span class="number">0</span>))</span><br><span class="line">        <span class="keyword">except</span> (ValueError):</span><br><span class="line">            request_body_size = <span class="number">0</span></span><br><span class="line">        <span class="comment"># POST请求获取数据的方式</span></span><br><span class="line">        request_data = environ[<span class="string">'wsgi.input'</span>].read(request_body_size)</span><br><span class="line">        print(<span class="string">'&gt;&gt;&gt;&gt;&gt;'</span>, request_data)  <span class="comment"># &gt;&gt;&gt;&gt;&gt; b'username=chao&amp;password=123'，是个bytes类型数据</span></span><br><span class="line">        print(<span class="string">'?????'</span>, environ[<span class="string">'QUERY_STRING'</span>])  <span class="comment"># ????? 空的，因为post请求只能按照上面这种方式取数据</span></span><br><span class="line">        <span class="comment"># parse_qs可以帮我们解析数据</span></span><br><span class="line">        re_data = parse_qs(request_data)</span><br><span class="line">        print(<span class="string">'拆解后的数据'</span>, re_data)  <span class="comment"># 拆解后的数据 &#123;b'password': [b'123'], b'username': [b'chao']&#125;</span></span><br><span class="line">        <span class="comment">#post请求的返回数据我就不写啦</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">if</span> environ.get(<span class="string">"REQUEST_METHOD"</span>) == <span class="string">"GET"</span>:</span><br><span class="line">        <span class="comment"># GET请求获取数据的方式，只能按照这种方式取</span></span><br><span class="line">        print(<span class="string">'?????'</span>, environ[<span class="string">'QUERY_STRING'</span>])  <span class="comment"># ????? username=chao&amp;password=123,是个字符串类型数据</span></span><br><span class="line">        request_data = environ[<span class="string">'QUERY_STRING'</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># parse_qs可以帮我们解析数据</span></span><br><span class="line">        re_data = parse_qs(request_data)</span><br><span class="line">        print(<span class="string">'拆解后的数据'</span>, re_data)  <span class="comment"># 拆解后的数据 &#123;'password': ['123'], 'username': ['chao']&#125;</span></span><br><span class="line">        username = re_data[<span class="string">'username'</span>][<span class="number">0</span>]</span><br><span class="line">        password = re_data[<span class="string">'password'</span>][<span class="number">0</span>]</span><br><span class="line">        print(username, password)</span><br><span class="line">        <span class="comment"># 进行验证：</span></span><br><span class="line">        status = webauth.auth(username, password)</span><br><span class="line">        <span class="keyword">if</span> status:</span><br><span class="line">            <span class="comment"># 3.将相应内容返回</span></span><br><span class="line">            <span class="keyword">with</span> open(<span class="string">'templates/websuccess.html'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">                data = f.read()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data = <span class="string">b'auth error'</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">favicon</span><span class="params">(environ)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'wechat.ico'</span>,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(environ)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'templates/index.html'</span>,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看当前时间的</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">timer</span><span class="params">(environ)</span>:</span></span><br><span class="line">    data = str(datetime.datetime.now()).encode(<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure>

<p>最后还有权限相关的 <code>webauth.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#对用户名和密码进行验证</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth</span><span class="params">(username,password)</span>:</span></span><br><span class="line">    <span class="keyword">import</span> pymysql</span><br><span class="line">    conn = pymysql.connect(</span><br><span class="line">        host=<span class="string">'127.0.0.1'</span>,</span><br><span class="line">        port=<span class="number">3306</span>,</span><br><span class="line">        user=<span class="string">'root'</span>,</span><br><span class="line">        password=<span class="string">'123'</span>,</span><br><span class="line">        database=<span class="string">'db1'</span>,</span><br><span class="line">        charset=<span class="string">'utf8'</span></span><br><span class="line">    )</span><br><span class="line">    print(<span class="string">'userinfo'</span>,username,password)</span><br><span class="line">    cursor = conn.cursor(pymysql.cursors.DictCursor)</span><br><span class="line">    sql = <span class="string">'select * from userinfo where username=%s and password=%s;'</span></span><br><span class="line">    res = cursor.execute(sql, [username, password])</span><br><span class="line">    <span class="keyword">if</span> res:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Python/" rel="tag"># Python</a>
              <a href="/tags/Django/" rel="tag"># Django</a>
              <a href="/tags/Web/" rel="tag"># Web</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/django/drf-serializer/" rel="prev" title="序列化器 Serializer">
      <i class="fa fa-chevron-left"></i> 序列化器 Serializer
    </a></div>
      <div class="post-nav-item">
    <a href="/django/drf-front-rear-sep/" rel="next" title="前后端分离相关概念">
      前后端分离相关概念 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Web-框架的本质及自定义-Web-框架"><span class="nav-number">1.</span> <span class="nav-text">Web 框架的本质及自定义 Web 框架</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一、简单的-Web-框架"><span class="nav-number">1.1.</span> <span class="nav-text">一、简单的 Web 框架</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#二、返回-HTML-文件的-Web-框架"><span class="nav-number">1.2.</span> <span class="nav-text">二、返回 HTML 文件的 Web 框架</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#三、返回静态文件的高级-Web框架"><span class="nav-number">1.3.</span> <span class="nav-text">三、返回静态文件的高级 Web框架</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#四、函数版高级-Web-框架"><span class="nav-number">1.4.</span> <span class="nav-text">四、函数版高级 Web 框架</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#五、更高级版（多线程版）Web-框架"><span class="nav-number">1.5.</span> <span class="nav-text">五、更高级版（多线程版）Web 框架</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#六、更更高级版-Web-框架"><span class="nav-number">1.6.</span> <span class="nav-text">六、更更高级版 Web 框架</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#七、根据不同路径返回不同页面的-Web-框架"><span class="nav-number">1.7.</span> <span class="nav-text">七、根据不同路径返回不同页面的 Web 框架</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#八、返回动态页面的-Web-框架"><span class="nav-number">1.8.</span> <span class="nav-text">八、返回动态页面的 Web 框架</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#九、wsgiref-模块版-Web-框架"><span class="nav-number">1.9.</span> <span class="nav-text">九、wsgiref 模块版 Web 框架</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#十、起飞版-Web-框架"><span class="nav-number">1.10.</span> <span class="nav-text">十、起飞版 Web 框架</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="刘硕"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">刘硕</p>
  <div class="site-description" itemprop="description">不成为自己讨厌的人</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">345</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">55</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:liushuo432@outlook.com" title="E-Mail → mailto:liushuo432@outlook.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/2436055290" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;2436055290" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="http://wpa.qq.com/msgrd?v=3&uin=1696146913&site=qq&menu=yes" title="QQ → http:&#x2F;&#x2F;wpa.qq.com&#x2F;msgrd?v&#x3D;3&amp;uin&#x3D;1696146913&amp;site&#x3D;qq&amp;menu&#x3D;yes" rel="noopener" target="_blank"><i class="fa fa-fw fa-qq"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">辽ICP备20001451号 </a>
      <img src="/images/beian_icon.png" style="display: inline-block;"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=21142102000063" rel="noopener" target="_blank">辽公网安备 21142102000063号 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘硕</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">2m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">62:03</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.2" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  
<script src="//cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
<script src="//cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script>
<script src="/js/algolia-search.js"></script>














  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'Ga2II3wuJmHX3GiNHm9TmI97-gzGzoHsz',
      appKey     : 'esGYJQepdYLHf07E1VMsP3RK',
      placeholder: "o(*￣▽￣*)ブ来说点什么吧...（填上邮箱可以收到回复提醒）",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

  <script type="text/javascript" src="/js/love.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/Epsilon2.1.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"left","hOffset":-30,"vOffset":-40},"mobile":{"show":false,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false,"tagMode":false});</script></body>
</html>
