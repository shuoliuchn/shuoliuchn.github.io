<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="Tu5vqPaUb8svfkPx5eetJFD84ciQCcWVXNatdsWtj9Q">
  <meta name="baidu-site-verification" content="baidu_verify_FBq9PG4BBb">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"sliu.vip","root":"/","scheme":"Mist","version":"7.7.1","exturl":false,"sidebar":{"position":"right","width":240,"display":"hide","padding":12,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"appID":"PXY1Z6GHKT","apiKey":"eb82f2e78e3053f26aa408e9caa96d93","indexName":"blog","hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"没有找到任何有关 ${query} 的结果╥﹏╥...","hits_stats":"${hits} 搜索用时 ${time} ms o(*￣▽￣*)ブ"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="不成为自己讨厌的人">
<meta property="og:type" content="website">
<meta property="og:title" content="刘硕的技术查阅手册">
<meta property="og:url" content="https://sliu.vip/page/8/index.html">
<meta property="og:site_name" content="刘硕的技术查阅手册">
<meta property="og:description" content="不成为自己讨厌的人">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="刘硕">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="全栈开发">
<meta property="article:tag" content="并发编程">
<meta property="article:tag" content="网络编程">
<meta property="article:tag" content="爬虫">
<meta property="article:tag" content="数据库">
<meta property="article:tag" content="自动化测试">
<meta property="article:tag" content="Web开发">
<meta property="article:tag" content="HTML">
<meta property="article:tag" content="CSS">
<meta property="article:tag" content="JavaScript">
<meta property="article:tag" content="jQuery">
<meta property="article:tag" content="Bootstrap">
<meta property="article:tag" content="测试自动化">
<meta property="article:tag" content="Selenium">
<meta property="article:tag" content="postman">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Vue">
<meta property="article:tag" content="drf">
<meta property="article:tag" content="django">
<meta property="article:tag" content="文档翻译">
<meta property="article:tag" content="PEP8">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://sliu.vip/page/8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>刘硕的技术查阅手册</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f14f123935d6183fdd06f8f1c4bc378f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="刘硕的技术查阅手册" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">刘硕的技术查阅手册</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">Python 全栈开发学习笔记</h1>
      
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-toc">

    <a href="/toc/" rel="section"><i class="fa fa-fw fa-book"></i>总目录</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-rss">

    <a href="/atom.xml" rel="section"><i class="fa fa-fw fa-rss"></i>订阅</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-fw fa-heartbeat"></i>公益 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

  
</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/python-basic/false/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/python-basic/false/" class="post-title-link" itemprop="url">false</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-16 09:07:47" itemprop="dateCreated datePublished" datetime="2020-02-16T09:07:47+08:00">2020-02-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-29 10:34:01" itemprop="dateModified" datetime="2020-02-29T10:34:01+08:00">2020-02-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">Python 基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Python-中表示False的方法"><a href="#Python-中表示False的方法" class="headerlink" title="Python 中表示False的方法"></a>Python 中表示False的方法</h3><p>在 Python 中，所有数据类型，只要是空的，就是 False，否则就是 True。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">False</span></span><br><span class="line">print(<span class="literal">False</span>)</span><br><span class="line">print(bool(<span class="number">0</span>))</span><br><span class="line">print(bool())</span><br><span class="line">print(bool(<span class="literal">None</span>))</span><br><span class="line">print(bool(<span class="string">""</span>))</span><br><span class="line">print(bool([]))</span><br><span class="line">print(bool(()))</span><br><span class="line">print(bool(&#123;&#125;))</span><br><span class="line">print(bool(set()))</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/python-basic/markdown/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/python-basic/markdown/" class="post-title-link" itemprop="url">Markdown 常用语法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-16 09:07:47" itemprop="dateCreated datePublished" datetime="2020-02-16T09:07:47+08:00">2020-02-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-23 00:55:52" itemprop="dateModified" datetime="2020-02-23T00:55:52+08:00">2020-02-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">Python 基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Markdown 语法的简单介绍，都是一些常用到的 Markdown 语法。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/python-basic/markdown/">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/bug-bible/vue-bug/NetworkError/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/bug-bible/vue-bug/NetworkError/" class="post-title-link" itemprop="url">Network Error</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-16 09:07:47" itemprop="dateCreated datePublished" datetime="2020-02-16T09:07:47+08:00">2020-02-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-29 10:34:01" itemprop="dateModified" datetime="2020-02-29T10:34:01+08:00">2020-02-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Bug-%E5%AE%9D%E5%85%B8/" itemprop="url" rel="index"><span itemprop="name">Bug 宝典</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Cannot-find-element"><a href="#Cannot-find-element" class="headerlink" title="Cannot find element"></a>Cannot find element</h2><h3 id="错误1-1"><a href="#错误1-1" class="headerlink" title="错误1.1"></a>错误1.1</h3><p>报错信息：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Access to XMLHttpRequest at <span class="string">'http://tingapi.ting.baidu.com/v1/restserver/ting?'</span> <span class="keyword">from</span> origin <span class="string">'http://localhost:63342'</span> has been blocked by CORS policy: Response to preflight request doesn<span class="string">'t pass access control check: No '</span>Access-Control-Allow-Origin<span class="string">' header is present on the requested resource.</span></span><br><span class="line"><span class="string">01corstest.html?_ijt=ctqipqp7hrjsei9g4g47lt3gu3:32</span></span><br><span class="line"><span class="string">Error: Network Error</span></span><br><span class="line"><span class="string">    at createError (axios.js:913)</span></span><br><span class="line"><span class="string">    at XMLHttpRequest.handleError (axios.js:766)</span></span><br></pre></td></tr></table></figure>

<p>错误代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/axios.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">v-model</span>=<span class="string">"msg"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"query"</span>&gt;</span>查询<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="actionscript">        el: <span class="string">'#app'</span>,</span></span><br><span class="line">        data: &#123;</span><br><span class="line"><span class="actionscript">            msg: <span class="string">''</span>,</span></span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            query()&#123;</span><br><span class="line"><span class="actionscript">                axios.post(<span class="string">'http://tingapi.ting.baidu.com/v1/restserver/ting?'</span>, &#123;</span></span><br><span class="line">                    params: &#123;</span><br><span class="line"><span class="actionscript">                        method: <span class="string">'baidu.ting.search.catalogSug'</span>,</span></span><br><span class="line"><span class="actionscript">                        query: <span class="keyword">this</span>.msg,</span></span><br><span class="line">                    &#125;</span><br><span class="line"><span class="javascript">                &#125;).then(<span class="function"><span class="params">response</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(response);</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(response.data);</span></span><br><span class="line"><span class="javascript">                &#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(error);</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>错误原因：</p>
<p>浏览器的同源访问限制。因为浏览器中输入的网址与请求的域名 <code>http://tingapi.ting.baidu.com</code> 不同，所以浏览器自动拒绝返回的响应，并报错。错误的关键字是 <code>Access-Control-Allow-Origin</code>。详细内容，参见： <a href="/web/ajax-cors">ajax 和同源策略</a>。</p>
<p>解决方法：</p>
<p>我们无法修改百度的服务器，所以是无法通过浏览器访问到数据的。但是可以通过写 Python 脚本的方法，避开浏览器的限制。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/python-basic/CSDN-Markdown-manual/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/python-basic/CSDN-Markdown-manual/" class="post-title-link" itemprop="url">欢迎使用Markdown编辑器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-16 09:07:47" itemprop="dateCreated datePublished" datetime="2020-02-16T09:07:47+08:00">2020-02-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-29 10:34:01" itemprop="dateModified" datetime="2020-02-29T10:34:01+08:00">2020-02-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">Python 基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>你好！ 这是你第一次使用 <strong>Markdown编辑器</strong> 所展示的欢迎页。如果你想学习如何使用Markdown编辑器, 可以仔细阅读这篇文章，了解一下Markdown的基本语法知识。</p>
<h2 id="新的改变"><a href="#新的改变" class="headerlink" title="新的改变"></a>新的改变</h2><p>我们对Markdown编辑器进行了一些功能拓展与语法支持，除了标准的Markdown编辑器功能，我们增加了如下几点新功能，帮助你用它写博客：</p>
<ol>
<li><strong>全新的界面设计</strong> ，将会带来全新的写作体验；</li>
<li>在创作中心设置你喜爱的代码高亮样式，Markdown <strong>将代码片显示选择的高亮样式</strong> 进行展示；</li>
<li>增加了 <strong>图片拖拽</strong> 功能，你可以将本地的图片直接拖拽到编辑区域直接展示；</li>
<li>全新的 <strong>KaTeX数学公式</strong> 语法；</li>
<li>增加了支持<strong>甘特图的mermaid语法<a href="[mermaid语法说明](https://mermaidjs.github.io/)">^1</a></strong> 功能；</li>
<li>增加了 <strong>多屏幕编辑</strong> Markdown文章功能；</li>
<li>增加了 <strong>焦点写作模式、预览模式、简洁写作模式、左右区域同步滚轮设置</strong> 等功能，功能按钮位于编辑区域与预览区域中间；</li>
<li>增加了 <strong>检查列表</strong> 功能。</li>
</ol>
<h2 id="功能快捷键"><a href="#功能快捷键" class="headerlink" title="功能快捷键"></a>功能快捷键</h2><p>撤销：<kbd>Ctrl/Command</kbd> + <kbd>Z</kbd><br>重做：<kbd>Ctrl/Command</kbd> + <kbd>Y</kbd><br>加粗：<kbd>Ctrl/Command</kbd> + <kbd>B</kbd><br>斜体：<kbd>Ctrl/Command</kbd> + <kbd>I</kbd><br>标题：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>H</kbd><br>无序列表：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>U</kbd><br>有序列表：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>O</kbd><br>检查列表：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>C</kbd><br>插入代码：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>K</kbd><br>插入链接：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>L</kbd><br>插入图片：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>G</kbd><br>查找：<kbd>Ctrl/Command</kbd> + <kbd>F</kbd><br>替换：<kbd>Ctrl/Command</kbd> + <kbd>G</kbd></p>
<h2 id="合理的创建标题，有助于目录的生成"><a href="#合理的创建标题，有助于目录的生成" class="headerlink" title="合理的创建标题，有助于目录的生成"></a>合理的创建标题，有助于目录的生成</h2><p>直接输入1次<kbd>#</kbd>，并按下<kbd>space</kbd>后，将生成1级标题。<br>输入2次<kbd>#</kbd>，并按下<kbd>space</kbd>后，将生成2级标题。<br>以此类推，我们支持6级标题。有助于使用<code>TOC</code>语法后生成一个完美的目录。</p>
<h2 id="如何改变文本的样式"><a href="#如何改变文本的样式" class="headerlink" title="如何改变文本的样式"></a>如何改变文本的样式</h2><p><em>强调文本</em> <em>强调文本</em></p>
<p><strong>加粗文本</strong> <strong>加粗文本</strong></p>
<p>==标记文本==</p>
<p><del>删除文本</del></p>
<blockquote>
<p>引用文本</p>
</blockquote>
<p>H<del>2</del>O is是液体。</p>
<p>2^10^ 运算结果是 1024.</p>
<h2 id="插入链接与图片"><a href="#插入链接与图片" class="headerlink" title="插入链接与图片"></a>插入链接与图片</h2><p>链接: <a href="https://mp.csdn.net" target="_blank" rel="noopener">link</a>.</p>
<p>图片: <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw" alt="Alt"></p>
<p>带尺寸的图片: ![Alt](<a href="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw" target="_blank" rel="noopener">https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw</a> =30x30)</p>
<p>居中的图片: <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw#pic_center" alt="Alt"></p>
<p>居中并且带尺寸的图片: ![Alt](<a href="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw#pic_center" target="_blank" rel="noopener">https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hdmF0YXIuY3Nkbi5uZXQvNy83L0IvMV9yYWxmX2h4MTYzY29tLmpwZw#pic_center</a> =30x30)</p>
<p>当然，我们为了让用户更加便捷，我们增加了图片拖拽功能。</p>
<h2 id="如何插入一段漂亮的代码片"><a href="#如何插入一段漂亮的代码片" class="headerlink" title="如何插入一段漂亮的代码片"></a>如何插入一段漂亮的代码片</h2><p>去<a href="https://mp.csdn.net/configure" target="_blank" rel="noopener">博客设置</a>页面，选择一款你喜欢的代码片高亮样式，下面展示同样高亮的 <code>代码片</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// An highlighted block</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="string">'bar'</span>;</span><br></pre></td></tr></table></figure>


<h2 id="生成一个适合你的列表"><a href="#生成一个适合你的列表" class="headerlink" title="生成一个适合你的列表"></a>生成一个适合你的列表</h2><ul>
<li>项目<ul>
<li>项目<ul>
<li>项目</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol>
<li>项目1</li>
<li>项目2</li>
<li>项目3</li>
</ol>
<ul>
<li><input disabled="" type="checkbox"> 计划任务</li>
<li><input checked="" disabled="" type="checkbox"> 完成任务</li>
</ul>
<h2 id="创建一个表格"><a href="#创建一个表格" class="headerlink" title="创建一个表格"></a>创建一个表格</h2><p>一个简单的表格是这么创建的：<br>| 项目 | Value |<br>| —- | —– |<br>| 电脑 | $1600 |<br>| 手机 | $12   |<br>| 导管 | $1    |</p>
<h3 id="设定内容居中、居左、居右"><a href="#设定内容居中、居左、居右" class="headerlink" title="设定内容居中、居左、居右"></a>设定内容居中、居左、居右</h3><p>使用<code>:---------:</code>居中<br>使用<code>:----------</code>居左<br>使用<code>----------:</code>居右<br>|     第一列     |         第二列 | 第三列         |<br>| :————: | ————-: | :————- |<br>| 第一列文本居中 | 第二列文本居右 | 第三列文本居左 |</p>
<h3 id="SmartyPants"><a href="#SmartyPants" class="headerlink" title="SmartyPants"></a>SmartyPants</h3><p>SmartyPants将ASCII标点字符转换为“智能”印刷标点HTML实体。例如：<br>|    TYPE   |ASCII                          |HTML<br>|—————-|——————————-|—————————–|<br>|Single backticks|<code>&#39;Isn&#39;t this fun?&#39;</code>            |’Isn’t this fun?’            |<br>|Quotes          |<code>&quot;Isn&#39;t this fun?&quot;</code>            |”Isn’t this fun?”            |<br>|Dashes          |<code>-- is en-dash, --- is em-dash</code>|– is en-dash, — is em-dash|</p>
<h2 id="创建一个自定义列表"><a href="#创建一个自定义列表" class="headerlink" title="创建一个自定义列表"></a>创建一个自定义列表</h2><dl><dt>Markdown</dt><dd>Text-to-HTML conversion tool</dd></dl><dl><dt>Authors<br>:  John</dt><dd>Luke</dd></dl><h2 id="如何创建一个注脚"><a href="#如何创建一个注脚" class="headerlink" title="如何创建一个注脚"></a>如何创建一个注脚</h2><p>一个具有注脚的文本。<a href="注脚的解释">^2</a></p>
<h2 id="注释也是必不可少的"><a href="#注释也是必不可少的" class="headerlink" title="注释也是必不可少的"></a>注释也是必不可少的</h2><p>Markdown将文本转换为 HTML。</p>
<p>*[HTML]:   超文本标记语言</p>
<h2 id="KaTeX数学公式"><a href="#KaTeX数学公式" class="headerlink" title="KaTeX数学公式"></a>KaTeX数学公式</h2><p>您可以使用渲染LaTeX数学表达式 <a href="https://khan.github.io/KaTeX/" target="_blank" rel="noopener">KaTeX</a>:</p>
<p>Gamma公式展示 $\Gamma(n) = (n-1)!\quad\forall<br>n\in\mathbb N$ 是通过欧拉积分</p>
<p>$$<br>\Gamma(z) = \int_0^\infty t^{z-1}e^{-t}dt,.<br>$$</p>
<blockquote>
<p>你可以找到更多关于的信息 <strong>LaTeX</strong> 数学表达式<a href="http://meta.math.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference" target="_blank" rel="noopener">here</a>.</p>
</blockquote>
<h2 id="新的甘特图功能，丰富你的文章"><a href="#新的甘特图功能，丰富你的文章" class="headerlink" title="新的甘特图功能，丰富你的文章"></a>新的甘特图功能，丰富你的文章</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gantt</span><br><span class="line">        dateFormat  YYYY-MM-DD</span><br><span class="line">        title Adding GANTT diagram functionality to mermaid</span><br><span class="line">        section 现有任务</span><br><span class="line">        已完成               :done,    des1, 2014-01-06,2014-01-08</span><br><span class="line">        进行中               :active,  des2, 2014-01-09, 3d</span><br><span class="line">        计划一               :         des3, after des2, 5d</span><br><span class="line">        计划二               :         des4, after des3, 5d</span><br></pre></td></tr></table></figure>
<ul>
<li>关于 <strong>甘特图</strong> 语法，参考 <a href="https://mermaidjs.github.io/" target="_blank" rel="noopener">这儿</a>,</li>
</ul>
<h2 id="UML-图表"><a href="#UML-图表" class="headerlink" title="UML 图表"></a>UML 图表</h2><p>可以使用UML图表进行渲染。 <a href="https://mermaidjs.github.io/" target="_blank" rel="noopener">Mermaid</a>. 例如下面产生的一个序列图：:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">张三 -&gt;&gt; 李四: 你好！李四, 最近怎么样?</span><br><span class="line">李四--&gt;&gt;王五: 你最近怎么样，王五？</span><br><span class="line">李四--x 张三: 我很好，谢谢!</span><br><span class="line">李四-x 王五: 我很好，谢谢!</span><br><span class="line">Note right of 王五: 李四想了很长时间, 文字太长了&lt;br&#x2F;&gt;不适合放在一行.</span><br><span class="line"></span><br><span class="line">李四--&gt;&gt;张三: 打量着王五...</span><br><span class="line">张三-&gt;&gt;王五: 很好... 王五, 你怎么样?</span><br></pre></td></tr></table></figure>

<p>这将产生一个流程图。:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A[长方形] -- 链接 --&gt; B((圆))</span><br><span class="line">A --&gt; C(圆角长方形)</span><br><span class="line">B --&gt; D&#123;菱形&#125;</span><br><span class="line">C --&gt; D</span><br></pre></td></tr></table></figure>

<ul>
<li>关于 <strong>Mermaid</strong> 语法，参考 <a href="https://mermaidjs.github.io/" target="_blank" rel="noopener">这儿</a>,</li>
</ul>
<h2 id="FLowchart流程图"><a href="#FLowchart流程图" class="headerlink" title="FLowchart流程图"></a>FLowchart流程图</h2><p>我们依旧会支持flowchart的流程图：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">flowchat</span><br><span class="line">st&#x3D;&gt;start: 开始</span><br><span class="line">e&#x3D;&gt;end: 结束</span><br><span class="line">op&#x3D;&gt;operation: 我的操作</span><br><span class="line">cond&#x3D;&gt;condition: 确认？</span><br><span class="line"></span><br><span class="line">st-&gt;op-&gt;cond</span><br><span class="line">cond(yes)-&gt;e</span><br><span class="line">cond(no)-&gt;op</span><br></pre></td></tr></table></figure>

<ul>
<li>关于 <strong>Flowchart流程图</strong> 语法，参考 <a href="http://adrai.github.io/flowchart.js/" target="_blank" rel="noopener">这儿</a>.</li>
</ul>
<h2 id="导出与导入"><a href="#导出与导入" class="headerlink" title="导出与导入"></a>导出与导入</h2><h3 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h3><p>如果你想尝试使用此编辑器, 你可以在此篇文章任意编辑。当你完成了一篇文章的写作, 在上方工具栏找到 <strong>文章导出</strong> ，生成一个.md文件或者.html文件进行本地保存。</p>
<h3 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h3><p>如果你想加载一篇你写过的.md文件，在上方工具栏可以选择导入功能进行对应扩展名的文件导入，<br>继续你的创作。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/translation/PEP8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/translation/PEP8/" class="post-title-link" itemprop="url">PEP 8 -- Python代码格式规则</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 14:41:23" itemprop="dateCreated datePublished" datetime="2020-02-15T14:41:23+08:00">2020-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-29 10:34:01" itemprop="dateModified" datetime="2020-02-29T10:34:01+08:00">2020-02-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91/" itemprop="url" rel="index"><span itemprop="name">官方文档翻译</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <table>
<thead>
<tr>
<th align="left">PEP:</th>
<th>8</th>
</tr>
</thead>
<tbody><tr>
<td align="left">标题：</td>
<td>Python代码格式规则（Style Guide for Python Code）</td>
</tr>
<tr>
<td align="left">作者：</td>
<td>Guido van Rossum <guido at python.org>, Barry Warsaw <barry at python.org>, Nick Coghlan <ncoghlan at gmail.com></td>
</tr>
<tr>
<td align="left">译者：</td>
<td>刘硕</td>
</tr>
<tr>
<td align="left">状态：</td>
<td>有效</td>
</tr>
<tr>
<td align="left">类型：</td>
<td>Process</td>
</tr>
<tr>
<td align="left">创建日期：</td>
<td>2001年7月5日</td>
</tr>
<tr>
<td align="left">发布历史：</td>
<td>2001年7月5日，2013年8月1日</td>
</tr>
<tr>
<td align="left">翻译完成日期：</td>
<td>2020年1月13日</td>
</tr>
</tbody></table>
<hr>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>本文介绍的是 Python 主流发行版标准库的代码书写格式。对于嵌套在 Python 中执行的 C 语言代码的书写格式，请参照另外一个 PEP 代码格式规则[^1]。</p>
<p>本文档和 <a href="https://www.python.org/dev/peps/pep-0257" target="_blank" rel="noopener">PEP 257</a> （文档字符串书写规则）都是依据 Guido 写过的 Python 格式规则修订而来的[^2]。</p>
<p>本格式规则不是一成不变的，曾经的书写传统会随着语言的变化而发生改变。</p>
<p>许多项目都有它们自己的编码格式规则。如果本文提出的格式指导与项目格式要求产生了冲突，要优先使用项目规定的格式。</p>
<h1 id="教条主义是脑袋瓜中的小妖精"><a href="#教条主义是脑袋瓜中的小妖精" class="headerlink" title="教条主义是脑袋瓜中的小妖精"></a>教条主义是脑袋瓜中的小妖精</h1><p>Guido 认为，代码被阅读的频率要比它被书写的频率高。这篇格式规则就是要试着提高代码的可读性，让不同人写的代码都能在 Python 领域中广泛流传。就像 Python 之禅 <a href="https://www.python.org/dev/peps/pep-0020" target="_blank" rel="noopener">PEP 20</a> 中提到的那样：“可读性很重要”。</p>
<p>格式规则就是为了统一格式。按照本格式规则写代码非常重要，按照项目规定的格式更重要。最重要的是，始终遵守同一种格式要求。切忌混用格式要求。</p>
<p>然而，要知道何时需要打破规则——有时格式规则建议的规则不适用。在犹豫不决时，大胆使用你觉得最合适的格式。多尝试几种写法，选取看起来最顺眼的那个。你也可以向别人请教哟！</p>
<p>特别地：不要为了遵守这个 PEP 规则而打破向后兼容性！</p>
<p>无视某条规则的其他原因：</p>
<ol>
<li>使用规则反而降低代码的可读性，就连那些常年阅读遵循此 PEP 规则程序的程序员读起来也很吃力。</li>
<li>为了跟周围的代码一致，有时不得不打破这个规则（或许是因为历史原因）——不过这也是一个清理他人留下的烂摊子的一个机会（现实版的 XP 风格）。</li>
<li>涉及的那段代码早在引入格式规则之前就已经写好了，而且没有其他理由修改它们。</li>
<li>那段代码需要和比较老版本的 Python 代码保持一致，而它又恰好不支持我们建议的格式规则。</li>
</ol>
<h1 id="代码布局"><a href="#代码布局" class="headerlink" title="代码布局"></a>代码布局</h1><h2 id="缩进"><a href="#缩进" class="headerlink" title="缩进"></a>缩进</h2><p>每一级缩进用<strong>四个空格</strong>表示。</p>
<p>将连续的一行写成多行，新起的一行要么和 Python 内置的包裹元素圆括号、方括号或大括号对齐，要么启用悬挂缩进[^7]。使用悬挂缩进时，下面几种方法可供参考。不言而喻的是，第一行和后续的缩进行要能明显区分出来，不要把分行写的内容和缩进内容搞混（参见推荐写法的第二个例子）。</p>
<p>推荐写法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 和开放的分隔符（这里是小括号）对齐</span></span><br><span class="line">foo = long_function_name(var_one, var_two,</span><br><span class="line">                         var_three, var_four)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加四个空格（多一级缩进），从而区分参数和后续的函数代码。</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">long_function_name</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        var_one, var_two, var_three,</span></span></span><br><span class="line"><span class="function"><span class="params">        var_four)</span>:</span></span><br><span class="line">    print(var_one)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 悬挂缩进应该多出一级。</span></span><br><span class="line">foo = long_function_name(</span><br><span class="line">    var_one, var_two,</span><br><span class="line">    var_three, var_four)</span><br></pre></td></tr></table></figure>

<p>不合适的写法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一行的两个参数没有另起一行，妨碍阅读。</span></span><br><span class="line">foo = long_function_name(var_one, var_two,</span><br><span class="line">    var_three, var_four)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不能直观区分分行写的代码和后续需要缩进的代码。</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">long_function_name</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    var_one, var_two, var_three,</span></span></span><br><span class="line"><span class="function"><span class="params">    var_four)</span>:</span></span><br><span class="line">    print(var_one)</span><br></pre></td></tr></table></figure>

<p>对于分行写的情况，可以不遵守4空格规则。</p>
<p>上面的例子也可以写成这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 悬挂缩进可以不严格使用4个空格。</span></span><br><span class="line">foo = long_function_name(</span><br><span class="line">  var_one, var_two,</span><br><span class="line">  var_three, var_four)</span><br></pre></td></tr></table></figure>

<p>如果 <code>if</code> 语句的条件很长，需要分多行来写，你应该注意的是，关键字占两个字符（比如 <code>if</code>），加上一个空格，再加上一个左括号，刚好凑成4个字符。若此时还使用上面的规则，在与括号后面对其，新一行天然缩进4个字符，这会跟后续的 <code>if</code> 语句重叠。对于这种层叠起来的 <code>if</code> 语句，本 PEP 规则不会要求如果（或者是否）进一步作出可视化的区分。这种情可接受的写法，包括但不限于：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不额外增加缩进</span></span><br><span class="line"><span class="keyword">if</span> (this_is_one_thing <span class="keyword">and</span></span><br><span class="line">    that_is_another_thing):</span><br><span class="line">    do_something()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加一条注释，为程序员或多或少提供一些区分</span></span><br><span class="line"><span class="comment"># supporting syntax highlighting.</span></span><br><span class="line"><span class="keyword">if</span> (this_is_one_thing <span class="keyword">and</span></span><br><span class="line">    that_is_another_thing):</span><br><span class="line">    <span class="comment"># Since both conditions are true, we can frobnicate.</span></span><br><span class="line">    do_something()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给条件句增加额外的缩进</span></span><br><span class="line"><span class="keyword">if</span> (this_is_one_thing</span><br><span class="line">        <span class="keyword">and</span> that_is_another_thing):</span><br><span class="line">    do_something()</span><br></pre></td></tr></table></figure>

<p>（也请参见下面关于<a href="#该在二元运算符的前面还是后面换行">改在二元运算符的前面还是后面换行</a>的讨论）</p>
<p>多行的闭合大括号、方括号、圆括号结构的最后一行<strong>回括号</strong>要么与括号中内容的最后一行对齐，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">my_list = [</span><br><span class="line">    <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,</span><br><span class="line">    <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>,</span><br><span class="line">    ]</span><br><span class="line">result = some_function_that_takes_arguments(</span><br><span class="line">    <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>,</span><br><span class="line">    <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>,</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p>要么与多行结构第一行的第一个字符对齐，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">my_list = [</span><br><span class="line">    <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,</span><br><span class="line">    <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>,</span><br><span class="line">]</span><br><span class="line">result = some_function_that_takes_arguments(</span><br><span class="line">    <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>,</span><br><span class="line">    <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="制表符还是空格？"><a href="#制表符还是空格？" class="headerlink" title="制表符还是空格？"></a>制表符还是空格？</h2><p>推荐使用空格缩进。</p>
<p>制表符（<code>Tab</code> 键）仅在为了与已经使用制表符缩进的代码保持一致的情况下使用。</p>
<p>Python 3 不允许混用制表符和空格缩进。</p>
<p>Python 2 混用制表符和空格缩进的代码应该转换成统一使用空格缩进。</p>
<p>使用 Python 2 命令行解释器的 <code>-t</code> 选项时，如果代码非法混用了制表符和空格，会发出警告。如果使用 <code>-tt</code> 选项，这些警告会报错。极力推荐运行程序时使用这些命令！</p>
<h2 id="单行最大长度"><a href="#单行最大长度" class="headerlink" title="单行最大长度"></a>单行最大长度</h2><p>把每一行的长度都限制在 79 个字符以内。</p>
<p>对于没有很多结构要求的灵活的大块文本（文档字符串或注释），单行长度要限制在 72 个字符以内。</p>
<p>限制编辑的窗口宽度使得我们可以并排打开多个文件。而且，使用代码版本控制工具时，也可以在相邻的两列比较不同版本的差异。</p>
<p>绝大多数代码编辑工具的默认宽度都会破坏代码的可视结构，让代码更难理解。即便有些编辑器在自动换行时会提供特殊的图形标识，也于事无补。选择79个字符的限制就是为了避免那些窗口宽度被设置为80的编辑器破坏我们的代码结构。还有一些基于网页的编辑工具可能根本就不会动态换行。</p>
<p>有些团队，极度想要更长的代码。出于特别的维护代码的目的，或者团队一致同意，也可以把单行代码长度限制提高到99个字符。注释和文档字符串仍然建议限制在每行72个字符以下。</p>
<p>Python 标准库保守地要求每一行限制在79个字符以下（文档字符串/注释为72个字符）。</p>
<p>要想把一行长代码分割成多行，推荐的方式是将圆括号、方括号和圆括号中的内容换行处理。括号中的长代码有时会因换行而损坏。这时，就应该使用反斜杠来分割代码中的其他部分。</p>
<p>反斜杠有时很有用。比如，很长的，多个 <code>with</code> 语句不能在括号中换行，所以更倾向于使用反斜杠换行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'/path/to/some/file/you/want/to/read'</span>) <span class="keyword">as</span> file_1, \</span><br><span class="line">     open(<span class="string">'/path/to/some/file/being/written'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> file_2:</span><br><span class="line">    file_2.write(file_1.read())</span><br></pre></td></tr></table></figure>

<p>（参见前面关于<a href="#缩进">多行 <code>if</code> 语句</a>的讨论，更加深入思考这种多 <code>with</code> 语句的缩进写法）</p>
<p>这种情况的另一个例子是 <code>assert</code> 语句。</p>
<p>确保每一行的缩进都是恰当的。</p>
<h2 id="该在二元运算符的前面还是后面换行"><a href="#该在二元运算符的前面还是后面换行" class="headerlink" title="该在二元运算符的前面还是后面换行"></a>该在二元运算符的前面还是后面换行</h2><p>数十年来，程序员们约定俗成的规则是在二元运算符后面换行。但是这种换行方式会在两个方面破坏代码的可读性：运算符会在屏幕的不同列四散分布，每个运算符都在远离运算域的前一行结尾。在这种情况下，我们的眼睛需要额外的工作来分辨到底是要做加法还是做减法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不合适的写法：运算符处于原理运算域的位置</span></span><br><span class="line">income = (gross_wages +</span><br><span class="line">          taxable_interest +</span><br><span class="line">          (dividends - qualified_dividends) -</span><br><span class="line">          ira_deduction -</span><br><span class="line">          student_loan_interest)</span><br></pre></td></tr></table></figure>

<p>为了解决这种可读性的问题，数学家和出版商都遵循相反的规则。Donald Knuth 在他的系列著作 <em>计算机与排版</em> 中这样解释这个规则：“虽然在一整段文字中的公式会在二元运算符的后面换行，但当单独展示公式时，要在二元运算符前面换行”[^3]。</p>
<p>若遵守传统的数学排版规则，写出的代码就会更具可读性：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 推荐写法：易于将运算符与运算域相匹配</span></span><br><span class="line">income = (gross_wages</span><br><span class="line">          + taxable_interest</span><br><span class="line">          + (dividends - qualified_dividends)</span><br><span class="line">          - ira_deduction</span><br><span class="line">          - student_loan_interest)</span><br></pre></td></tr></table></figure>

<p>在 Python 代码中，在二元运算符前后换行都是可以的，但是要保持一致性，不能混着用。对于新写的代码，还是建议使用 Knuth 的格式，在二元运算符之前换行。</p>
<h2 id="空行"><a href="#空行" class="headerlink" title="空行"></a>空行</h2><p>最外层的函数和类在定义时，要用两个空行分隔开。</p>
<p>在定义类的方法时，要用一个空行分隔。</p>
<p>可以用额外的空行（越少越好）区分一组有关联的函数。可是适当删除一组有关联的单行代码（比如一组虚拟工具[^8]）之间的空行。</p>
<p>在函数中使用空行（越少越好）来区分不同的逻辑块。</p>
<p>Python 将 <code>control-L</code>（例如 <code>^L</code>）换页符认作空格。很多编辑器都将这些符号用作分页的标识。所以你可以使用这些符号将你文件中不同的部分的代码放到不同页中。需要注意的是，有些编辑器和基于网页的代码阅读器或许不能识别 <code>control-L</code> 和分页符，于是在那个位置或许不能正常分页显示。</p>
<h2 id="源文件代码编写"><a href="#源文件代码编写" class="headerlink" title="源文件代码编写"></a>源文件代码编写</h2><p>Python 核心发行版的字符集一定是 UTF-8 （在 Python 2 中是 ASCII）。</p>
<p>使用 ASCII（Python 2）或 UTF-8（Python 3）编码的文件不必声明编码方式。</p>
<p>在标准库中，如果出于测试目的，或者出现在注释或文档字符串中需要提到一个不能用 ASCII 字符表示的作者名字，可以不使用默认编码。如果不是出入上述目的，请使用 <code>\x</code>、<code>\u</code>、<code>\U</code> 或者 <code>\N</code>  来转义那些非-ASCII 字符。</p>
<p>对于 Python 3.0 及之后的版本，标准库需要遵守如下规定（参见 <a href="https://www.python.org/dev/peps/pep-3131" target="_blank" rel="noopener">PEP 3131</a>）：Python 标准库中的<strong>所有</strong>标识符<strong>必须只</strong>使用 ASCII 符号，而且在所有可能的地方都<strong>应该</strong>使用英文单词（在很多情况，会用到非英文的缩写和技术术语）。此外，文档字符串和注释必须用 ASCII 编码。唯一的例外是（a）测试非-ASCII 特性，和（b）作者的名字。如果作者的名字不是基于拉丁字母（latin-1，ISO/IEC 8859-1 字符集）必须提供一个用此字符集音译的名字。</p>
<p>建议具有全球影响力的开源项目也遵守和 Python 标准库类似的规范。</p>
<h2 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h2><p>导入通常应该分成多行来写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">合适:   <span class="keyword">import</span> os</span><br><span class="line">       <span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">不合适: <span class="keyword">import</span> sys, os</span><br></pre></td></tr></table></figure>

<p>然而这样写是可以的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> Popen, PIPE</span><br></pre></td></tr></table></figure>

<p>导入通常位于文件的顶端，模块注释和文档字符串之后，全局模块和常量之前。</p>
<p>导入应该按照下面的顺序分组排列：</p>
<ol>
<li>导入标准库；</li>
<li>导入相关的第三方库；</li>
<li>导入指定的本地应用/库。</li>
</ol>
<p>每组导入之间应该用一个空行隔开。</p>
<p>建议使用绝对路径导入。因为这种导入方式可读性更高，而且当导入系统的路径配置不当（比如包中的路径以 <code>sys.path</code> 结尾）时，表现得更好（至少报错信息更明确）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mypkg.sibling</span><br><span class="line"><span class="keyword">from</span> mypkg <span class="keyword">import</span> sibling</span><br><span class="line"><span class="keyword">from</span> mypkg.sibling <span class="keyword">import</span> example</span><br></pre></td></tr></table></figure>

<p>不过，除了绝对路径导入，明确的相对路径导入也是可以接受的，尤其是处理的包文件结构布局很复杂，没有必要使用冗长的绝对路径导入的时候：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> sibling</span><br><span class="line"><span class="keyword">from</span> .sibling <span class="keyword">import</span> example</span><br></pre></td></tr></table></figure>

<p>标准库的代码应该避免使用复杂的包文件结构布局，而且只能使用绝对路径导入。</p>
<p>永远<strong>不要</strong>使用不明确的相对路径导入。在 Python 3 标准库中，这样的导入方式已经被移除。</p>
<p>当从一个包含类的模块中导入一个类时，这样写通常是可以的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> myclass <span class="keyword">import</span> MyClass</span><br><span class="line"><span class="keyword">from</span> foo.bar.yourclass <span class="keyword">import</span> YourClass</span><br></pre></td></tr></table></figure>

<p>如果这种导入方式与本地的名称冲突，就要使用明确的方式导入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> myclass</span><br><span class="line"><span class="keyword">import</span> foo.bar.yourclass</span><br></pre></td></tr></table></figure>

<p>通过 <code>myclass.MyClass</code> 和 <code>foo.bar.yourclass.YourClass</code> 实用类。</p>
<p>应该避免使用通配符导入（<code>from &lt;module&gt; import *</code>），因为这会让我们搞不清楚命名空间中都有哪些名字，给读者和许多自动化工具造成困扰。使用通配符导入在一种情况下是合理的，那就是将内部接口重新声明为共用 API（例如，重写一个通过任意加速模块定义的 Python 程序接口，而且事先不知道的定义会被重写[^9]）。</p>
<p>即便使用这个方式重写名字，依然要遵守后面关于公共与私有接口的规则。</p>
<h2 id="模块级双下名称"><a href="#模块级双下名称" class="headerlink" title="模块级双下名称"></a>模块级双下名称</h2><p>模块级的“双下”名称（例如，名称前后都有两条双下划线），比如<code>__all__</code>、<code>__author__</code>、<code>__version__</code>，等等，应该放在文档字符串之后，并且处于除了 <code>from __future__</code> 之外，任何导入之前。Python 强制要求，future-导入必须出现在任何其他除文档字符串之外的代码之前：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""这是示例模块</span></span><br><span class="line"><span class="string">本模块应有尽有</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> barry_as_FLUFL</span><br><span class="line"></span><br><span class="line">__all__ = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</span><br><span class="line">__version__ = <span class="string">'0.1'</span></span><br><span class="line">__author__ = <span class="string">'Cardinal Biggles'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br></pre></td></tr></table></figure>

<h1 id="字符串的引号"><a href="#字符串的引号" class="headerlink" title="字符串的引号"></a>字符串的引号</h1><p>在 Python 中，单引号字符串和双引号字符串是完全一样的。本 PEP 规则不对此作任何建议。选择一个规则，并且遵守它。不过，当字符串中已经有了单引号或者双引号自负的时候，就要使用另一种引号来避免在字符串中使用反斜线转义。这会提高代码的可读性。</p>
<p>至于三对引号的字符串，使用双引号来和 <a href="https://www.python.org/dev/peps/pep-0257" target="_blank" rel="noopener">PEP 257</a> 的文档字符串传统保持一致。</p>
<h1 id="表达式和语句中的空格"><a href="#表达式和语句中的空格" class="headerlink" title="表达式和语句中的空格"></a>表达式和语句中的空格</h1><h2 id="痛点-10"><a href="#痛点-10" class="headerlink" title="痛点[^10]"></a>痛点[^10]</h2><p>在下面的情况下，不要加入空格：</p>
<ul>
<li><p>圆括号、方括号和大括号里面紧挨着的地方：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">合适:   spam(ham[<span class="number">1</span>], &#123;eggs: <span class="number">2</span>&#125;)</span><br><span class="line">不合适: spam( ham[ <span class="number">1</span> ], &#123; eggs: <span class="number">2</span> &#125; )</span><br></pre></td></tr></table></figure>
</li>
<li><p>末尾的逗号和回括号之间：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">合适:   foo = (<span class="number">0</span>,)</span><br><span class="line">不合适: bar = (<span class="number">0</span>, )</span><br></pre></td></tr></table></figure>
</li>
<li><p>逗号、分号和冒号的正前方：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">合适:   <span class="keyword">if</span> x == <span class="number">4</span>: <span class="keyword">print</span> x, y; x, y = y, x</span><br><span class="line">不合适: <span class="keyword">if</span> x == <span class="number">4</span> : <span class="keyword">print</span> x , y ; x , y = y , x</span><br></pre></td></tr></table></figure>
</li>
<li><p>不过，在切片中，冒号的作用类似于一个二元运算符，它的两边应该有等量的空格（把它看作优先级最低的运算符）。在扩展切片中，两个冒号搭配的空格数量也应该是相等的。例外：切片参数被省略时，空格也被省略。</p>
<p>合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ham[<span class="number">1</span>:<span class="number">9</span>], ham[<span class="number">1</span>:<span class="number">9</span>:<span class="number">3</span>], ham[:<span class="number">9</span>:<span class="number">3</span>], ham[<span class="number">1</span>::<span class="number">3</span>], ham[<span class="number">1</span>:<span class="number">9</span>:]</span><br><span class="line">ham[lower:upper], ham[lower:upper:], ham[lower::step]</span><br><span class="line">ham[lower+offset : upper+offset]</span><br><span class="line">ham[: upper_fn(x) : step_fn(x)], ham[:: step_fn(x)]</span><br><span class="line">ham[lower + offset : upper + offset]</span><br></pre></td></tr></table></figure>

<p>不合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ham[lower + offset:upper + offset]</span><br><span class="line">ham[<span class="number">1</span>: <span class="number">9</span>], ham[<span class="number">1</span> :<span class="number">9</span>], ham[<span class="number">1</span>:<span class="number">9</span> :<span class="number">3</span>]</span><br><span class="line">ham[lower : : upper]</span><br><span class="line">ham[ : upper]</span><br></pre></td></tr></table></figure>
</li>
<li><p>调用函数时，传参括号的左括号正前方：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">合适:   spam(<span class="number">1</span>)</span><br><span class="line">不合适: spam (<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>索引或切片左括号的正前方：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">合适:   dct[<span class="string">'key'</span>] = lst[index]</span><br><span class="line">不合适: dct [<span class="string">'key'</span>] = lst [index]</span><br></pre></td></tr></table></figure>
</li>
<li><p>为了让指定的运算符和其他运算符对齐而在它（或别的运算符）周围使用多于一个空格：</p>
<p>合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">1</span></span><br><span class="line">y = <span class="number">2</span></span><br><span class="line">long_variable = <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>不合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x             = <span class="number">1</span></span><br><span class="line">y             = <span class="number">2</span></span><br><span class="line">long_variable = <span class="number">3</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="其他建议"><a href="#其他建议" class="headerlink" title="其他建议"></a>其他建议</h2><ul>
<li><p>时刻避免在结尾加空格。因为结尾的空格通常是看不见的，会造成令人困惑的麻烦：例如，一个反斜杠后面接一个空格，那么下一行就不被视为本行的延续。一些编辑器不会对此做出任何修改，而且很多项目（像 CPython 本身）在预加载过程中就会直接拒绝。</p>
</li>
<li><p>千万在二元运算符两端放一个空格：赋值运算（<code>=</code>）、增强赋值运算[^11]（<code>+=</code>、<code>-=</code>，等等）、比较运算（<code>==</code>、<code>&lt;</code>、<code>&gt;</code>、<code>!=</code>、<code>&lt;&gt;</code>、<code>&lt;=</code>、<code>&gt;=</code>、<code>in</code>、<code>not in</code>、<code>is</code>、<code>is not</code>）、布尔运算（<code>and</code>、<code>or</code>、<code>not</code>）。</p>
</li>
<li><p>如果运算符的优先级不同，可以考虑只在最低优先级运算符两端使用空格。具体在哪里加，由你自己来决定。然而，永远不要使用超过一个空格，而且一定保证二元运算符两端的空格数相等。</p>
<p>合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i = i + <span class="number">1</span></span><br><span class="line">submitted += <span class="number">1</span></span><br><span class="line">x = x*<span class="number">2</span> - <span class="number">1</span></span><br><span class="line">hypot2 = x*x + y*y</span><br><span class="line">c = (a+b) * (a-b)</span><br></pre></td></tr></table></figure>

<p>不合适</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i=i+<span class="number">1</span></span><br><span class="line">submitted +=<span class="number">1</span></span><br><span class="line">x = x * <span class="number">2</span> - <span class="number">1</span></span><br><span class="line">hypot2 = x * x + y * y</span><br><span class="line">c = (a + b) * (a - b)</span><br></pre></td></tr></table></figure>
</li>
<li><p>函数注释应该使用常规的冒号使用规则。如果有 <code>-&gt;</code> 箭头的话，要在它两边加空格。（参见下面的 <a href="#函数注释">函数注释</a> 了解有关函数注释的更多细节）</p>
<p>合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">munge</span><span class="params">(input: AnyStr)</span>:</span> ...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">munge</span><span class="params">()</span> -&gt; PosInt:</span> ...</span><br></pre></td></tr></table></figure>

<p>不合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">munge</span><span class="params">(input:AnyStr)</span>:</span> ...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">munge</span><span class="params">()</span>-&gt;PosInt:</span> ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>在指明函数关键字参数或指明无注释函数参数默认值的等号 <code>=</code> 周围不要使用空格：</p>
<p>合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">complex</span><span class="params">(real, imag=<span class="number">0.0</span>)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> magic(r=real, i=imag)</span><br></pre></td></tr></table></figure>

<p>不合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">complex</span><span class="params">(real, imag = <span class="number">0.0</span>)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> magic(r = real, i = imag)</span><br></pre></td></tr></table></figure>

<p>不过，对于带有变量注释的默认参数，<strong>一定</strong>要在等号 <code>=</code> 周围使用空格：</p>
<p>合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">munge</span><span class="params">(sep: AnyStr = None)</span>:</span> ...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">munge</span><span class="params">(input: AnyStr, sep: AnyStr = None, limit=<span class="number">1000</span>)</span>:</span> ...</span><br></pre></td></tr></table></figure>

<p>不合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">munge</span><span class="params">(input: AnyStr=None)</span>:</span> ...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">munge</span><span class="params">(input: AnyStr, limit = <span class="number">1000</span>)</span>:</span> ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>通常不建议使用符合语句（将多条语句写在同一行）。</p>
<p>合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> foo == <span class="string">'blah'</span>:</span><br><span class="line">    do_blah_thing()</span><br><span class="line">do_one()</span><br><span class="line">do_two()</span><br><span class="line">do_three()</span><br></pre></td></tr></table></figure>

<p>最好不要：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> foo == <span class="string">'blah'</span>: do_blah_thing()</span><br><span class="line">do_one(); do_two(); do_three()</span><br></pre></td></tr></table></figure>
</li>
<li><p>然而有的时候，把一条简短的 if/for/while 语句放在一行是可以的。对于多子句语句，永远不要这样做。同时要避免合并比较长的行。</p>
<p>最好不要：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> foo == <span class="string">'blah'</span>: do_blah_thing()</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> lst: total += x</span><br><span class="line"><span class="keyword">while</span> t &lt; <span class="number">10</span>: t = delay()</span><br></pre></td></tr></table></figure>

<p>绝对不要：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> foo == <span class="string">'blah'</span>: do_blah_thing()</span><br><span class="line"><span class="keyword">else</span>: do_non_blah_thing()</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>: something()</span><br><span class="line"><span class="keyword">finally</span>: cleanup()</span><br><span class="line"></span><br><span class="line">do_one(); do_two(); do_three(long, argument,</span><br><span class="line">                             list, like, this)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> foo == <span class="string">'blah'</span>: one(); two(); three()</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="何时使用收尾逗号"><a href="#何时使用收尾逗号" class="headerlink" title="何时使用收尾逗号"></a>何时使用收尾逗号</h1><p>收尾逗号通常是可写可不写的，除了在只有一个元素的元组中（而且在 Python 2 的 <code>print</code> 语句中有特殊语义）。为了能表达清楚，还建议使用括号将后面的情况括起来（这在技术上是冗余的）。</p>
<p>合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FILES = (<span class="string">'setup.cfg'</span>,)</span><br></pre></td></tr></table></figure>

<p>可以，但是比较迷惑：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FILES = <span class="string">'setup.cfg'</span>,</span><br></pre></td></tr></table></figure>

<p>当列表中的值、参数或导入的项目慢慢扩展时，冗余的收尾逗号，常常对版本控制系统很有用。这种模式把每一个值（等）本身作为一行插入，总是增加一个收尾逗号，并且在下一行增加回圆括号/方括号/大括号。不过对于写在一行的定界符就没有必要使用收尾逗号了（上面说的单元素元组除外）。</p>
<p>合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FILES = [</span><br><span class="line">    <span class="string">'setup.cfg'</span>,</span><br><span class="line">    <span class="string">'tox.ini'</span>,</span><br><span class="line">    ]</span><br><span class="line">initialize(FILES,</span><br><span class="line">           error=<span class="literal">True</span>,</span><br><span class="line">           )</span><br></pre></td></tr></table></figure>

<p>不合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FILES = [<span class="string">'setup.cfg'</span>, <span class="string">'tox.ini'</span>,]</span><br><span class="line">initialize(FILES, error=<span class="literal">True</span>,)</span><br></pre></td></tr></table></figure>

<h1 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h1><p>与代码相矛盾的注释还不如没有。每次更改代码，最想想到的必须是更新注释！</p>
<p>注释应该是完整的句子。第一个单词的首字母要大写，除非它是一个以小写字母开头的标识符（永远不要改变标识符的大小写！）。</p>
<p>块注释通常由一段或多段完整的句子构成，每个完整的句子都要以句号结尾。</p>
<p>在多个句子构成的注释中，除了最后一句之外，每一句的结尾句号之后都要加两个空格。</p>
<p>书写英语时，请遵守 Strunk and White[^12] 书写规范</p>
<p>那些非英语国家的程序员们：请用英语写注释，除非你 120% 确定你的代码不会被不懂你的语言的人使用。</p>
<h2 id="块注释"><a href="#块注释" class="headerlink" title="块注释"></a>块注释</h2><p>块注释通常和它后面的一些（或全部）代码有关，应该与那些相关的代码处于同一级缩进。块注释的每一行都以一个井字符 <code>#</code> 和一个空格开头（除非它是注释内的缩进文本）。</p>
<p>每一段行内注释之间以一个只包含一个井字符 <code>#</code> 的空行分隔开。</p>
<h2 id="行内注释"><a href="#行内注释" class="headerlink" title="行内注释"></a>行内注释</h2><p>尽量少用行内注释。</p>
<p>行内注释指的是与某条语句出在同一行的注释。行内注释与程序语句之间至少要用两个空格分隔。行内注释应该以一个井字符 <code>#</code> 和一个空格开头。</p>
<p>行内注释是不必要的。而且如果它仅仅是一句废话的话，就很容易让人分心了。不要做这种事：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x = x + <span class="number">1</span>                 <span class="comment"># 给x加一</span></span><br></pre></td></tr></table></figure>

<p>不过有时候，这样的注释很有用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x = x + <span class="number">1</span>                 <span class="comment"># 补偿边界</span></span><br></pre></td></tr></table></figure>

<h2 id="文档字符串"><a href="#文档字符串" class="headerlink" title="文档字符串"></a>文档字符串</h2><p>书写规范的文档字符串[^13]的规范被记载在 <a href="https://www.python.org/dev/peps/pep-0257" target="_blank" rel="noopener">PEP 257</a> 中。</p>
<ul>
<li><p>应该给所有的公共模块、函数、类和方法写文本字符串。对于非公共方法是不必写文档字符串的，但是你应该使用注释来描述那些方法到底是做什么的。这种注释应该出现在 <code>def</code> 下面的那一行</p>
</li>
<li><p><a href="https://www.python.org/dev/peps/pep-0257" target="_blank" rel="noopener">PEP 257</a> 描述了好的文档字符串规范是什么样的。千万注意，多行文档字符串最后的三个双引号 <code>&quot;&quot;&quot;</code> 应该但独占一行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""Return a foobang</span></span><br><span class="line"><span class="string">Optional plotz says to frobnicate the bizbaz first.</span></span><br><span class="line"><span class="string">抱歉，这一段话翻译不出来...</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>至于单行文档字符串，请把三个回引号 <code>&quot;&quot;&quot;</code> 也放在那一行。</p>
</li>
</ul>
<h1 id="命名规范"><a href="#命名规范" class="headerlink" title="命名规范"></a>命名规范</h1><p>Python 库的命名规范有一点乱，所以我们永远不可能对此达成共识。尽管如此，这里还是提供了当前推荐的明明标准。新的模块和包（包括第三方框架）应该按照这些标准来写。但是对于那些使用了不同格式的已有的库，还是倾向于与其内部使用的规则保持一致。</p>
<h2 id="最高原则"><a href="#最高原则" class="headerlink" title="最高原则"></a>最高原则</h2><p>用户可见的公共 API 接口，应该按照能够反映出用途的方式命名，而非一定按照规则来。</p>
<h2 id="描述性：命名样式"><a href="#描述性：命名样式" class="headerlink" title="描述性：命名样式"></a>描述性：命名样式</h2><p>有很多不同的命名样式。能够通过命名样式大致了解一个名称的功能，会很有帮助。</p>
<p>命名样式通常分为下面这些类：</p>
<ul>
<li><p><code>b</code> （单个小写字母）</p>
</li>
<li><p><code>B</code> （单个大写字母）</p>
</li>
<li><p><code>lowercase</code> （小写字母）</p>
</li>
<li><p><code>lower_case_with_underscores</code> （带下划线的小写字母）</p>
</li>
<li><p><code>UPPERCASE</code> （大写字母）</p>
</li>
<li><p><code>UPPER_CASE_WITH_UNDERSCORES</code> （带下划线的大写字母）</p>
</li>
<li><p><code>CapitalizedWords</code> （每个单词首字母大写，或者叫标题词，也叫<strong>驼峰体</strong> – 之所以这么称呼是因为它起伏不平的单词外观就像骆驼的驼峰一样[^4]）。这种样式也被称作“猛男体”。</p>
<p>注意：对于首字母缩写的单词，如果要用到驼峰体，那么每个缩写的首字母都要大写。因此 <code>HTTPServerError</code> 这种写法要比 <code>HttpServerError</code> 更恰当。</p>
</li>
<li><p><code>mixedCase</code> （混合使用大小写，与首字母大写的驼峰体不同的是，它的第一个字母是小写的！）</p>
</li>
<li><p><code>Capitalized_Words_With_Underscores</code> （带下划线的首字母大写，丑！）</p>
</li>
</ul>
<p>还有一种样式，使用一个独特的前缀来把相关的名称分组。这种样式在 Python 中并不常见，但是为了完整起见，还是在这里提上一嘴。例如， <code>os.stat()</code> 函数的返回值是一个元组，它的元素按传统呈现 <code>st_mode</code>、<code>st_size</code>、<code>st_mtime</code> ，等等的样子。（这样做主要是为了和计算机环境可移植操作系统接口，POSIX系统的格式保持一致，这会帮助程序员更容易熟悉它的用法。）</p>
<p>X11库在它所有的公共方法中都加上了前缀X。众所周知，在 Python 中，这种样式是没有必要的。因为属性和方法的名字会以对象名为前缀，函数名会以模块名为前缀。</p>
<p>另外，下面这些使用下划线开头或结尾的样式值得好好看看（这些样式可以和任何一种大小写样式结合使用）：</p>
<ul>
<li><p><code>_single_leading_underscore</code>：单下划线开头的是弱“内部使用”标识符。例如，<code>from M import *</code> 不会导入以单下划线开头的名称。</p>
</li>
<li><p><code>single_trailing_underscore_</code>：单下划线结尾的名称习惯上用来避免和 Python 关键字冲突，例如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tkinter.Toplevel(master, class_=<span class="string">'ClassName'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>__double_leading_underscore</code>：双下划线开头的变量名用来明明类属性，会引发名称校正（在 FooBar 类中， <code>__boo</code> 会变成 <code>_FooBar__boo</code>，参见下面的内容）。</p>
</li>
<li><p><code>__double_leading_and_trailing_underscore__</code>：以双下划线开头和结尾的是存在于用户操控的名称空间的魔法对象或方法。例如： <code>__init__</code>、<code>__import__</code> 或 <code>__file__</code>。永远不要自己创造这类名称，一定按照文档说明使用它们。</p>
</li>
</ul>
<h2 id="约定俗成：名称传统"><a href="#约定俗成：名称传统" class="headerlink" title="约定俗成：名称传统"></a>约定俗成：名称传统</h2><h3 id="避免使用的名称"><a href="#避免使用的名称" class="headerlink" title="避免使用的名称"></a>避免使用的名称</h3><p>永远不要用<code>l</code>（L 的小写字母）、<code>O</code>（o 的大写字母）或 <code>I</code> （i 的大写字母）作为单字符变量名。</p>
<p>有些字体的这些字母很难和数字一和零区分。如果要使用<code>l</code>，请使用 <code>L</code> 代替。</p>
<h3 id="ASCII-兼容"><a href="#ASCII-兼容" class="headerlink" title="ASCII 兼容"></a>ASCII 兼容</h3><p>标准库中的标识符必须兼容 ASCII，就像在 <a href="https://www.python.org/dev/peps/pep-3131" target="_blank" rel="noopener">PEP 3131</a> 的 <a href="https://www.python.org/dev/peps/pep-3131/#policy-specification" target="_blank" rel="noopener">方针部分</a> 中描述的那样。</p>
<h3 id="包和模块名"><a href="#包和模块名" class="headerlink" title="包和模块名"></a>包和模块名</h3><p>模块名应该全部小写，并且越短越好。如果能提高可读性的话，可以在模块名中加下划线。Python 包的名字也应该全部消息，越短越好。不过还是断了在包的名字中使用下划线的念头吧。</p>
<p>使用 C 或 C++ 写的扩展模块有一个伴随的 Python 模块提供高级（例如，更加面向对象）接口，这些 C/C++ 模块名要以但下划线开头（例如， <code>_socket</code>）。</p>
<h3 id="类名"><a href="#类名" class="headerlink" title="类名"></a>类名</h3><p>类名通常使用驼峰体。</p>
<p>方法的命名规则可能要使用特定文档要求的接口名称，以确保能够被正确调用。</p>
<p>需要注意的是，内置方法名有不同的样式：大多数内置方法使用单个单词（或者两个合在一起的单词），驼峰体样式的方法名仅仅在一些例外和内置常数中使用。</p>
<h3 id="Type变量名"><a href="#Type变量名" class="headerlink" title="Type变量名"></a>Type变量名</h3><p>在 <a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener">PEP 484</a> 中引入的 type 变量通常使用简写的驼峰体名称：<code>T</code>、<code>AnyStr</code>、<code>Num</code>。声明具有相同（covariant）或相反（contravariant）变化趋势的变量名时，建议在变量名后相应地加上 <code>_co</code> 或 <code>_contra</code> 后缀：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypeVar</span><br><span class="line"></span><br><span class="line">VT_co = TypeVar(<span class="string">'VT_co'</span>, covariant=<span class="literal">True</span>)</span><br><span class="line">KT_contra = TypeVar(<span class="string">'KT_contra'</span>, contravariant=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h3 id="异常类名"><a href="#异常类名" class="headerlink" title="异常类名"></a>异常类名</h3><p>因为异常一般是类，所以应该遵循类的命名规则。只是，应该在在异常的名字前加上“Error”前缀（如果异常确实是一个错误的话）。</p>
<h3 id="全局变量名"><a href="#全局变量名" class="headerlink" title="全局变量名"></a>全局变量名</h3><p>（让我们祈祷这些变量只用在一个模块内部。）全局变量的命名规范和函数的规则相同。</p>
<p>那些需要通过 <code>from M import *</code> 方式导入的模块，应该使用 <code>__all__</code> 方法来阻止输出全局变量。也可以使用古老些的规则，在这些全局变量的名字前加上一个下划线前缀（用来指明这些全局变量是“仅供本模块内部使用”的）。</p>
<h3 id="函数和变量名"><a href="#函数和变量名" class="headerlink" title="函数和变量名"></a>函数和变量名</h3><p>函数名应该全部小写。按照需要，使用下划线分隔每个单词，以增加可读性。</p>
<p>变量应该遵循与函数相同的命名规则。</p>
<p>混用大小写的变量名仅仅当代码中已经大量使用这种格式风格的时候（例如在 threading.py 中）使用，以保持向上的兼容性。</p>
<h3 id="函数和方法的参数"><a href="#函数和方法的参数" class="headerlink" title="函数和方法的参数"></a>函数和方法的参数</h3><p>永远使用 <code>self</code> 作为实例方法的第一个参数。</p>
<p>永远使用 <code>cls</code> 作为类方法的第一个参数</p>
<p>如果某个函数的参数名与 Python 中预留关键字冲突，通常最好在它后面加一个但下划线尾巴，而不是使用缩写或错误拼写。因此，<code>class_</code> 要比好。（或者更好的办法是使用同义词来避免这样的冲突。）</p>
<h3 id="方法名和实例变量"><a href="#方法名和实例变量" class="headerlink" title="方法名和实例变量"></a>方法名和实例变量</h3><p>使用函数命名规则：全部小写字母，在必要地方使用下划线分隔以提高可读性。</p>
<p>在非公共的方法或实例变量前使用但下划线开头。</p>
<p>为了避免和子类中的属性重名，使用双下划线开头来启用 Python 的命名校正规则。</p>
<p>Python 会用类名对这些属性名进行校正：如果 Foo 类有一个名为 <code>__a</code> 的属性，我们无法在外部通过 <code>Foo.__a</code> 方式调用它。（某个固执的朋友或许仍然可以通过调用 <code>Foo._Foo__a</code> 来访问该属性）。通常，双下划线开头的名称只用来避免和子类中的属性名冲突。</p>
<p>注意：关于如何使用双下划线开头的名字有些争议（下面有讨论）。</p>
<h3 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h3><p>常量通常在模块级的位置定义，全部字母大写，以下划线分隔每个单词。例如：<code>MAX_OVERFLOW</code> 和 <code>TOTAL</code>。</p>
<h3 id="继承设计"><a href="#继承设计" class="headerlink" title="继承设计"></a>继承设计</h3><p>一定要搞清楚类中的方法和实例变量（统称“属性”）到底应该是共有的还是非公有的。如果不确定的话，把它视为非公有的。把非公有属性变成公有属性要比把共有属性变成非公有的容易些。</p>
<p>公有属性指的是你想要让一些其他不相关的类也可以使用的属性，你需要确保避免与向上兼容性冲突的改变。非公有属性指的是你不打算让第三方使用的属性。你不必要求私有属性不能改变，甚至你把它删除掉也没有关系。</p>
<p>在这里我们没有使用“私有”这个术语，因为在 Python 中没有哪个属性是真正私有的（不必做无用功）。</p>
<p>还有一种部分属于“子类 API”的属性（在其他语言中，通常被称作“被保护的”）。一些类被设计成能够供其他类继承的形式，来扩展或装饰类的功能。在设计这种类时，仔细区分哪些属性该是共有的，也就是子类 API 的一部分，以及哪些类真的只会在基类中使用。</p>
<p>牢记这些 Pythonic 的规则：</p>
<ul>
<li><p>公有属性不应该以下划线开头。</p>
</li>
<li><p>如果你的公有属性名和预留关键字冲突，在你的属性名后面加上一个下划线结尾。这比使用缩写或错误拼写更合适（尽管如此，“cls”是变量或参数比较恰当的拼写，因为大家都知道它表示一个类，尤其是作为类方法的第一个变量时）</p>
<p>注意 1：阅读前文了解类方法参数的命名建议。</p>
</li>
<li><p>对于简单的公有数据属性，最好直接使用属性名，而不是复合调用者/扩展者的方法名。不要忘了 Python 程序未来扩展起来是十分方便的。不久的将来，你很可能会给这些数据进行扩展，这样方法名会越来越长，你得为此提前做好准备。在那时，使用简单地数据属性接口语句代替其背后复杂的程序过程。</p>
<p>注意 1：属性仅适用于新式类中。</p>
<p>注意 2：尽量保证函数表现得没有副作用，尽管像缓存存储之类的副作用通常是无妨的。</p>
<p>注意 3：避免用属性进行计算密集型的操作。属性往往会让调用者先入为主地以为访问它（相对而言）不会占用很多资源。</p>
</li>
<li><p>如果你要定义的类可能会有子类，而且这个类里面有某些属性你不希望被子类继承，可以考虑使用双下划线开头来命名这些属性，不过不要同时加结尾的双下划线。这样做会引发 Python 的名称校正算法，属性名会被用类名进行校正。这种校正帮助我们避免子类无意间包含与父类中同名的方法而造成的名称冲突。</p>
<p>注意 1：校正后的名字其实只是把类名简简单单放到属性名前面。所以如果子类的类名和方法名都和父类相同，名称冲突还是会存在的。</p>
<p>注意 2：名称校正在真正使用的时候，比如调试和 <code>__getattr__()</code>，可能会不太方便。好在名称校准的算法已经很明确且完善了，手动推导也是很容易的。</p>
<p>注意 3：并非所有人都喜欢名称校正。尽量在避免意外的名称冲突和潜在的广大调用者的喜好之间找到平衡。</p>
</li>
</ul>
<h2 id="公共和内部接口"><a href="#公共和内部接口" class="headerlink" title="公共和内部接口"></a>公共和内部接口</h2><p>任何的向上兼容性的保证仅适用于公共接口。于是，让用户能够清楚区分公共和内部接口是很重要的。</p>
<p>文档中提及的接口被认为是公共接口，除非文档明确声明它们是从通常的向上兼容保证中豁免的临时的或内部接口。所有文档中未提及的接口都应该被假定为内部接口。</p>
<p>为了提高可读性，模块应该使用 <code>__all__</code>属性明确声明它们公共 API 的名称。设置 <code>__all__</code> 为一个空列表表明该模块没有公共 API。</p>
<p>即便已经设置妥当，内部接口（包、模块、类、函数、属性或其他的名称）名称仍应该使用单下划线开头。</p>
<p>内部接口命名空间（包、模块或类）里面的接口也被视为内部属性。</p>
<p>一定要给导入的模块名斟酌一个详细的操作说明。其他模块一定不能依赖于间接访问这些模块名，除非它们是包含于这些模块 API 中的明文指出的部分，比如在 <code>os.path</code> 或一个包的 <code>__init__</code> 模块中公开功能的子模块。</p>
<h1 id="编程建议"><a href="#编程建议" class="headerlink" title="编程建议"></a>编程建议</h1><ul>
<li><p>代码的编写不应该阻碍其他 Python 操作的执行（PyPy、Jython、IronPython、Cython、Psyco，诸如此类）。</p>
<p>例如，不要依赖 CPython 中高效的原地字符串拼接操作，也就是 <code>a += b</code> 或 <code>a = a + b</code> 这种表达式。这种简便写法即便在 CPython 中也是容易出错的（只在某些情况有效），在不使用引用计数的操作中干脆不能使用。在标准库中对性能比较敏感的部分，应该使用 <code>&#39;&#39;.join()</code> 格式代替上面说的字符串拼接方法。这种格式能确保在不同的操作中，字符串的拼接都能稳定执行。</p>
</li>
<li><p>与单个数值例如 None 作比较时，永远要使用 <code>is</code> 或者 <code>is not</code> 来完成，而不是使用等号比较。</p>
<p>同时，如果你想要表达 <code>if x is not None</code>，却直接把表达式写成 <code>if x</code>的时候，你可要当心了。比如，在测试一个默认值为 None 的变量或参数是否被赋予其他值的时候。其他值也可能是布尔属性为假的数据类型（比如空的容器）！</p>
</li>
<li><p>使用 <code>is not</code> 运算符而不是 <code>not ... is</code>。尽管两个表达式在功能上没有分别，但是前一种写法可读性更高，也更广为接受。</p>
<p>合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> foo <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br></pre></td></tr></table></figure>

<p>不合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> foo <span class="keyword">is</span> <span class="literal">None</span>:</span><br></pre></td></tr></table></figure>
</li>
<li><p>当进行比较密集型的排序操作时，最好补齐测试全部六种比较运算符（<code>__eq__</code>、<code>__ne__</code>、<code>__lt__</code>、<code>__le__</code>、<code>__gt__</code>、<code>__ge__</code>），而不是依赖于其他代码而仅练习某一种比较。</p>
<p><code>functools.total_ordering()</code> 装饰器提供一个生成缺失的比较方法的工具，使用它可以最大限度地减少操作量。</p>
<p><a href="https://www.python.org/dev/peps/pep-0207" target="_blank" rel="noopener">PEP 207</a> 指出，Python <em>确实</em> 采用了反身性规则。因此，解释器或许会将 <code>y &gt; x</code> 反转为 <code>x &lt; y</code>，<code>y &gt;= x</code> 反转为 <code>x &lt;= y</code>。而且，也许会反转 <code>x == y</code> 和 <code>x != y</code> 语句。在 <code>sort()</code> 和 <code>min()</code> 操作中使用 <code>&lt;</code> 运算符，以及在 <code>max()</code> 函数中使用 <code>&gt;</code> 运算符是很保险的。不过，最好还是测试全部六种运算符，以确保其他上下文语句不会产生异常。</p>
</li>
<li><p>如果想要将 lambda 表达式直接和标识符关联，一定要使用 def 语句而不是赋值语句。</p>
<p>合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span> <span class="keyword">return</span> <span class="number">2</span>*x</span><br></pre></td></tr></table></figure>

<p>不合适：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="keyword">lambda</span> x: <span class="number">2</span>*x</span><br></pre></td></tr></table></figure>

<p>第一种格式意味着新得到的函数对象的名字是明确的“ f ”，而不是笼统的“&lt;lambda&gt;”。通常，这对于回溯调试和使用字符串描述都很有用。使用赋值语句丧失了一个 lambda 表达式相对于明确的 def 语句最核心的优点（比如，它能嵌套进其他表达式的内部）。</p>
</li>
<li><p>通过继承 <code>Exception</code> 类来派生异常，而不是<code>BaseException</code> 类。直接继承自 <code>BaseException</code> 的类被预留给那些差不多永远也不应该被捕获的异常。</p>
<p>设计异常继承关系应该基于使用代码捕获到需要进行的改进操作，而不是仅仅找到异常抛出的位置。尽量有条理地回答“发生了什么错误”的问题，而不是隔靴搔痒般地陈述“出现了一个问题”（参见 <a href="https://www.python.org/dev/peps/pep-3151" target="_blank" rel="noopener">PEP 3151</a>，有一个从内置的异常继承关系中学到的关于此的例子）。</p>
<p>类的命名规则在此是使用的，而且如果异常是一个错误，应该给其加上“Error”前缀。用来进行非局部流控制或其他类型的信号之类的非错误异常无需加特别地前缀。</p>
</li>
<li><p>合理使用异常链。在 Python 3 中，<code>raise X from Y</code> 应该被用来表示明确的不会丢失原始错误信息回溯的替换。</p>
<p>经过深思熟虑后，当真需要替换内部异常（在 Python 2 中使用 <code>raise X</code> 或者在 Python 3.3+ 中使用 <code>raise X from None</code>）的时候，留意转换成新异常过程中的细节（比如当将 <code>KeyError</code> 替换成 <code>AttributeError</code> 时，不要忘了保留属性名，同时要把原来的错误文本替换成新的异常信息）。</p>
</li>
<li><p>在 Python 2 中抛出异常时，使用 <code>raise ValueError(&#39;message&#39;)</code> 格式，而不是过时的 <code>raise ValueError, &#39;message&#39;</code>。</p>
<p>后者在 Python 3 的语法中是不合法的。</p>
<p>使用括号的形式也意味着，当异常陈述很长，或者包含了字符串的格式化，你不必把它们全都写在一行。因为括号的存在，换行会很方便。</p>
</li>
<li><p>捕获异常时，尽可能指出明确的异常，而不是直接使用 <code>except:</code> 子句：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">import</span> platform_specific_module</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    platform_specific_module = <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>直接使用 <code>except:</code> 子句也会捕捉到 <code>SystemExit</code> 和 <code>KeyboardInterrupt</code> 异常，这样以来就无法使用 <code>Control-C</code> 终止程序，同时也会掩饰掉其他的麻烦。如果你想要捕获所有意味着程序错误的错误，使用 <code>except Exception:</code>（直接使用 except 等价于 <code>except BaseException:</code>）。</p>
<p>把直接使用“except”子句限制在两种情况是值得大拇指表扬的好习惯：</p>
<ol>
<li>如果一场句柄会被打印出来或者回溯信息会被日志记录下来，至少用户能够知道错误是发生了的。</li>
<li>如果代码需要一些清理工作，但是密集使用 <code>raise</code> 抛出异常。使用 <code>try...finally</code> 应对这种情况比较合理的方式。</li>
</ol>
</li>
<li><p>耦合捕获异常时，最好使用 Python 2.6 中加入的明确的名称耦合语法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    process_data()</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> exc:</span><br><span class="line">    <span class="keyword">raise</span> DataProcessingFailedError(str(exc))</span><br></pre></td></tr></table></figure>

<p>这是 Python 3 中唯一支持的语法。与旧版的基于逗号的语法相比，这种语法避免了模棱两可的问题。</p>
</li>
<li><p>捕获操作系统错误时，在指出 <code>errno</code> 数值的同时，最好使用 Python 3.3 中引入的明确的异常继承关系。</p>
</li>
<li><p>此外，对于所有的 try/except 子句，在满足需求的情况下，保证 <code>try</code> 子句中的代码尽可能的短。再次强调，这可能会错过隐藏的 bug。</p>
<p>合适的写法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    value = collection[key]</span><br><span class="line"><span class="keyword">except</span> KeyError:</span><br><span class="line">    <span class="keyword">return</span> key_not_found(key)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">return</span> handle_value(value)</span><br></pre></td></tr></table></figure>

<p>不合适的写法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 太宽泛了！</span></span><br><span class="line">    <span class="keyword">return</span> handle_value(collection[key])</span><br><span class="line"><span class="keyword">except</span> KeyError:</span><br><span class="line">    <span class="comment"># 也会捕获到 handle_value() 抛出的 KeyError</span></span><br><span class="line">    <span class="keyword">return</span> key_not_found(key)</span><br></pre></td></tr></table></figure>
</li>
<li><p>当某个资源仅在某一个特定部分的代码局部使用时，使用 <code>with</code> 语句确保它及时可靠地被清理掉了。使用 try/finally 语句也是可以接受的。</p>
</li>
<li><p>如果除了获取和释放资源还要处理其他的任务，就应该使用不同的函数或方法调用上下文管理器。</p>
<p>合适的写法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> conn.begin_transaction():</span><br><span class="line">    do_stuff_in_transaction(conn)</span><br></pre></td></tr></table></figure>

<p>不合适的写法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> conn:</span><br><span class="line">    do_stuff_in_transaction(conn)</span><br></pre></td></tr></table></figure>

<p>没有任何信息表明后一个例子的和方法除了事务结束后关闭连接还做了其他的事。在这种情况下，要尽可能的明确。</p>
</li>
<li><p>return 语句要保持一致。要么一个函数中所有的 return 语句都返回一个表达式，要么都不这么做。如果任何一个 return 语句返回一个表达式，任何没有值的 return 语句都应该明确陈述成 <code>return None</code>，而且一个明确的 return 语句应该在函数的末尾出现（如果可行的话）。</p>
<p>合适的写法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> x &gt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> math.sqrt(x)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> x &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> math.sqrt(x)</span><br></pre></td></tr></table></figure>

<p>不合适的写法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> x &gt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> math.sqrt(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> x &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">return</span> math.sqrt(x)</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用字符串方法而不是字符串模块。</p>
<p>字符串方法总是快很多，而且和 unicode 字符串使用相同的 API。如果需要向前兼容 Python 2.0 之前的版本的话，无视这条规则。</p>
</li>
<li><p>使用 <code>&#39;&#39;.startswith()</code> 和 <code>&#39;&#39;.endswith()</code> 而不是字符串切片检查前缀或后缀。<code>startswith()</code> 和 <code>endswith()</code> 更加简洁而且更不易出错：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">合适:   <span class="keyword">if</span> foo.startswith(<span class="string">'bar'</span>):</span><br><span class="line">  不合适:  <span class="keyword">if</span> foo[:<span class="number">3</span>] == <span class="string">'bar'</span>:</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 <code>isinstance()</code> 比较对象类型，而不是直接比较类型。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">合适:   <span class="keyword">if</span> isinstance(obj, int):</span><br><span class="line">不合适:  <span class="keyword">if</span> type(obj) <span class="keyword">is</span> type(<span class="number">1</span>):</span><br></pre></td></tr></table></figure>

<p>当判断一个对象是否是字符串时，不要忘了它也有可能是 unicode 字符串！在 Python 2 中，<code>str</code> 和 <code>unicode</code> 有一个共同的基类，<code>basestring</code>。所以可以这样做：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> isinstance(obj, basestring):</span><br></pre></td></tr></table></figure>

<p>注意在 Python 3 中，<code>unicode</code> 和 <code>basestring</code> 不复存在了（只有 <code>str</code>）而且字节对象不再是一种字符串（不过它是一串数字）。</p>
</li>
<li><p>对于序列（字符串，列表，元组），不要忽略空序列代表假。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">合适:    <span class="keyword">if</span> <span class="keyword">not</span> seq:</span><br><span class="line">        <span class="keyword">if</span> seq:</span><br><span class="line"></span><br><span class="line">不合适:  <span class="keyword">if</span> len(seq):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> len(seq):</span><br></pre></td></tr></table></figure>
</li>
<li><p>不要在字符串的末尾过度使用空格。这种结尾的空格视觉上是不可见的，而且有些编辑器（或者更常见的，使用 reindent.py）会把它们直接切掉。</p>
</li>
<li><p>不要使用 <code>==</code> 与 True 或 False 比较布尔值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">合适:   <span class="keyword">if</span> greeting:</span><br><span class="line">不合适: <span class="keyword">if</span> greeting == <span class="literal">True</span>:</span><br><span class="line">更糟糕: <span class="keyword">if</span> greeting <span class="keyword">is</span> <span class="literal">True</span>:</span><br></pre></td></tr></table></figure>
</li>
<li><p>不要在 <code>try...finally</code> 套件中使用流程控制语句 <code>return</code>/<code>break</code>/<code>continue</code>，这些流程控制语句可能会跳出 finally 套件。因为这些语句会隐藏掉 finally 套件中活跃的异常。</p>
<p>不要这样做：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="number">1</span> / <span class="number">0</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">42</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="函数注释"><a href="#函数注释" class="headerlink" title="函数注释"></a>函数注释</h2><p>为了和 <a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener">PEP 484</a> 兼容，函数注释的格式规则正在被修订。</p>
<ul>
<li><p>为保证向前的兼容性，Python 3 代码中的函数注释最好使用 <a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener">PEP 484</a> 语法。（前面部分有一些关于注释的格式建议。）</p>
</li>
<li><p>本 PEP 从前建议的注释格式的尝试不再提倡。</p>
</li>
<li><p>然而，除了标准库之外，现在更提倡 <a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener">PEP 484</a> 中的规则尝试。例如，使用 <a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener">PEP 484</a> 格式书写注释标记大量的第三方库或应用，就知道使用这些注释是多么简单了，而且这种格式的代码更加容易理解。</p>
</li>
<li><p>Python 标准库不应使用这种注释。但是对于新的代码和大的代码重构来说是允许使用的。</p>
</li>
<li><p>对于想要使用函数注释进行不同用途的代码，建议再上一个陈述类型的注释：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># type: ignore</span></span><br></pre></td></tr></table></figure>

<p>靠近文件的最顶部。这告诉类型检查器忽略掉所有的注释。（规避类型检查器更加精细的方法可以在 <a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener">PEP 484</a> 中找到。）</p>
</li>
<li><p>像轧毛机一样，类型检查器是可选的，独立的工具。默认的 Python 解释器不应因类型检查而抛出信息，而且也不应该基于注释选择它们的行为。</p>
</li>
<li><p>不想使用类型检查器的用户大可无视它们。然而，对于使用需要在包中运行类型检查器的第三方库包的用户来说，还是需要遵守规则的。对于这种情况，建议使用存根文件：.pyi 文件比 .py 文件更受类型检查器青睐。存根文件可以使用一个库分发，也可以用 typeshed repo[^5] 分解（在库作者的许可下）。</p>
</li>
<li><p>对于需要向上兼容的代码，类型注释可以以单行注释的形式加入。参见中 <a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener">PEP 484</a> [^6]的相关部分。</p>
</li>
</ul>
<h2 id="变量注释"><a href="#变量注释" class="headerlink" title="变量注释"></a>变量注释</h2><p><a href="https://www.python.org/dev/peps/pep-0526" target="_blank" rel="noopener">PEP 526</a> 介绍了变量注释。它们的格式建议和上面谈到的函数注释很像：</p>
<ul>
<li><p>模块级变量，类和实例变量以及局部变量的注释，应该在冒号后面留一个空格。</p>
</li>
<li><p>冒号前不应该有空格。</p>
</li>
<li><p>如果右手边有赋值式，等号两边都要有且只有一个空格。</p>
</li>
<li><p>合适的写法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">code: int</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span>:</span></span><br><span class="line">    coords: Tuple[int, int]</span><br><span class="line">    label: str = <span class="string">'&lt;unknown&gt;'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>不合适的写法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">code:int  <span class="comment"># 冒号后没有空格</span></span><br><span class="line">code : int  <span class="comment"># 冒号前有个空格</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span>:</span></span><br><span class="line">    result: int=<span class="number">0</span>  <span class="comment"># 等号两边没有空格</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>虽然 <a href="https://www.python.org/dev/peps/pep-0526" target="_blank" rel="noopener">PEP 526</a> 是适配于 Python 3.6 版本的，这些变量注释语法是所有版本 Python 存根文件的首选语法（更多细节，参见 <a href="https://www.python.org/dev/peps/pep-0484" target="_blank" rel="noopener">PEP 484</a>）。</p>
</li>
</ul>
<h1 id="版权"><a href="#版权" class="headerlink" title="版权"></a>版权</h1><p>原文档无版权限制，翻译文档亦供大家随意取用，引用尽量注明出处。</p>
<p>文档来源： <a href="https://github.com/python/peps/blob/master/pep-0008.txt" target="_blank" rel="noopener">https://github.com/python/peps/blob/master/pep-0008.txt</a></p>
<h1 id="参考文献及译注"><a href="#参考文献及译注" class="headerlink" title="参考文献及译注"></a>参考文献及译注</h1><p>[^1]: <a href="https://www.python.org/dev/peps/pep-0007" target="_blank" rel="noopener">PEP 7</a>，C 语言代码格式规则，van Rossum<br>[^2]: Barry 的 GNU Mailman 格式规则 <a href="http://barry.warsaw.us/software/STYLEGUIDE.txt" target="_blank" rel="noopener">http://barry.warsaw.us/software/STYLEGUIDE.txt</a><br>[^3]: Donald Knuth 的 <em>The TeXBook</em>，195 和196 页<br>[^4]: <a href="http://www.wikipedia.com/wiki/CamelCase" target="_blank" rel="noopener">http://www.wikipedia.com/wiki/CamelCase</a><br>[^5]: Typeshed repo <a href="https://github.com/python/typeshed" target="_blank" rel="noopener">https://github.com/python/typeshed</a><br>[^6]: Suggested syntax for Python 2.7 and straddling code <a href="https://www.python.org/dev/peps/pep-0484/#suggested-syntax-for-python-2-7-and-straddling-code" target="_blank" rel="noopener">https://www.python.org/dev/peps/pep-0484/#suggested-syntax-for-python-2-7-and-straddling-code</a></p>
<p>[^7]:悬挂缩进是一种段落格式。在悬挂缩进的一段话中，除第一行外，其他每一行都缩进相同距离。在 Python 语境中，这种情况表示的是，第一行最后一个非空白字符后暗含一个左括号。括号中的内容在下面悬挂缩进，直到括号中的内容结束。最后一行的最后一个非空白字符后暗含一个右括号。<br>[^8]: dummy implementations<br>[^9]: overwriting a pure Python implementation Python of an interface with the definitions from an optional accelerator module and exactly which definitions will be overwritten isn’t known in advance<br>[^10]: Pet Peeves<br>[^11]: augmented assignment<br>[^12]: The Elements of Style。维基百科连接：<a href="https://en.wikipedia.org/wiki/The_Elements_of_Style；百度文库连接：https://wenku.baidu.com/view/982a59620b1c59eef8c7b40c.html" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/The_Elements_of_Style；百度文库连接：https://wenku.baidu.com/view/982a59620b1c59eef8c7b40c.html</a><br>[^13]: documentation strings（亦称作：docstrings） </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/python-basic/f-strings/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/python-basic/f-strings/" class="post-title-link" itemprop="url">f-strings 详解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 14:38:51" itemprop="dateCreated datePublished" datetime="2020-02-15T14:38:51+08:00">2020-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-29 10:34:01" itemprop="dateModified" datetime="2020-02-29T10:34:01+08:00">2020-02-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">Python 基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><code>f-strings</code> 在 <a href="/python-basic/format">字符串格式化</a> 的那一部分已经有所讨论。其实当时已经讨论得差不多了，今天只是稍微地有一点点补充。主要还是复习。</p>
<p><code>f-strings</code> 的基本结构是这样的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">'宝元'</span></span><br><span class="line">age = <span class="number">18</span></span><br><span class="line">sex = <span class="string">'男'</span></span><br><span class="line">msg1 = F<span class="string">'姓名：&#123;name&#125;，性别：&#123;age&#125;，年龄：&#123;sex&#125;'</span>  <span class="comment"># 大写字母也可以</span></span><br><span class="line">msg = <span class="string">f'姓名：<span class="subst">&#123;name&#125;</span>，性别：<span class="subst">&#123;age&#125;</span>，年龄：<span class="subst">&#123;sex&#125;</span>'</span>   <span class="comment"># 建议小写</span></span><br><span class="line">print(msg)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">姓名：宝元，性别：<span class="number">18</span>，年龄：男</span><br></pre></td></tr></table></figure>

<p><code>f-strings</code> 就是在字符串的引号前面加上一个字母 <code>f</code>。字母大小写都可以，但是推荐使用小写。<code>{}</code> 中除了可以使用变量外，还可以放入函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(a,b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">msg = <span class="string">f"运行结果：<span class="subst">&#123;func(<span class="number">1</span>,<span class="number">2</span>)&#125;</span>"</span></span><br><span class="line">print(msg)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">运行结果：<span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>甚至可以在 <code>{}</code> 中放入 <code>input</code> 函数，让用户输入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">f"姓名：<span class="subst">&#123;input(<span class="string">'请输入姓名：'</span>)&#125;</span> 年龄：<span class="subst">&#123;input(<span class="string">'请输入年龄：'</span>)&#125;</span> 性别：<span class="subst">&#123;input(<span class="string">'请输入性别：'</span>)&#125;</span>"</span>)</span><br></pre></td></tr></table></figure>

<p>输出的结果是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">请输入姓名：alex</span><br><span class="line">请输入年龄：<span class="number">18</span></span><br><span class="line">请输入性别：男</span><br><span class="line">姓名：alex 年龄：<span class="number">18</span> 性别：男</span><br></pre></td></tr></table></figure>

<p>除了字符串，{} 中也可以放入列表和字典：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">lst = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">32</span>, <span class="number">34</span>, <span class="number">45</span>, <span class="number">5</span>]</span><br><span class="line">msg = <span class="string">f"运行结果：<span class="subst">&#123;lst[<span class="number">0</span>:<span class="number">3</span>]&#125;</span>"</span></span><br><span class="line">print(msg)</span><br><span class="line"></span><br><span class="line">dic = &#123;<span class="string">"key"</span>: <span class="number">1</span>, <span class="string">"key1"</span>: <span class="number">22</span>&#125;</span><br><span class="line">msg = <span class="string">f"运行结果：<span class="subst">&#123;dic[<span class="string">'key1'</span>]&#125;</span>"</span></span><br><span class="line">print(msg)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">运行结果：[<span class="number">1</span>, <span class="number">2</span>, <span class="number">32</span>]</span><br><span class="line">运行结果：<span class="number">22</span></span><br></pre></td></tr></table></figure>

<p><code>f-string</code> 可以写成多行的形式，但依然打印成一行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msg = <span class="string">f"窗前明月<span class="subst">&#123;<span class="string">'光'</span>&#125;</span>，"</span> \</span><br><span class="line">      <span class="string">f"玻璃好上<span class="subst">&#123;<span class="string">'霜'</span>&#125;</span>。"</span> \</span><br><span class="line">      <span class="string">f"要不及时<span class="subst">&#123;<span class="string">'擦'</span>&#125;</span>，"</span> \</span><br><span class="line">      <span class="string">f"一会就得<span class="subst">&#123;<span class="string">'脏'</span>&#125;</span>。"</span></span><br><span class="line">print(msg)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">窗前明月光，玻璃好上霜。要不及时擦，一会就得脏。</span><br></pre></td></tr></table></figure>

<p>要想打印多行字符串，还是要使用三对引号：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">msg = <span class="string">f"""</span></span><br><span class="line"><span class="string">窗前明月<span class="subst">&#123;<span class="string">'光'</span>&#125;</span>,</span></span><br><span class="line"><span class="string">玻璃好上<span class="subst">&#123;<span class="string">'霜'</span>&#125;</span>.</span></span><br><span class="line"><span class="string">要不及时<span class="subst">&#123;<span class="string">'擦'</span>&#125;</span>,</span></span><br><span class="line"><span class="string">一会就得<span class="subst">&#123;<span class="string">'脏'</span>&#125;</span>.</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">print(msg)</span><br></pre></td></tr></table></figure>

<p>通过使用三元运算，配合 f-strings，我们可以进一步节省代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">10</span></span><br><span class="line">b = <span class="number">20</span></span><br><span class="line">msg = <span class="string">f"<span class="subst">&#123;a <span class="keyword">if</span> a &lt; b <span class="keyword">else</span> b&#125;</span>"</span></span><br><span class="line">print(msg)</span><br></pre></td></tr></table></figure>

<p>同时使用两个括号表示一个可以打印的大括号：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msg = <span class="string">f"&#123;&#123;'alex': 'wusir'&#125;&#125;"</span></span><br><span class="line">print(msg)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">'alex'</span>: <span class="string">'wusir'</span>&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/python-basic/format/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/python-basic/format/" class="post-title-link" itemprop="url">format</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 14:37:38" itemprop="dateCreated datePublished" datetime="2020-02-15T14:37:38+08:00">2020-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-26 19:27:17" itemprop="dateModified" datetime="2020-02-26T19:27:17+08:00">2020-02-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">Python 基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>字符串格式化的几个方法，用来动态生成字符串。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/python-basic/format/">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/translation/raspberry-gpio-python-examples/raspberry-gpio-python-examples/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/translation/raspberry-gpio-python-examples/raspberry-gpio-python-examples/" class="post-title-link" itemprop="url">raspberry-gpio-python模块使用实例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 13:55:24" itemprop="dateCreated datePublished" datetime="2020-02-15T13:55:24+08:00">2020-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-21 17:36:44" itemprop="dateModified" datetime="2020-02-21T17:36:44+08:00">2020-02-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91/" itemprop="url" rel="index"><span itemprop="name">官方文档翻译</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>GPIO 模块的 python 程序实例入口</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/translation/raspberry-gpio-python-examples/raspberry-gpio-python-examples/">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/translation/raspberry-gpio-python-examples/PWM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/translation/raspberry-gpio-python-examples/PWM/" class="post-title-link" itemprop="url">使用 RPi.GPIO 中的 PWM</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 13:55:14" itemprop="dateCreated datePublished" datetime="2020-02-15T13:55:14+08:00">2020-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-29 10:34:01" itemprop="dateModified" datetime="2020-02-29T10:34:01+08:00">2020-02-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91/" itemprop="url" rel="index"><span itemprop="name">官方文档翻译</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>创建一个 PWM 实例对象：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p = GPIO.PWM(channel, frequency)</span><br></pre></td></tr></table></figure>

<p>启动 PWM：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.start(dc)   <span class="comment"># dc 指代占空比 (0.0 &lt;= dc &lt;= 100.0)</span></span><br></pre></td></tr></table></figure>

<p>更改频率：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.ChangeFrequency(freq)   <span class="comment"># freq 指代新频率值，单位是 Hz</span></span><br></pre></td></tr></table></figure>

<p>To change the duty cycle:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.ChangeDutyCycle(dc)  <span class="comment"># 0.0 &lt;= dc &lt;= 100.0</span></span><br></pre></td></tr></table></figure>

<p>停止 PWM：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.stop()</span><br></pre></td></tr></table></figure>

<p>注意如果变量 <code>p</code> 超出范围，PWM 也将停止。</p>
<p>一个让 LED 每两秒闪烁一次的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> RPi.GPIO <span class="keyword">as</span> GPIO</span><br><span class="line">GPIO.setmode(GPIO.BOARD)</span><br><span class="line">GPIO.setup(<span class="number">12</span>, GPIO.OUT)</span><br><span class="line"></span><br><span class="line">p = GPIO.PWM(<span class="number">12</span>, <span class="number">0.5</span>)</span><br><span class="line">p.start(<span class="number">1</span>)</span><br><span class="line">input(<span class="string">'Press return to stop:'</span>)   <span class="comment"># 在 Python 2 中使用 raw_input</span></span><br><span class="line">p.stop()</span><br><span class="line">GPIO.cleanup()</span><br></pre></td></tr></table></figure>

<p>一个调亮/调暗 LED 的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> RPi.GPIO <span class="keyword">as</span> GPIO</span><br><span class="line">GPIO.setmode(GPIO.BOARD)</span><br><span class="line">GPIO.setup(<span class="number">12</span>, GPIO.OUT)</span><br><span class="line"></span><br><span class="line">p = GPIO.PWM(<span class="number">12</span>, <span class="number">50</span>)  <span class="comment"># channel=12 frequency=50Hz</span></span><br><span class="line">p.start(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">for</span> dc <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">101</span>, <span class="number">5</span>):</span><br><span class="line">            p.ChangeDutyCycle(dc)</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">for</span> dc <span class="keyword">in</span> range(<span class="number">100</span>, <span class="number">-1</span>, <span class="number">-5</span>):</span><br><span class="line">            p.ChangeDutyCycle(dc)</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line"><span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">p.stop()</span><br><span class="line">GPIO.cleanup()</span><br></pre></td></tr></table></figure>



<h2 id="译注："><a href="#译注：" class="headerlink" title="译注："></a>译注：</h2><p>占空比（Duty cycle）在电信领域中意思（引自 <a href="https://wenku.baidu.com/view/6540b82d453610661ed9f463.html）：" target="_blank" rel="noopener">https://wenku.baidu.com/view/6540b82d453610661ed9f463.html）：</a></p>
<ul>
<li>在一串理想的脉冲序列中（如方波），正脉冲的持续时间与脉冲总周期的比值<ul>
<li>例如：脉冲宽度1μs，信号周期4μS的脉冲序列占空比为0.25</li>
</ul>
</li>
<li>在一段逶续工作时间内脉冲占用的时间与总时间的比值</li>
<li>负载周期在中文成语中有句话可以形容：「一天捕渔，三天晒网」则负载周期为0.25</li>
<li>占空比是高电平所占周期时间与整个周期时间的比值</li>
<li>占空比越大，高电平持续的时间越长，电路的开通时间就越长</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/translation/raspberry-gpio-python-examples/input/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/translation/raspberry-gpio-python-examples/input/" class="post-title-link" itemprop="url">输入</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 13:55:01" itemprop="dateCreated datePublished" datetime="2020-02-15T13:55:01+08:00">2020-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-29 10:34:01" itemprop="dateModified" datetime="2020-02-29T10:34:01+08:00">2020-02-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91/" itemprop="url" rel="index"><span itemprop="name">官方文档翻译</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在你的程序中获取 GPIO 输入的方式有很多。第一种且最简单的方法是在一个特定的时间点检查输入值。这种方法被称作“轮询”，而且如果你的程序在错误的时间读取值的话，可能遗漏某个输入。轮询是回环往复执行的，可能计算密集。另一种响应 GPIO 输入的方式是使用“中断”（边缘检测）。边缘指的是一个从高到低（递减边缘）或从低到高（递增边缘）的转换。</p>
<h2 id="上拉-下拉电阻-1"><a href="#上拉-下拉电阻-1" class="headerlink" title="上拉/下拉电阻^1"></a>上拉/下拉电阻<a href="**上拉电阻**：将一个不确定的信号（高或低电平），通过一个电阻与电源VCC相连，固定在高电平；**下拉电阻**：将一个不确定的信号（高或低电平），通过一个电阻与地GND相连，固定在低电平">^1</a></h2><p>如果输入阵脚没有连接任何东西，它会“浮动”。换句话说，他的读数值是未定义的，因为它直到你按下按钮或开关才连接到电路中。它的结果可能变化幅度很大，因为收到的主要是噪音。</p>
<p>为了规避这些噪音，我们可以使用一个上拉或下拉电阻，设置输入的初始值。可是通过硬件和软件配置上拉/下拉电阻。在硬件上，在输入通道和 3.3V（上拉）或 0V（下拉）之间放一个 10K 的电阻是很常见的。RPi.GPIO 模块允许你使用软件配置 Broadcom SOC ：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GPIO.setup(channel, GPIO.IN, pull_up_down=GPIO.PUD_UP)</span><br><span class="line">  <span class="comment"># 或者</span></span><br><span class="line">GPIO.setup(channel, GPIO.IN, pull_up_down=GPIO.PUD_DOWN)</span><br></pre></td></tr></table></figure>

<p>（channel 指代的是基于你声明的编号系统对应的通道编号——BOARD 或 BCM）。</p>
<h2 id="测试输入（轮询）"><a href="#测试输入（轮询）" class="headerlink" title="测试输入（轮询）"></a>测试输入（轮询）</h2><p>你可以在某个时刻拍一个输入快照：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> GPIO.input(channel):</span><br><span class="line">    print(<span class="string">'Input was HIGH'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'Input was LOW'</span>)</span><br></pre></td></tr></table></figure>

<p>循环轮询等待按钮按下的动作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> GPIO.input(channel) == GPIO.LOW:</span><br><span class="line">    time.sleep(<span class="number">0.01</span>)  <span class="comment"># 等待 10 ms 让 CPU 能做些别的事情</span></span><br></pre></td></tr></table></figure>

<p>（这个例子假设按下按钮把输入从 LOW 变成 HIGH）</p>
<h2 id="中断和边缘检测"><a href="#中断和边缘检测" class="headerlink" title="中断和边缘检测"></a>中断和边缘检测</h2><p>边缘指的是电信号从低到高（递增边缘）或从高到低（递减边缘）的变化。我们常常更关心一个输入状态的变化而不是它的值的变化。这种状态的变化就是一个 <em>事件</em>。</p>
<p>为了避免当你的程序忙于其他事的时候而错过一次按下按钮的动作，有两种方式来规避它：</p>
<ul>
<li><code>wait_for_edge()</code> 方法</li>
<li><code>event_detected()</code> 方法</li>
<li>当边缘被检测到时，会运行线程回调函数</li>
</ul>
<h3 id="wait-for-edge-方法"><a href="#wait-for-edge-方法" class="headerlink" title="wait_for_edge() 方法"></a><code>wait_for_edge()</code> 方法</h3><p><code>wait_for_edge()</code> 方法设计成直到检测到边缘才会执行。换句话说，上面等待按钮按下的例子可以被这样重写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GPIO.wait_for_edge(channel, GPIO.RISING)</span><br></pre></td></tr></table></figure>

<p>注意你可以检测的边缘类型有：<code>GPIO.RISING</code>、<code>GPIO.FALLING</code> 或 <code>GPIO.BOTH</code>。这种方式的好处是它不占用很多 CPU，于是给其他任务的资源就很多了。</p>
<p>如果你指向等待一个特定的时间段，你可以使用 <code>timeout</code> 参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 等待一个递增边缘至多 5 秒钟（timeout 的单位是毫秒）</span></span><br><span class="line">channel = GPIO.wait_for_edge(channel, GPIO_RISING, timeout=<span class="number">5000</span>)</span><br><span class="line"><span class="keyword">if</span> channel <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    print(<span class="string">'Timeout occurred'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'Edge detected on channel'</span>, channel)</span><br></pre></td></tr></table></figure>

<h3 id="event-detected-方法"><a href="#event-detected-方法" class="headerlink" title="event_detected() 方法"></a><code>event_detected()</code> 方法</h3><p><code>event_detected()</code> 方法被设计用来和其他操作一同在循环中使用。不过与轮询不同的是，即便当 CPU 正忙于做其他事情，也不会错过输入状态的改变。当使用诸如 Pygame 或 PyQt 这种有一个即时监听和响应 GUI 事件的主循环的程序中会很有用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GPIO.add_event_detect(channel, GPIO.RISING)  <span class="comment"># 给一个通道添加递增边缘检测</span></span><br><span class="line">do_something()</span><br><span class="line"><span class="keyword">if</span> GPIO.event_detected(channel):</span><br><span class="line">    print(<span class="string">'Button pressed'</span>)</span><br></pre></td></tr></table></figure>

<p>注意你可以检测这些事件：<code>GPIO.RISING</code>、<code>GPIO.FALLING</code> 或者 <code>GPIO.BOTH</code>。</p>
<h3 id="线程回调"><a href="#线程回调" class="headerlink" title="线程回调"></a>线程回调</h3><p><code>RPi.GPIO</code> 会为回调函数运行另一个线程。这意味着回调函数可以在你的主函数运行的同时运行，一旦触发边缘就会立即响应。例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_callback</span><span class="params">(channel)</span>:</span></span><br><span class="line">    print(<span class="string">'This is a edge event callback function!'</span>)</span><br><span class="line">    print(<span class="string">'Edge detected on channel %s'</span>%channel)</span><br><span class="line">    print(<span class="string">'This is run in a different thread to your main program'</span>)</span><br><span class="line"></span><br><span class="line">GPIO.add_event_detect(channel, GPIO.RISING, callback=my_callback)  <span class="comment"># 给通道增加递增边缘检测</span></span><br><span class="line">...你程序的其他部分...</span><br></pre></td></tr></table></figure>

<p>如果你需要多个回调函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_callback_one</span><span class="params">(channel)</span>:</span></span><br><span class="line">    print(<span class="string">'Callback one'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_callback_two</span><span class="params">(channel)</span>:</span></span><br><span class="line">    print(<span class="string">'Callback two'</span>)</span><br><span class="line"></span><br><span class="line">GPIO.add_event_detect(channel, GPIO.RISING)</span><br><span class="line">GPIO.add_event_callback(channel, my_callback_one)</span><br><span class="line">GPIO.add_event_callback(channel, my_callback_two)</span><br></pre></td></tr></table></figure>

<p>注意在这种情况下，回调函数是顺序执行，而非并发执行。这是因为中有一个线程用于回调，在这个线程中，每个回调按照他们定义的顺序依此运行。</p>
<h3 id="开关去抖"><a href="#开关去抖" class="headerlink" title="开关去抖"></a>开关去抖</h3><p>你可能已经发现了，每次按下按钮的时候，回调函数被调用了不止一次。这是所谓“开关抖动”的结果。有两种方法应对开关抖动：</p>
<ul>
<li>在你的开关中加一个 0.1uF 的电容器</li>
<li>软件去抖</li>
<li>二者联用</li>
</ul>
<p>通过软件去抖，在你声明回调函数时增加 <code>bouncetime=</code> 参数。抖动时间（bouncetime）的单位是毫秒。例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 给一个通道增加递增边缘检测，忽略 200ms 操控开关时产生的抖动</span></span><br><span class="line">GPIO.add_event_detect(channel, GPIO.RISING, callback=my_callback, bouncetime=<span class="number">200</span>)</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GPIO.add_event_callback(channel, my_callback, bouncetime=<span class="number">200</span>)</span><br></pre></td></tr></table></figure>

<h3 id="移除事件检测"><a href="#移除事件检测" class="headerlink" title="移除事件检测"></a>移除事件检测</h3><p>如果因为某些原因，你的程序不再需要检测边缘时间，可以把它们终止：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GPIO.remove_event_detect(channel)</span><br></pre></td></tr></table></figure>



<h2 id="译注"><a href="#译注" class="headerlink" title="译注"></a>译注</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/python-basic/function/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/python-basic/function/" class="post-title-link" itemprop="url">函数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 13:54:57" itemprop="dateCreated datePublished" datetime="2020-02-15T13:54:57+08:00">2020-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-29 10:34:01" itemprop="dateModified" datetime="2020-02-29T10:34:01+08:00">2020-02-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">Python 基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="函数初识"><a href="#函数初识" class="headerlink" title="函数初识"></a>函数初识</h3><p>函数的作用是封装代码，大量减少重复代码，可重用性高。</p>
<p>我们之前写代码的方式可以说是过程式编程，有什么需求我们就写什么样的代码，一步一步写下去。之前写过的代码一旦运行过去之后就不会被再次运行到。</p>
<p>我们今天要学习的函数，其实也是一种新的编程思路，也就是函数式编程。</p>
<p>接下来，我们通过一个例子来初识过程式编程与函数式编程的区别。</p>
<p>现在有这样一个要求，不使用 <code>len()</code> 方法，如何能够得知一个字符串 <code>s = &#39;alexdasb&#39;</code> 的长度呢？根据我们已有的知识，可以使用 for 循环做到：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">'alexdsb'</span></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    count += <span class="number">1</span></span><br><span class="line">print(count)</span><br></pre></td></tr></table></figure>

<p>这种方法对于我们来说已经轻而易举了。</p>
<p>如果此时，我们想接着求一个列表 <code>s = [1, 2, 3, 4, 5]</code> 的长度，即便跟前面的情况很类似，但我们不得不重新写一个代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    count += <span class="number">1</span></span><br><span class="line">print(count)</span><br></pre></td></tr></table></figure>

<p>如果再需要求一个元组 <code>s = (7, 8, 9, 10)</code> 的长度：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s = (<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>)</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    count += <span class="number">1</span></span><br><span class="line">print(count)</span><br></pre></td></tr></table></figure>

<p>我不难发现，我们虽然得到了我们想要的结果，但是循环的代码是完全重复了的。如果使用函数式编程，就可以减少这样的重复：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_len</span><span class="params">()</span>:</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">    print(count)</span><br><span class="line">s = <span class="string">"alexdsb"</span></span><br><span class="line">my_len()</span><br><span class="line">s = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br><span class="line">my_len()</span><br></pre></td></tr></table></figure>

<h3 id="函数的定义"><a href="#函数的定义" class="headerlink" title="函数的定义"></a>函数的定义</h3><p>从上面的例子我们已经能看出来，函数的定义结构为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> 函数名<span class="params">()</span>:</span></span><br><span class="line">    函数体</span><br></pre></td></tr></table></figure>

<ul>
<li><code>def</code> 是一个关键字，声明要定义一个函数</li>
<li><code>函数名</code> 指代函数的名字，遵循变量命名的规则</li>
<li><code>()</code> 是固定结构，用来传参</li>
<li><code>:</code> 表示语句结束</li>
<li><code>缩进</code></li>
<li><code>函数体</code> 为函数的代码内容</li>
</ul>
<h3 id="函数的调用"><a href="#函数的调用" class="headerlink" title="函数的调用"></a>函数的调用</h3><p>根据前面所学到的东西，我们可以很容易地写出一个简单地输出用户输入内容的函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    msg = input(<span class="string">'&gt;&gt;&gt;'</span>)</span><br><span class="line">    print(msg)</span><br></pre></td></tr></table></figure>

<p>程序运行之后直接结束，并没有按照我们预想的出现让用户输入的情况。</p>
<p>这是因为当程序运行到 def 语句时，并不会立即执行函数中的内容，而是会开辟一块内存空间，将函数的内容存储到内存中。</p>
<p>只有当函数被调用时，函数中的内容才会被执行。<code>函数名()</code> 这种形式就是在调用函数。</p>
<img src="/python-basic/function/QQ%E5%9B%BE%E7%89%8720190918204529.png" class="" title="QQ图片20190918204529">

<p>回到上面的例子，如果我们在最后增加对函数的调用，就可以实现我们想要的效果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func()</span><br></pre></td></tr></table></figure>

<p>这种 <code>函数名()</code> 的结构有两层含义：</p>
<ol>
<li>调用函数</li>
<li>接收返回值</li>
</ol>
<h3 id="函数的返回"><a href="#函数的返回" class="headerlink" title="函数的返回"></a>函数的返回</h3><p>我们学过的很多方法，比如 <code>print()</code>、<code>input()</code> 等，本质上就是函数。</p>
<p>如果我们将 <code>print()</code> 和 <code>input()</code> 两个函数本身作为参数打印出来，会有什么样的效果呢？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(print(<span class="string">'a'</span>))</span><br><span class="line">print(input(<span class="string">'&gt;&gt;&gt;'</span>))</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a</span><br><span class="line"><span class="literal">None</span></span><br><span class="line">&gt;&gt;&gt;<span class="number">123</span></span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure>

<p>print 和 input 运行后打印出来的内容有很大差别，这是因为两个函数的返回值不同。</p>
<p>函数中使用 <code>return</code> 语句返回内容。return 语句的基本用法为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    a = <span class="number">10</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">a = func()</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<p>return 后面可以跟 Python 中任意数据类型<a href="事实上，return后面可以跟Python中所有的对象。">^1</a>。</p>
<p>return还可以一次性返回多个数据，返回的数据以元组的形式接收：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    a = <span class="number">10</span></span><br><span class="line">    b = <span class="number">20</span></span><br><span class="line">    <span class="keyword">return</span> a, b</span><br><span class="line">a = func()</span><br><span class="line">print(a)</span><br><span class="line"></span><br><span class="line">输出的结果是：(<span class="number">10</span>, <span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<p>因为返回的数据是元组，我们可以通过解构的方式获取每一个值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    a = <span class="number">10</span></span><br><span class="line">    b = <span class="number">20</span></span><br><span class="line">    <span class="keyword">return</span> a, b</span><br><span class="line">a, b = func()   <span class="comment"># 拆包，解包，平行赋值</span></span><br><span class="line">print(a, b)</span><br><span class="line"></span><br><span class="line">输出的结果为： <span class="number">10</span> <span class="number">20</span></span><br></pre></td></tr></table></figure>

<p>return 是函数终止的标识，return 能够终止函数，它后面的代码不被执行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">    print(<span class="number">1</span>)</span><br><span class="line">a = func()</span><br><span class="line">print(a)</span><br><span class="line"></span><br><span class="line">输出的结果为： <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>return 会将返回值返回给调用者。</p>
<img src="/python-basic/function/QQ%E5%9B%BE%E7%89%8720190918204534.png" class="" title="QQ图片20190918204534">

<p>函数的返回小结：</p>
<ul>
<li>函数体中不写 return 默认返回 None；写了 return 不写值也返回 None</li>
<li>return 能够返回任意数据类型（Python 中所有对象）</li>
<li>return 能够返回多个数据类型，以元组的形式接收</li>
<li>return 能够终止函数，其下方的代码不会被执行</li>
<li>return 将返回值返回给调用者</li>
</ul>
<h3 id="函数的参数"><a href="#函数的参数" class="headerlink" title="函数的参数"></a>函数的参数</h3><h4 id="位置参数"><a href="#位置参数" class="headerlink" title="位置参数"></a>位置参数</h4><p>我们现在写好下面这样的函数并调用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">yue</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"掏出手机"</span>)</span><br><span class="line">    print(<span class="string">"打开微信"</span>)</span><br><span class="line">    print(<span class="string">"找到附近的人"</span>)</span><br><span class="line">    print(<span class="string">"聊一聊"</span>)</span><br><span class="line">    print(<span class="string">"约一约"</span>)</span><br><span class="line">yue()</span><br></pre></td></tr></table></figure>

<p>这个函数当然会很正常地运行。而且不管我们在什么位置，只要调用这个函数，就会打印这五行内容。</p>
<p>但是如果有一天，我们需要换一个 app，比如不用微信，改用陌陌，该如何办呢？如果在函数上改会很麻烦且不灵活。</p>
<p>我们可以通过参数的方式进行自定义函数输出的内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">yue</span><span class="params">(app)</span>:</span></span><br><span class="line">    print(<span class="string">"掏出手机"</span>)</span><br><span class="line">    print(<span class="string">"打开"</span>, app)</span><br><span class="line">    print(<span class="string">"找到附近的人"</span>)</span><br><span class="line">    print(<span class="string">"聊一聊"</span>)</span><br><span class="line">    print(<span class="string">"约一约"</span>)</span><br><span class="line">yue(<span class="string">'微信'</span>)</span><br><span class="line">yue(<span class="string">'陌陌'</span>)</span><br><span class="line">yue(<span class="string">'谈谈'</span>)</span><br></pre></td></tr></table></figure>

<p>通过这种传入参数的方式，我们如果需要函数输出不同的内容就不需要去改变函数本身了。</p>
<p>我们可以一次性传入多个参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">yue</span><span class="params">(app, girl, age, addr)</span>:</span>    <span class="comment"># 形参</span></span><br><span class="line">    print(<span class="string">"掏出手机"</span>)</span><br><span class="line">    print(<span class="string">f"打开<span class="subst">&#123;app&#125;</span>"</span>)</span><br><span class="line">    print(<span class="string">f"找一位<span class="subst">&#123;girl&#125;</span>，要求年龄：<span class="subst">&#123;age&#125;</span>，地区：<span class="subst">&#123;addr&#125;</span>的人"</span>)</span><br><span class="line">    print(<span class="string">"聊一聊"</span>)</span><br><span class="line">    print(<span class="string">"约一约"</span>)</span><br><span class="line">yue(<span class="string">"微信"</span>, <span class="string">"女孩"</span>, <span class="number">18</span>, <span class="string">"乌克兰"</span>)  <span class="comment"># 实参  按照位置传参</span></span><br></pre></td></tr></table></figure>

<p>在定义函数时使用的参数被称作形式参数，也称形参。在调用函数是使用的参数是实际参数，也称实参。</p>
<p>上面这种函数的传参方式被称作按位置传参，实参和形参需要一一对应，否则会出现参数混乱的问题。</p>
<h4 id="默认参数"><a href="#默认参数" class="headerlink" title="默认参数"></a>默认参数</h4><p>对于一些特殊的情况，比如某个男生很多，女生很少的班级，录入班级信息时，会经常重复输入性别为男。这时，我们可以通过设置默认参数的方法，将性别默认设定为男。当不输入参数时，函数会自动使用男作为参数。这样会节省很多时间：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">userinfo</span><span class="params">(name, age, hobby, sex=<span class="string">"男"</span>)</span>:</span></span><br><span class="line">    print(<span class="string">f"姓名：<span class="subst">&#123;name&#125;</span> 年龄：<span class="subst">&#123;age&#125;</span> 性别：<span class="subst">&#123;sex&#125;</span> 爱好：<span class="subst">&#123;hobby&#125;</span>"</span>)</span><br><span class="line">userinfo(<span class="string">"岳新力"</span>, <span class="number">23</span>, <span class="string">"开车"</span>)</span><br><span class="line">userinfo(<span class="string">"刘柄良"</span>, <span class="number">60</span>, <span class="string">"玩卡丁车"</span>)</span><br><span class="line">userinfo(<span class="string">"燕莹轩"</span>, <span class="number">16</span>, <span class="string">"听音乐"</span>,<span class="string">"女"</span>)</span><br><span class="line">userinfo(<span class="string">"苑子蒙"</span>, <span class="number">16</span>, <span class="string">"玩游戏"</span>,<span class="string">"女"</span>)</span><br><span class="line">userinfo(<span class="string">"王雪芹"</span>, <span class="number">16</span>, <span class="string">"看书"</span>,<span class="string">"女"</span>)</span><br><span class="line">userinfo(<span class="string">"瑞瑞"</span>, <span class="number">18</span>, <span class="string">"知难而上"</span>)</span><br></pre></td></tr></table></figure>

<p>需要注意的是，默认参数需要放在位置参数的后面，否则会报错。</p>
<p>参数的优先级为：位置参数 – 默认参数</p>
<h4 id="混合参数"><a href="#混合参数" class="headerlink" title="混合参数"></a>混合参数</h4><p>位置参数和默认参数可以混合在一起使用。需要注意的是，默认参数必须都要放在位置参数的后面：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(a, b, c=<span class="number">1</span>, d=<span class="number">2</span>)</span>:</span></span><br><span class="line">    print(a, b, c, d)</span><br><span class="line"></span><br><span class="line">func(<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)   <span class="comment"># 实参 位置参数传递</span></span><br><span class="line">func(a=<span class="number">1</span>, b=<span class="number">2</span>, c=<span class="number">3</span>, d=<span class="number">4</span>)  <span class="comment"># 关键字传参  （指名道姓传参）</span></span><br><span class="line">func(<span class="number">1</span>, <span class="number">2</span>, d=<span class="number">3</span>)  <span class="comment"># 关键字传参  （指名道姓传参）</span></span><br></pre></td></tr></table></figure>

<p>这里有引入了一个传参的概念。当调用函数时，我们需要把参数传递给函数，这个过程被称作传参。直接把参数按照形参的位置一一对应传入的方式被称作位置传参。也可以指定形参的名字来传参，这种方法被称作关键字传参。</p>
<p>当存在多个默认参数，但只想修改其中少数默认参数时，就需要使用关键字传参告诉函数需要改变的是哪一个参数。</p>
<h4 id="动态参数"><a href="#动态参数" class="headerlink" title="动态参数"></a>动态参数</h4><p>我们已经学到了函数的两种参数：位置参数和默认参数。但是对这两种参数而言，我们传入函数的数据不能多于参数的总个数。但是有些时候，参数的数量是不能很好控制的，这时候，我们就需要应用到动态参数。</p>
<p>动态参数的作用主要有两个：</p>
<ol>
<li>能够接收不固定长度的参数</li>
<li>位置参数过多时，可以使用动态参数</li>
</ol>
<h5 id="动态位置参数"><a href="#动态位置参数" class="headerlink" title="动态位置参数"></a>动态位置参数</h5><p>我们可以通过下面的方法定义一个动态的位置参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(*c)</span>:</span></span><br><span class="line">    print(c)</span><br><span class="line">func(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>这个方法得到的数据类型是一个元组。</p>
<p>动态位置参数以 <code>*形参</code> 的形式表示。相信大家已经发现，这种方式跟切片时十分相似。</p>
<p>事实上，同切片时将多余数据打包的原理一样，在形参位置上的 <code>*</code> 就是聚合。同样，我们可以在函数体中使用 <code>*</code> 将聚合后得到的元组打散：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(*c)</span>:</span>  <span class="comment"># 形参位置上的*是聚合</span></span><br><span class="line">    print(*c)  <span class="comment"># 函数体中的*就是打散</span></span><br><span class="line">func(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>因为动态位置参数会将多余的位置参数全都打包起来，所以一个函数中只需要一个动态位置参数就足够了。一般情况下，动态位置参数会被命名为 <code>*args</code>。当然也可以自定义参数名，但是不建议修改，因为这时程序员约定俗成的共识。</p>
<p>如果动态位置参数后面还有位置参数，那么后面的位置参数将永远无法获取到值，程序会直接报错：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">(*args, a, b)</span>:</span></span><br><span class="line">    print(a, b, args)</span><br><span class="line">eat(<span class="string">"面条"</span>, <span class="string">"米饭"</span>, <span class="string">"馒头"</span>, <span class="string">"包子"</span>, <span class="string">"煎饼"</span>)</span><br></pre></td></tr></table></figure>

<p>程序报错，错位内容为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"C:/Users/Sure/PyProject/day10/exercise.py"</span>, line <span class="number">12</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    eat(<span class="string">"面条"</span>, <span class="string">"米饭"</span>, <span class="string">"馒头"</span>, <span class="string">"包子"</span>, <span class="string">"煎饼"</span>)</span><br><span class="line">TypeError: eat() missing <span class="number">2</span> required keyword-only arguments: <span class="string">'a'</span> <span class="keyword">and</span> <span class="string">'b'</span></span><br></pre></td></tr></table></figure>

<p>因为参数 <code>a</code> 和 <code>b</code> 永远也无法得到值，尽管我们输入很多内容，依旧无济于事。</p>
<p>一个比较标准的参数设置方法是这样的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">(a, b, *args)</span>:</span>  <span class="comment"># 位置参数 动态位置参数</span></span><br><span class="line">    print(a, b, args)</span><br><span class="line">eat(<span class="string">"面条"</span>, <span class="string">"米饭"</span>, <span class="string">"馒头"</span>, <span class="string">"包子"</span>, <span class="string">"煎饼"</span>)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">面条 米饭 (<span class="string">'馒头'</span>, <span class="string">'包子'</span>, <span class="string">'煎饼'</span>)</span><br></pre></td></tr></table></figure>

<p>位置参数一一对应获得参数，动态位置参数将剩余的参数打包成一个元组。</p>
<h5 id="动态关键字参数（动态默认参数）"><a href="#动态关键字参数（动态默认参数）" class="headerlink" title="动态关键字参数（动态默认参数）"></a>动态关键字参数（动态默认参数）</h5><p>当我们在实参中传入的关键字参数在形参中存在时，会成功传递进入。可是如果形参中没有我们传入的实参，就会报错。</p>
<p>动态关键字参数就是用来接收这些没有被定义过的关键字参数。</p>
<p>我们可以在形参中使用 <code>**参数名</code> 的形式定义一个动态关键字参数。同样地，参数名可以随意选取，但是程序员间约定俗成的动态关键字参数名为 <code>**kwargs</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(a,b,*args,**kwargs)</span>:</span></span><br><span class="line">    print(a,b,args,kwargs)</span><br><span class="line">func(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">76</span>, <span class="number">87</span>, <span class="number">8</span>, c=<span class="number">100</span>)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="number">2</span> (<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">76</span>, <span class="number">87</span>, <span class="number">8</span>) &#123;<span class="string">'c'</span>: <span class="number">100</span>&#125;</span><br></pre></td></tr></table></figure>

<p>前两个位置参数分别传给了 <code>a</code> 和 <code>b</code>，剩余的位置参数打包成元组传给了 <code>args</code>，而关键字参数则以字典的形式传给了 <code>kwargs</code>。</p>
<p>当我们需要设置多种参数时，推荐使用的顺序是：位置参数，动态位置参数，默认参数，动态关键字参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(a, b, *args, m=<span class="number">8</span>, **kwargs)</span>:</span> </span><br><span class="line">    <span class="comment"># 位置参数,动态位置,默认参数,动态关键字参数</span></span><br><span class="line">    print(a, b, m, args, kwargs)</span><br><span class="line">func(<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, m=<span class="number">10</span>, c=<span class="number">11</span>, d=<span class="number">12</span>)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">10</span> (<span class="number">4</span>, <span class="number">5</span>) &#123;<span class="string">'c'</span>: <span class="number">11</span>, <span class="string">'d'</span>: <span class="number">12</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="函数参数总结"><a href="#函数参数总结" class="headerlink" title="函数参数总结"></a>函数参数总结</h4><ul>
<li><p>在定义函数的阶段使用的参数是形参：</p>
<ul>
<li>可以单独使用位置参数，也可以单独使用默认参数，也可以混合使用</li>
<li>位置参数：必须一一对应</li>
<li>默认参数：可以不传参，可以传参，传参就是把默认的值给覆盖</li>
<li>混合使用：位置参数，默认参数</li>
</ul>
</li>
<li><p>在调用函数的阶段使用的是实参：</p>
<ul>
<li>可以单独使用位置参数，也可以单独使用关键字参数，也可以混合使用</li>
<li>位置传参：必须一一对应</li>
<li>关键字传参：指名道姓的方式进行传参</li>
<li>混合使用：位置参数，默认参数</li>
</ul>
</li>
<li><p>将实参传递给形参的过程就是传参</p>
</li>
<li><p>优先级：位置参数 &gt; 动态位置参数（可变位置参数）&gt; 默认参数 &gt; 动态关键字参数（可变关键字参数）</p>
</li>
<li><p><code>*args</code> 和 <code>**kwargs</code> 是程序员之间约定俗成的命名法（可以更换但是不建议更换）</p>
</li>
<li><p><code>*args</code> 获取的是一个元组</p>
</li>
<li><p><code>**kwargs</code> 获取的是一个字典</p>
</li>
<li><p><code>*args</code> 只接收多余的位置参数</p>
</li>
<li><p><code>**kwargs</code> 只接收多余的关键字参数</p>
</li>
</ul>
<h4 id="函数参数补充"><a href="#函数参数补充" class="headerlink" title="函数参数补充"></a>函数参数补充</h4><h5 id="万能传参"><a href="#万能传参" class="headerlink" title="万能传参"></a>万能传参</h5><p>因为动态位置参数和动态关键字参数可以接受所有的位置参数和关键字参数，所以在设置形参时，我们甚至可以只设置 <code>*args</code> 和 <code>**kwargs</code> 两个形参，这种传参方法被称作万能传参：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(*args, **kwargs)</span>:</span>   <span class="comment"># 万能传参</span></span><br><span class="line">    print(args, kwargs)</span><br><span class="line">func(<span class="number">12</span>, <span class="number">2</span>, <span class="number">121</span>, <span class="number">12</span>, <span class="number">321</span>, <span class="number">3</span>, a=<span class="number">1</span>, b=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">12</span>, <span class="number">2</span>, <span class="number">121</span>, <span class="number">12</span>, <span class="number">321</span>, <span class="number">3</span>) &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure>

<h5 id="聚合与打散"><a href="#聚合与打散" class="headerlink" title="聚合与打散"></a>聚合与打散</h5><p>在前面的 <a href="#动态位置参数">动态位置参数</a> 部分已经讨论过，形参中的 <code>*args</code> 是将多于变量聚合为元组，函数体中的 <code>*args</code> 是将元组打散。其实对于 <code>**kwargs</code> 来说也很类似：形参中的 <code>**kwargs</code> 是将 <code>key=1, key2=2</code> 这样类型的语句转化为字典，而函数体中 <code>*kwargs</code> 是获取字典中所有的键，<code>**kwargs</code> 是将字典打散为 <code>key=1, key2=2</code> 的语句。</p>
<p>除了函数中，我们可以在 Python 的很多地方灵活运用打散和聚合的操作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">lst = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(*args)</span>:</span>  <span class="comment"># 聚合</span></span><br><span class="line">    print(*args)  <span class="comment"># 打散</span></span><br><span class="line">func(*lst)  <span class="comment"># 打散 func(1, 2, 3, 4, 6, 7)</span></span><br><span class="line"></span><br><span class="line">dic = &#123;<span class="string">"key"</span>: <span class="number">1</span>, <span class="string">"key2"</span>: <span class="number">2</span>&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(**kwargs)</span>:</span>  <span class="comment"># 聚合</span></span><br><span class="line">    print(kwargs)    <span class="comment"># 打散</span></span><br><span class="line">func(**dic)  <span class="comment"># 打散 func(key=1, key2=2)</span></span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">6</span> <span class="number">7</span></span><br><span class="line">&#123;<span class="string">'key'</span>: <span class="number">1</span>, <span class="string">'key2'</span>: <span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="函数的注释"><a href="#函数的注释" class="headerlink" title="函数的注释"></a>函数的注释</h3><p>在协同操作的过程中，大家或许会查看和使用彼此的代码。但是如果没有任何提示性的内容的话，从头开始看起会有很大的理解困难。如果我们将函数的一些功能、参数要求等信息在函数中写出来，别人阅读时就会节省很多时间，也更容易理解调用和修改我们的函数。</p>
<p>标准的函数注释应该是这样的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    数字的加法运算</span></span><br><span class="line"><span class="string">    :param a: int</span></span><br><span class="line"><span class="string">    :param b: int</span></span><br><span class="line"><span class="string">    :return: int</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">print(add(<span class="number">1</span>, <span class="number">2</span>))</span><br></pre></td></tr></table></figure>

<p>函数中使用三对 <code>&quot;</code>，就是代表注释。也可以使用 <code>&#39;</code> 表示，但是不推荐。</p>
<p>另外一种比较流行的注释方法是在形参后加入 <code>:数据类型</code>，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a:int, b:int)</span>:</span>  <span class="comment"># 提示,没有做到约束</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    加法</span></span><br><span class="line"><span class="string">    :param a:</span></span><br><span class="line"><span class="string">    :param b:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">add(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">add(<span class="string">"1"</span>, <span class="string">"2"</span>)</span><br></pre></td></tr></table></figure>

<p>需要注意的是，参数的作用只是起到提示的作用，并不会进行判断，约束我们传入变量的数据类型。</p>
<p>我们可以通过 <code>函数名.__doc__</code> 的方法查看函数的注释；通过 <code>函数名.__name__</code> 的方法查看函数的名字。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/python-advanced/polymorphism/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/python-advanced/polymorphism/" class="post-title-link" itemprop="url">多态</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 13:54:54" itemprop="dateCreated datePublished" datetime="2020-02-15T13:54:54+08:00">2020-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-29 10:34:01" itemprop="dateModified" datetime="2020-02-29T10:34:01+08:00">2020-02-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">Python 进阶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="多态体现一，变量可以指向任意数据类型"><a href="#多态体现一，变量可以指向任意数据类型" class="headerlink" title="多态体现一，变量可以指向任意数据类型"></a>多态体现一，变量可以指向任意数据类型</h3><p>多态的第一种体现是，不关注对象的数据类型，同一个变量完全可以在不同的时间引用不同的对象</p>
<p>Python 本身就是一种多态语言，不关心对象的类型</p>
<ul>
<li>对于弱类型的语言来说，变量并没有声明类型，因此同一个变量完全可以在不同的时间引用不同的对象</li>
<li>毫无疑问，在 Python 中，对象是一块内存，内存中除了包含属性和方法之外，还包含了对象类型。我们通过引用来访问对象，比如 <code>a = A()</code>。首先，Python 创建一个对象 A，然后声明一个变量 a，再将变量 a 与对象 A 联系起来。变量 a 是没有类型的，它的类型取决于其关联的对象。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">10</span></span><br><span class="line">a = <span class="string">'alex'</span>    <span class="comment"># Python中的变量可以随时被赋值任意数据类型</span></span><br></pre></td></tr></table></figure>

<p>我们曾经谈到过，Python 中的每一个类实际上就是一个数据类型，因此，变量也可以指向不同类的对象：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bird</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">move</span><span class="params">(self, field)</span>:</span></span><br><span class="line">        print(<span class="string">'鸟儿在%s上自由地飞翔~'</span> % field)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">move</span><span class="params">(self, field)</span>:</span></span><br><span class="line">        print(<span class="string">'狗狗在%s里飞快地奔跑~'</span> % field)</span><br><span class="line">x = Bird()</span><br><span class="line">x.move(<span class="string">'天空'</span>)</span><br><span class="line">x = Dog()</span><br><span class="line">x.move(<span class="string">'草地'</span>)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">鸟儿在天空上自由地飞翔~</span><br><span class="line">狗狗在草地里飞快地奔跑~</span><br></pre></td></tr></table></figure>

<p>同一个变量x在执行同一个 <code>move()</code> 方法时，由于 x 指向的对象不同，因此呈现出不同的行为特征，这就是多态。</p>
<h3 id="多态体现二，一类事物有多种形态（Polymorphic）"><a href="#多态体现二，一类事物有多种形态（Polymorphic）" class="headerlink" title="多态体现二，一类事物有多种形态（Polymorphic）"></a>多态体现二，一类事物有多种形态（Polymorphic）</h3><p>一个抽象类有多个子类，但方法实现不同</p>
<ul>
<li>例如：动物类有多个子类，每个子类都重新实现了父类的某个方法，但方法的实现不同（比如动物类都有休息的方法，但不同的动物休息的方式不尽相同）</li>
<li>此时需要有继承，需要方法重写</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Girl</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">game</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'%s蹦蹦跳跳地玩耍...'</span> % self.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nurse</span><span class="params">(Girl)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">game</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'%s脱裤子打针'</span> % self.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">game</span><span class="params">(self, girl)</span>:</span></span><br><span class="line">        print(<span class="string">'%s和%s快乐地玩耍'</span> % (self.name, girl.name))</span><br><span class="line">        girl.game()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xiaoming = Boy(<span class="string">'小明'</span>)</span><br><span class="line">xiaohong = Girl(<span class="string">'小红'</span>)</span><br><span class="line">xiaoli = Nurse(<span class="string">'小丽'</span>)</span><br><span class="line"></span><br><span class="line">xiaoming.game(xiaohong)</span><br><span class="line">xiaoming.game(xiaoli)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">小明和小红快乐地玩耍</span><br><span class="line">小红蹦蹦跳跳地玩耍...</span><br><span class="line">小明和小丽快乐地玩耍</span><br><span class="line">小丽脱裤子打针</span><br></pre></td></tr></table></figure>

<p>Nurse 有 Girl 类的方法和属性，是它的子类。方法名虽然相同，但实现的方式略有差异。具有相同父类，继承相同方法，在子类中对父类的方法进行了修改，就是多态的第二种体现。</p>
<h3 id="多态性"><a href="#多态性" class="headerlink" title="多态性"></a>多态性</h3><p>多态性（polymorphism）指的是，在多态基础上，定义统一的共同接口（在类的外面定义单独的函数），从而实现使用一个函数调用不同类的同名方法。</p>
<p>不同类的对象作为函数的参数时，因为方法不同，得到的结果也会有差异。</p>
<p>多态性的具体实现方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">relax</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'人需要休息'</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Alex</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">relax</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'睡觉'</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BigB</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">relax</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'买沙发'</span>)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 定义一个函数作为访问多个类的relax方法的统一接口</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">relax_func</span><span class="params">(person)</span>:</span></span><br><span class="line">    person.relax()</span><br><span class="line">    </span><br><span class="line">a = Alex()</span><br><span class="line">b = BigB()</span><br><span class="line">p = Person()</span><br><span class="line"></span><br><span class="line">relax_func(a)</span><br><span class="line">relax_func(b)</span><br><span class="line">relax_func(p)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">睡觉</span><br><span class="line">买沙发</span><br><span class="line">人需要休息</span><br></pre></td></tr></table></figure>

<h3 id="鸭子类型"><a href="#鸭子类型" class="headerlink" title="鸭子类型"></a>鸭子类型</h3><p>鸭子类型是 Python 中比较推崇的多态的另一种体现形式。</p>
<p>鸭子类型不关心类型，不需要继承，只关注方法的实现，这种情况被称为鸭子类型。</p>
<p>鸭子类型名字的来源于一句话：“当看到一只鸟走起来像鸭子、游起来像鸭子、叫起来也像鸭子，那么这只鸟就可以被称作‘鸭子’”。</p>
<p>套用过来就是，当两个类，有同名方法，不管这两个类是干什么用的，也不管它们之间有没有联系（依赖、组合或继承），都可以用同一个接口来调用。</p>
<p>在鸭子类型中，关注的不是对象的类型本身，而是它是如何使用的。</p>
<p>比如，人、鸭子、鱼、猪和船都会游泳，但是他们是不同的类，他们之间没有任何联系。而我们却可以在外面定义一个统一的接口来调用他们之间游泳的方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">swim</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'人可以游泳'</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Duck</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">swim</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'鸭子会游泳'</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fish</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">swim</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'鱼会游泳'</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pig</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">swim</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'猪会游泳'</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ship</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">swim</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'船会游泳'</span>)</span><br><span class="line">   </span><br><span class="line"><span class="comment"># 建立鸭子类型</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">swimming</span><span class="params">(obj)</span>:</span></span><br><span class="line">    obj.swim()</span><br><span class="line">    </span><br><span class="line">xiaoming = Person()</span><br><span class="line">xiaohuang = Duck()</span><br><span class="line">paopao = Fish()</span><br><span class="line">peiqi = Pig()</span><br><span class="line">titanic = Ship()</span><br><span class="line"></span><br><span class="line">swimming(xiaoming)</span><br><span class="line">swimming(xiaohuang)</span><br><span class="line">swimming(paopao)</span><br><span class="line">swimming(peiqi)</span><br><span class="line">swimming(titanic)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">人可以游泳</span><br><span class="line">鸭子会游泳</span><br><span class="line">鱼会游泳</span><br><span class="line">猪会游泳</span><br><span class="line">船会游泳</span><br></pre></td></tr></table></figure>

<h3 id="多态总结"><a href="#多态总结" class="headerlink" title="多态总结"></a>多态总结</h3><p>Python 是一门天然支持多态的编程语言。</p>
<p>多态增加了程序的灵活性（通用性），以不变应万变，不论对象千变万化，使用者都是使用同一种形式（外部定义的一个函数）去调用。</p>
<p>增加程序的可扩展性，通过继承某个类创建的一个新类，接口使用者无需更改自己的代码，还是用原方法调用。</p>
<p>多态和多态性对比：</p>
<p>多态强调的是，一类事物由不同的形态。</p>
<p>多态性强调的是，同一操作，作用对象不同，表现出不同的实现方式（只关心行为结果）</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/python-basic/recursion/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/python-basic/recursion/" class="post-title-link" itemprop="url">递归</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 13:54:40" itemprop="dateCreated datePublished" datetime="2020-02-15T13:54:40+08:00">2020-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-29 10:34:01" itemprop="dateModified" datetime="2020-02-29T10:34:01+08:00">2020-02-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">Python 基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>递归的精华是一递一归。所谓递，就是不断嵌套函数；所谓归，就是逐个将值返回。递而不归，就会越嵌套越深，直至突破内存极限而出错。</p>
<p>递归函数的定义有两个方面：</p>
<ol>
<li>不断调用自己本身    # 只满足这个条件的是死递归</li>
<li>有明确的结束条件</li>
</ol>
<p>例如，下面的这个函数就是一个死敌归：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="number">1</span>)</span><br><span class="line">    func()</span><br><span class="line">func()</span><br></pre></td></tr></table></figure>

<p>程序并没有一直运行，输出1，而是运行到一定深度（层次）后就停止了。</p>
<p>这是因为 Python 为了保护计算机而设置了递归的深度限制。官方声明的限制是 1000 层，但实际测试往往在 998/997 层左右。</p>
<p>我们也可以修改系统设置的迭代深度限制：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.setrecursionlimit(<span class="number">800</span>)</span><br></pre></td></tr></table></figure>

<p>现在，让我们用递归写一个阶乘的函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorial</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> factorial(n - <span class="number">1</span>) * n</span><br><span class="line">print(factorial(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">返回的结果为： <span class="number">120</span></span><br></pre></td></tr></table></figure>

<p>递归的思路是：找到 <code>f(n)</code> 与 <code>f(n - 1)</code> 之间的关系，然后将这种关系作为返回值或者其他操作。通过设置起始位置或终止位置的函数值实现函数的结束条件。</p>
<p>对于上个例子来说，<code>factorial(n)</code> 与 <code>factorial(n - 1)</code> 之间的关系是 <code>factorial(n) = factorial(n - 1) * n</code>。而当 <code>n</code> 为 <code>1</code> 时，<code>factorial(1) = 1</code>。</p>
<p>把上面的例子拆开看就是下面这个样子：</p>
<table>
<thead>
<tr>
<th align="center">函数层数</th>
<th align="center">n</th>
<th align="center">返回值</th>
</tr>
</thead>
<tbody><tr>
<td align="center">factorial(5)</td>
<td align="center">5</td>
<td align="center">factorial(4) * 5</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">4</td>
<td align="center">factorial(3) * 4 * 5</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">factorial(2) * 3 * 4 * 5</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">2</td>
<td align="center">factorial(1) * 2 * 3 * 4 * 5</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">1</td>
<td align="center">1 * 2 * 3 * 4 * 5</td>
</tr>
</tbody></table>
<p>有些问题使用递归解起来会有很奇妙的感觉，比如解决汉诺塔问题等。</p>
<p>但是因为层层嵌套，层层调用，递归非常占用内存，运行速度也相对缓慢。使用尾递归可以略微缓解这个麻烦，但也是慢，而且很难。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/python-basic/decorator/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/python-basic/decorator/" class="post-title-link" itemprop="url">装饰器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 13:53:41" itemprop="dateCreated datePublished" datetime="2020-02-15T13:53:41+08:00">2020-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-29 10:34:01" itemprop="dateModified" datetime="2020-02-29T10:34:01+08:00">2020-02-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">Python 基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="装饰器初识"><a href="#装饰器初识" class="headerlink" title="装饰器初识"></a>装饰器初识</h3><p>在编程中，有很多约定俗成的规则。开放封闭原则就是其中很重要的一个。</p>
<p>开放封闭原则体现在两个方面：</p>
<ol>
<li>对扩展开放，支持增加新功能</li>
<li>对修改源代码封闭，对调用方式的改变封闭</li>
</ol>
<p>装饰器就是为了体现编程的开放封闭原则而存在的。</p>
<p>装饰器，顾名思义，就是在原有基础上额外添加新功能的工具。</p>
<p>我们有下面一组函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    time.sleep(<span class="number">0.5</span>)    <span class="comment"># 休眠0.5秒，阻塞函数</span></span><br><span class="line">    print(<span class="string">'i am in index'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    time.sleep(<span class="number">0.8</span>)</span><br><span class="line">    print(<span class="string">'i am in func'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    time.sleep(<span class="number">0.4</span>)</span><br><span class="line">    print(<span class="string">'i am in func'</span>)</span><br><span class="line">    </span><br><span class="line">index()</span><br><span class="line">func()</span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>

<p>现在有这样一个需求：想要知道每一个函数运行的时间。</p>
<p>为了不改变函数的源代码，我们可以尝试着在调用函数前后加入查看时间戳的代码，尝试着计算函数的运行时间：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    print(<span class="string">'i am in index'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    time.sleep(<span class="number">0.8</span>)</span><br><span class="line">    print(<span class="string">'i am in func'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    time.sleep(<span class="number">0.4</span>)</span><br><span class="line">    print(<span class="string">'i am in func'</span>)</span><br><span class="line">    </span><br><span class="line">start_time = time.time</span><br><span class="line">index()</span><br><span class="line">print(time.time - start_time)</span><br><span class="line"></span><br><span class="line">start_time = time.time</span><br><span class="line">func()</span><br><span class="line">print(time.time - start_time)</span><br><span class="line"></span><br><span class="line">start_time = time.time</span><br><span class="line">foo()</span><br><span class="line">print(time.time - start_time)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">i am <span class="keyword">in</span> index</span><br><span class="line"><span class="number">0.500666618347168</span></span><br><span class="line">i am <span class="keyword">in</span> func</span><br><span class="line"><span class="number">0.800020694732666</span></span><br><span class="line">i am <span class="keyword">in</span> func</span><br><span class="line"><span class="number">0.4008512496948242</span></span><br></pre></td></tr></table></figure>

<p>我们好像得到我们想要的结果了。但是不要忘了，我们一开始提到的，我们编程时需要遵循开放封闭原则。我们的确没有改变函数的源代码，但是调用函数时，需要增加代码。我们改变了函数的调用方式。</p>
<p>另一方面，我们在调用函数的过程中，使用了大量的重复代码：<code>start_time = time.time</code> 和 <code>print(time.time - start_time)</code>。</p>
<p>为了减少重复代码，我们或许可以尝试着使用函数，比如这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    print(<span class="string">'i am in index'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    time.sleep(<span class="number">0.8</span>)</span><br><span class="line">    print(<span class="string">'i am in func'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    time.sleep(<span class="number">0.4</span>)</span><br><span class="line">    print(<span class="string">'i am in func'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_time</span><span class="params">(f)</span>:</span></span><br><span class="line">    start_time = time.time()</span><br><span class="line">    f()</span><br><span class="line">    print(time.time() - start_time)</span><br><span class="line"></span><br><span class="line">ff = index</span><br><span class="line">index = run_time</span><br><span class="line">index(ff)</span><br><span class="line"></span><br><span class="line">ff = func</span><br><span class="line">func = run_time</span><br><span class="line">func(ff)</span><br><span class="line"></span><br><span class="line">ff = foo</span><br><span class="line">foo = run_time</span><br><span class="line">foo(ff)</span><br></pre></td></tr></table></figure>

<p>在调用函数时，我之所以把函数写得这么复杂，而不是简单地写成这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">run_time(index)</span><br><span class="line">run_time(func)</span><br><span class="line">run_time(foo)</span><br></pre></td></tr></table></figure>

<p>是为了避免改变函数的调用方式。</p>
<p>可即便绞尽脑汁，函数最终的调用方式还是发生了变化——原本函数的调用是不需要参数的，增加功能后需要增加参数 <code>ff</code>。</p>
<p>不过我们已经离正确的解决办法非常近了，只差一步，就可以解决我们的困难。</p>
<p>这就需要结合我们刚刚学到的内容：<a href="/python-basic/closure">闭包</a>。</p>
<p>如果我们把功能函数整合为闭包，就可以满足编程的开放封闭原则，并且不会增加太多的重复代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    print(<span class="string">'i am in index'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    time.sleep(<span class="number">0.8</span>)</span><br><span class="line">    print(<span class="string">'i am in func'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    time.sleep(<span class="number">0.4</span>)</span><br><span class="line">    print(<span class="string">'i am in func'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_time</span><span class="params">(f)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        f()</span><br><span class="line">        print(time.time() - start_time)</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line">index = run_time(index)</span><br><span class="line">index()</span><br><span class="line">func = run_time(func)</span><br><span class="line">func()</span><br><span class="line">foo = run_time(foo)</span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>

<p>上面的这种给函数增加功能的方法就构成了 Python 中的装饰器。</p>
<p>因为装饰器在 Python 编程中十分好用，Python 还专门为类似 <code>index = run_time(index)</code> 的赋值运算设定了一个语法糖：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_time</span><span class="params">(f)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        f()</span><br><span class="line">        print(time.time() - start_time)</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="meta">@run_time    # 等价于 index = run_time(index)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    print(<span class="string">'i am in index'</span>)</span><br><span class="line"></span><br><span class="line">index()</span><br></pre></td></tr></table></figure>

<p>语法糖必须要放在被装饰函数的正上方。虽然有些空行，Python 解释器也能识别，但是阅读起来会很别扭：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@run_time</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    print(<span class="string">'i am in index'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="标准装饰器"><a href="#标准装饰器" class="headerlink" title="标准装饰器"></a>标准装饰器</h3><p>如果原函数中有参数，我们可以在装饰器的内部函数中设置加入参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plugin</span><span class="params">(f)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(user, pwd, hero)</span>:</span></span><br><span class="line">        print(<span class="string">'外挂开启'</span>)</span><br><span class="line">        f(user, pwd, hero)</span><br><span class="line">        print(<span class="string">'外挂结束'</span>)</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"><span class="meta">@plugin</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gamming</span><span class="params">(user, pwd, hero)</span>:</span></span><br><span class="line">    print(<span class="string">'打开游戏'</span>)</span><br><span class="line">    print(<span class="string">f'用户名：<span class="subst">&#123;user&#125;</span>，密码：<span class="subst">&#123;pwd&#125;</span>'</span>)</span><br><span class="line">    print(<span class="string">f'选择英雄：<span class="subst">&#123;hero&#125;</span>'</span>)</span><br><span class="line">    print(<span class="string">'游戏中'</span>)</span><br><span class="line">    print(<span class="string">'游戏结束'</span>)</span><br><span class="line">gamming(<span class="string">'meet'</span>, <span class="string">'1234'</span>, <span class="string">'草丛伦'</span>)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">外挂开启</span><br><span class="line">打开游戏</span><br><span class="line">用户名：meet，密码：<span class="number">1234</span></span><br><span class="line">选择英雄：草丛伦</span><br><span class="line">游戏中</span><br><span class="line">游戏结束</span><br><span class="line">外挂结束</span><br></pre></td></tr></table></figure>

<p>其实，在装饰器中，我们可以使用 <code>*args</code> 接收全部位置参数，使用 <code>**kwargs</code> 接收全部关键字参数。在调用函数时，只需要把 <code>args</code> 和 <code>**kwargs</code> 重新打散即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plugin</span><span class="params">(f)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'外挂开启'</span>)</span><br><span class="line">        f(*args, **kwargs)</span><br><span class="line">        print(<span class="string">'外挂结束'</span>)</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"><span class="meta">@plugin</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gamming</span><span class="params">(user, pwd, hero)</span>:</span></span><br><span class="line">    print(<span class="string">'打开游戏'</span>)</span><br><span class="line">    print(<span class="string">f'用户名：<span class="subst">&#123;user&#125;</span>，密码：<span class="subst">&#123;pwd&#125;</span>'</span>)</span><br><span class="line">    print(<span class="string">f'选择英雄：<span class="subst">&#123;hero&#125;</span>'</span>)</span><br><span class="line">    print(<span class="string">'游戏中'</span>)</span><br><span class="line">    print(<span class="string">'游戏结束'</span>)</span><br><span class="line">gamming(<span class="string">'meet'</span>, <span class="string">'1234'</span>, <span class="string">'草丛伦'</span>)</span><br></pre></td></tr></table></figure>

<p>修饰过的 <code>gamming</code> 函数，不论是调用方法，还是参数使用，就是传参数后报错的内容都是跟修饰前的 <code>gamming</code> 一致。这就完美地符合了编程的开放封闭原则。</p>
<p>除了使用参数，函数的另外一个特点是可以有返回值。如果被修饰的参数也有返回值，我们只需在装饰器的内层函数中加入返回值即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plugin</span><span class="params">(f)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'外挂开启'</span>)</span><br><span class="line">        a = f(*args, **kwargs)</span><br><span class="line">        print(<span class="string">'外挂结束'</span>)</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"><span class="meta">@plugin</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gamming</span><span class="params">(user, pwd, hero)</span>:</span></span><br><span class="line">    print(<span class="string">'打开游戏'</span>)</span><br><span class="line">    print(<span class="string">f'用户名：<span class="subst">&#123;user&#125;</span>，密码：<span class="subst">&#123;pwd&#125;</span>'</span>)</span><br><span class="line">    print(<span class="string">f'选择英雄：<span class="subst">&#123;hero&#125;</span>'</span>)</span><br><span class="line">    print(<span class="string">'游戏中'</span>)</span><br><span class="line">    print(<span class="string">'游戏结束'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'我卢**没有开挂！'</span></span><br><span class="line">print(gamming(<span class="string">'meet'</span>, <span class="string">'1234'</span>, <span class="string">'草丛伦'</span>))</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">外挂开启</span><br><span class="line">打开游戏</span><br><span class="line">用户名：meet，密码：<span class="number">1234</span></span><br><span class="line">选择英雄：草丛伦</span><br><span class="line">游戏中</span><br><span class="line">游戏结束</span><br><span class="line">外挂结束</span><br><span class="line">我卢**没有开挂！</span><br></pre></td></tr></table></figure>

<p>至此，我们已经把装饰器的内容都讨论过了。其实，装饰器本身并不复杂，我们可以使用一个很规整简洁的代码写出一个装饰器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""执行被装饰函数前，进行的操作"""</span></span><br><span class="line">        ret = func(*args, **kwargs)</span><br><span class="line">        <span class="string">"""执行被修饰函数后，进行的操作"""</span></span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"><span class="meta">@wrapper</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'in foo'</span>)</span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>

<p>这就是 <code>标准版的装饰器</code>。</p>
<p>其实，对于没有参数的函数，可以只写一层函数实现装饰器的功能：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(func)</span>:</span></span><br><span class="line">    print(<span class="string">'新加了一个功能'</span>)</span><br><span class="line">    <span class="keyword">return</span> func</span><br><span class="line"><span class="meta">@func</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="number">2</span>)</span><br><span class="line">index()</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">新加了一个功能</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>虽然也能实现新功能，但是不建议这样写，因为不是很规范。而且下面继续调用 index，并不会有新功能加入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(func)</span>:</span></span><br><span class="line">    print(<span class="string">'新加了一个功能'</span>)</span><br><span class="line">    <span class="keyword">return</span> func</span><br><span class="line"><span class="meta">@func    # index = func(index) --&gt; index = index</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="number">2</span>)</span><br><span class="line">index()</span><br><span class="line">index()</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">新加了一个功能</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>函数调用两次，但是新加功能仅执行了一次。这是因为在执行语法糖时，新的 <code>index</code> 最终的结果还是原来的 <code>index</code> 函数，而不是像标准装饰器中的 <a href="/python-basic/closure">闭包</a>。</p>
<h3 id="有参装饰器"><a href="#有参装饰器" class="headerlink" title="有参装饰器"></a>有参装饰器</h3><p>装饰器也是函数，就可以接受参数。如果有一天，我们想要给装饰器传递参数该怎么办呢？</p>
<p>或许我们可以在装饰器的外层再套一层函数 用来传参，就像这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decor</span><span class="params">(arg)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> arg:</span><br><span class="line">                print(<span class="string">'开始装饰'</span>)</span><br><span class="line">            ret = func(*args, **kwargs)</span><br><span class="line">            <span class="keyword">if</span> arg:</span><br><span class="line">                print(<span class="string">'装饰结束'</span>)</span><br><span class="line">            <span class="keyword">return</span> ret</span><br><span class="line">        <span class="keyword">return</span> inner</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'is index'</span>)</span><br></pre></td></tr></table></figure>

<p>如果还想以往那样直接在 <code>index</code> 函数的上面加语法糖 <code>@decor</code>，一来没有达到传入参数的目的，二来也会因为参数传入混乱而报错。</p>
<p>不过我们可以从昨天不用语法糖的方法配置装饰器的操作中获得启发，或许可以通过在下面加入这样几行代码来构建一个可以传入参数的装饰器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wrapper = decor(<span class="literal">True</span>)</span><br><span class="line">index = wrapper(index)</span><br><span class="line">index()</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">开始装饰</span><br><span class="line"><span class="keyword">is</span> index</span><br><span class="line">装饰结束</span><br></pre></td></tr></table></figure>

<p>其实我们已经成功构成了一个可以传入参数的装饰器。</p>
<p>现在，我们需要的，是把语法糖运用起来，让代码更加简明直观。</p>
<p>我们知道，语法糖 <code>@wrapper</code> 相当于 <code>index = wrapper(index)</code> 这条语句。而此时 <code>wrapper</code> 等同于 <code>decor(True)</code>。没错，对于带参数的装饰器而言，我们可以这样写语法糖：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decor</span><span class="params">(arg)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> arg:</span><br><span class="line">                print(<span class="string">'开始装饰'</span>)</span><br><span class="line">            ret = func(*args, **kwargs)</span><br><span class="line">            <span class="keyword">if</span> arg:</span><br><span class="line">                print(<span class="string">'装饰结束'</span>)</span><br><span class="line">            <span class="keyword">return</span> ret</span><br><span class="line">        <span class="keyword">return</span> inner</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@decor(True)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'is index'</span>)</span><br><span class="line">    </span><br><span class="line">index()</span><br></pre></td></tr></table></figure>

<p>这个装饰器中参数的作用是，当传入的值为 <code>True</code>，装饰器会被执行；当值为 <code>False</code>，装饰器不会被执行。</p>
<p>我们还可以通过使用带参数的装饰器，实现使用一个装饰器针对不同函数做出不同响应的效果。</p>
<p>例如，让用户选择要登陆的软件，然后针对不同软件使用各自的账号密码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">msg = <span class="string">"""</span></span><br><span class="line"><span class="string">1. 微信</span></span><br><span class="line"><span class="string">2. 抖音</span></span><br><span class="line"><span class="string">3. 邮箱</span></span><br><span class="line"><span class="string">请选择您要登陆软件的编号："""</span></span><br><span class="line">choose = input(msg)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth</span><span class="params">(arg)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            user = input(<span class="string">'用户名：'</span>)</span><br><span class="line">            pwd = input(<span class="string">'密码：'</span>)</span><br><span class="line">            <span class="keyword">if</span> arg == <span class="string">'1'</span>:</span><br><span class="line">                <span class="keyword">if</span> user == <span class="string">'alex'</span> <span class="keyword">and</span> pwd == <span class="string">'alex1234'</span>:</span><br><span class="line">                    func(*args, **kwargs)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    print(<span class="string">'账号或密码错误！'</span>)</span><br><span class="line">            <span class="keyword">elif</span> arg == <span class="string">'2'</span>:</span><br><span class="line">                <span class="keyword">if</span> user == <span class="string">'wusir'</span> <span class="keyword">and</span> pwd == <span class="string">'1234'</span>:</span><br><span class="line">                    func(*args, **kwargs)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    print(<span class="string">'账号或密码错误！'</span>)</span><br><span class="line">            <span class="keyword">elif</span> arg == <span class="string">'3'</span>:</span><br><span class="line">                <span class="keyword">if</span> user == <span class="string">'meet'</span> <span class="keyword">and</span> pwd == <span class="string">'1234'</span>:</span><br><span class="line">                    func(*args, **kwargs)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    print(<span class="string">'账号或密码错误！'</span>)</span><br><span class="line">        <span class="keyword">return</span> inner</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@auth(choose)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dy</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'抖音'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@auth(choose)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">email</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'邮箱'</span>)</span><br><span class="line">    </span><br><span class="line"><span class="meta">@auth(choose)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wechat</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'微信'</span>)</span><br><span class="line">    </span><br><span class="line">func_dic = &#123;</span><br><span class="line">    <span class="string">'1'</span>: wechat,</span><br><span class="line">    <span class="string">'2'</span>: dy,</span><br><span class="line">    <span class="string">'3'</span>: email,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> choose <span class="keyword">in</span> func_dic:</span><br><span class="line">    func_dic[choose]()</span><br></pre></td></tr></table></figure>

<p>事实上，我们上面的代码在装饰器中有很多重复代码，可以将它们封装到一个函数中。</p>
<p>在函数调用时，如果我们日后学到 <code>反射</code>，会简洁很多。</p>
<p>带参数的装饰器的应用场景为：flask 框架的路由就是有参装饰器。</p>
<h3 id="多个装饰器装饰一个函数"><a href="#多个装饰器装饰一个函数" class="headerlink" title="多个装饰器装饰一个函数"></a>多个装饰器装饰一个函数</h3><p>一个装饰器可以装饰多个函数，同样地，多个装饰器也可以装饰同一个函数。当多个装饰器装饰同一个函数时，先执行离被装饰函数最近的装饰器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'这是f1装饰器开始'</span>)</span><br><span class="line">        func(*args, **kwargs)</span><br><span class="line">        print(<span class="string">'这是f1装饰器结束'</span>)</span><br><span class="line">    <span class="keyword">return</span> f2</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo1</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo2</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'这是foo1装饰器开始'</span>)</span><br><span class="line">        func(*args, **kwargs)</span><br><span class="line">        print(<span class="string">'这是foo1装饰器结束'</span>)</span><br><span class="line">    <span class="keyword">return</span> foo2</span><br><span class="line"></span><br><span class="line"><span class="meta">@foo1      # index = foo1(index) --&gt; foo1(f2)</span></span><br><span class="line"><span class="meta">@f1        # index = f1(index) &lt;== f2</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'is index'</span>)</span><br><span class="line"></span><br><span class="line">index()</span><br></pre></td></tr></table></figure>

<p>返回的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">这是foo1装饰器开始</span><br><span class="line">这是f1装饰器开始</span><br><span class="line"><span class="keyword">is</span> index</span><br><span class="line">这是f1装饰器结束</span><br><span class="line">这是foo1装饰器结束</span><br></pre></td></tr></table></figure>

<p>程序的执行还是从上到下，只要按照流程一步一步走，还是能理清思路的。</p>
<img src="/python-basic/decorator/1569404672011.png" class="" width="1569404672011">

<p>对于套更多层的装饰器，规则也是相同的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(func)</span>:</span> <span class="comment"># func == index</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">"sss"</span>)</span><br><span class="line">        func(*args,**kwargs)</span><br><span class="line">        print(<span class="string">"stop"</span>)</span><br><span class="line">    <span class="keyword">return</span> f2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo1</span><span class="params">(func)</span>:</span> <span class="comment"># func == f2</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo2</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">"good"</span>)</span><br><span class="line">        func(*args,**kwargs)</span><br><span class="line">        print(<span class="string">"bbb"</span>)</span><br><span class="line">    <span class="keyword">return</span> foo2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ff</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ff2</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"is ff"</span>)</span><br><span class="line">        func()</span><br><span class="line">        print(<span class="string">"ff is"</span>)</span><br><span class="line">    <span class="keyword">return</span> ff2</span><br><span class="line"></span><br><span class="line"><span class="meta">@foo1</span></span><br><span class="line"><span class="meta">@ff</span></span><br><span class="line"><span class="meta">@f1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"is f"</span>)</span><br><span class="line">f()</span><br></pre></td></tr></table></figure>

<p>返回的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">good</span><br><span class="line"><span class="keyword">is</span> ff</span><br><span class="line">sss</span><br><span class="line"><span class="keyword">is</span> f</span><br><span class="line">stop</span><br><span class="line">ff <span class="keyword">is</span></span><br><span class="line">bbb</span><br></pre></td></tr></table></figure>

<p>我们其实可以发现这样一个规律：装饰器的执行是被装饰代码在最中间，外层装饰器的运行结果包裹着内层装饰器的运行结果。大体上呈现一个 <code>U</code> 字形：</p>
<img src="/python-basic/decorator/1569405238655.png" class="" width="1569405238655">

<p>对于多个装饰器装饰一个函数的情况，只需要记住一个原则：先执行离被装饰函数最近的装饰器。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/python-basic/closure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/python-basic/closure/" class="post-title-link" itemprop="url">闭包</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 13:53:36" itemprop="dateCreated datePublished" datetime="2020-02-15T13:53:36+08:00">2020-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-29 10:34:01" itemprop="dateModified" datetime="2020-02-29T10:34:01+08:00">2020-02-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">Python 基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在编程时，我们会处理到很多数据。但是对于一些数据，我们只想使用，不想修改。我们可以使用 <code>闭包</code> 来防止不经意间的数据修改。</p>
<p>闭包的作用主要有两个：</p>
<ol>
<li>保护数据安全</li>
<li>保护数据干净性</li>
</ol>
<p>满足下面两个条件的函数就是一个实用的闭包：</p>
<ol>
<li>在嵌套函数内，使用非全局变量（且不使用本层变量）</li>
<li>将嵌套函数本身返回</li>
</ol>
<p>我们可以用<code>.__closure__</code>方法来查看一个函数是否是一个闭包。当返回值为None时，说明该函数不是闭包，当返回值中有变量的内存地址时，说明该函数是一个闭包。</p>
<p>例如，下面的函数就是一个闭包：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    a = <span class="number">10</span>    <span class="comment"># 自由变量</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">        print(a)</span><br><span class="line">    <span class="keyword">return</span> foo</span><br><span class="line">f = func()</span><br><span class="line">print(f.__closure__)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&lt;cell at <span class="number">0x000001F7D6277648</span>: int object at <span class="number">0x00000000669D8190</span>&gt;,)</span><br></pre></td></tr></table></figure>

<p>方法中的 <code>closure</code> 就是 <code>闭包</code> 的意思。返回的 <code>cell</code> 是一个 <code>单元格</code> 对象，用来储存闭包中需要使用到的变量。</p>
<p>当函数执行完成后（也就是 <code>fun()</code> 这个步骤），函数体会被销毁。但是闭包 <code>foo</code> 被返回给了 <code>f</code>，还会被用到，所以照常存在。而闭包中需要使用的变量 <code>a</code>，此时已经不在函数 <code>func</code> 中，因为 <code>func</code> 本身已经不复存在。变量 <code>a</code> 在函数销毁后，升级为 <code>自由变量</code>。</p>
<p>闭包是怎么做到保护数据的作用的呢？</p>
<p>比如我们现在有这样一个需求：使用一个函数，每天输入当天营业额，打印出这几天的平均营业额。</p>
<p>如果我们把营业额的数据储存在列表中，放到全局，可以这样实现功能：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">lst = []</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ave_turnover</span><span class="params">(turnover_today)</span>:</span></span><br><span class="line">    lst.append(turnover_today)</span><br><span class="line">    ave = sum(lst) / len(lst)</span><br><span class="line">    print(ave)</span><br><span class="line">ave_turnover(<span class="number">12000</span>)</span><br><span class="line">ave_turnover(<span class="number">15000</span>)</span><br><span class="line">ave_turnover(<span class="number">14000</span>)</span><br><span class="line">ave_turnover(<span class="number">12000</span>)</span><br><span class="line">ave_turnover(<span class="number">25000</span>)</span><br><span class="line">ave_turnover(<span class="number">21000</span>)</span><br><span class="line">ave_turnover(<span class="number">9000</span>)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">12000.0</span></span><br><span class="line"><span class="number">13500.0</span></span><br><span class="line"><span class="number">13666.666666666666</span></span><br><span class="line"><span class="number">13250.0</span></span><br><span class="line"><span class="number">15600.0</span></span><br><span class="line"><span class="number">16500.0</span></span><br><span class="line"><span class="number">15428.57142857143</span></span><br></pre></td></tr></table></figure>

<p>如果有一天，我们不小心在全局对 <code>lst</code> 列表做了修改：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">lst = []</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ave_turnover</span><span class="params">(turnover_today)</span>:</span></span><br><span class="line">    lst.append(turnover_today)</span><br><span class="line">    ave = sum(lst) / len(lst)</span><br><span class="line">    print(ave)</span><br><span class="line">ave_turnover(<span class="number">12000</span>)</span><br><span class="line">ave_turnover(<span class="number">15000</span>)</span><br><span class="line">lst[<span class="number">1</span>] = <span class="number">10</span></span><br><span class="line">ave_turnover(<span class="number">14000</span>)</span><br><span class="line">ave_turnover(<span class="number">12000</span>)</span><br><span class="line">ave_turnover(<span class="number">25000</span>)</span><br><span class="line">ave_turnover(<span class="number">21000</span>)</span><br><span class="line">ave_turnover(<span class="number">9000</span>)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">12000.0</span></span><br><span class="line"><span class="number">13500.0</span></span><br><span class="line"><span class="number">8670.0</span></span><br><span class="line"><span class="number">9502.5</span></span><br><span class="line"><span class="number">12602.0</span></span><br><span class="line"><span class="number">14001.666666666666</span></span><br><span class="line"><span class="number">13287.142857142857</span></span><br></pre></td></tr></table></figure>

<p>这就导致了数据的改变，使得第三天之后的数据全都不准确。</p>
<p>如果我们把重要的数据 <code>lst</code> 封装到闭包中保护起来，就不会有这种烦恼了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ave_turnover</span><span class="params">()</span>:</span></span><br><span class="line">    lst = []</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(turnover_today)</span>:</span></span><br><span class="line">        lst.append(turnover_today)</span><br><span class="line">        ave = sum(lst) / len(lst)</span><br><span class="line">        print(ave)</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line">f = ave_turnover()</span><br><span class="line">f(<span class="number">12000</span>)</span><br><span class="line">f(<span class="number">15000</span>)</span><br><span class="line">lst = [<span class="number">10</span>]</span><br><span class="line">f(<span class="number">14000</span>)</span><br><span class="line">f(<span class="number">12000</span>)</span><br><span class="line">f(<span class="number">25000</span>)</span><br><span class="line">f(<span class="number">21000</span>)</span><br><span class="line">f(<span class="number">9000</span>)</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">12000.0</span></span><br><span class="line"><span class="number">13500.0</span></span><br><span class="line"><span class="number">13666.666666666666</span></span><br><span class="line"><span class="number">13250.0</span></span><br><span class="line"><span class="number">15600.0</span></span><br><span class="line"><span class="number">16500.0</span></span><br><span class="line"><span class="number">15428.57142857143</span></span><br></pre></td></tr></table></figure>

<p>对于闭包，除了 <code>.__closure__</code> 方法之外，还有可以用来查看自由变量的 <code>.__code__.co_freevars</code> 方法，和可以用来查看局部变量的 <code>.__code__.co_varnames</code> 方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ave_turnover</span><span class="params">()</span>:</span></span><br><span class="line">    lst = []</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(turnover_today)</span>:</span></span><br><span class="line">        lst.append(turnover_today)</span><br><span class="line">        ave = sum(lst) / len(lst)</span><br><span class="line">        print(ave)</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line">f = ave_turnover()</span><br><span class="line">print(f.__closure__)             <span class="comment"># 判定是否是一个闭包</span></span><br><span class="line">print(f.__code__.co_freevars)    <span class="comment"># 查看自由变量</span></span><br><span class="line">print(f.__code__.co_varnames)    <span class="comment"># 查看局部变量</span></span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(&lt;cell at <span class="number">0x0000027A31A27648</span>: list object at <span class="number">0x0000027A31AD8C08</span>&gt;,)</span><br><span class="line">(<span class="string">'lst'</span>,)</span><br><span class="line">(<span class="string">'turnover_today'</span>, <span class="string">'ave'</span>)</span><br></pre></td></tr></table></figure>

<p>没有将嵌套的函数返回的函数也可以是一个闭包，但是这个闭包没有办法被使用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    a = <span class="number">10</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">        print(a)</span><br><span class="line">    print(foo.__closure__)</span><br><span class="line">func()</span><br></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&lt;cell at <span class="number">0x000001BE85EA7648</span>: int object at <span class="number">0x00000000669D8190</span>&gt;,)</span><br></pre></td></tr></table></figure>

<p>闭包也可以通过外层函数加两个括号的方法来调用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    a = <span class="number">10</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">        print(a)</span><br><span class="line">    <span class="keyword">return</span> foo</span><br><span class="line">func()()</span><br></pre></td></tr></table></figure>

<p>外层函数的参数也是局部变量，所以内层函数使用外层参数的形式也可以构成闭包：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">        print(a)</span><br><span class="line">        print(b)</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line">a = <span class="number">11</span></span><br><span class="line">b = <span class="number">12</span></span><br><span class="line">ret = wrapper(a, b)</span><br><span class="line">print(ret.__closure__)</span><br><span class="line">print(ret.__code__.co_freevars)</span><br><span class="line">print(ret.__code__.co_varnames)</span><br><span class="line">ret()</span><br></pre></td></tr></table></figure>

<p>返回的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(&lt;cell at <span class="number">0x0000021A67AFB648</span>: int object at <span class="number">0x00000000702D81B0</span>&gt;, &lt;cell at <span class="number">0x0000021A67AFB9A8</span>: int object at <span class="number">0x00000000702D81D0</span>&gt;)</span><br><span class="line">(<span class="string">'a'</span>, <span class="string">'b'</span>)</span><br><span class="line">()</span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></table></figure>

<p>闭包的应用场景主要有两个：</p>
<ol>
<li>装饰器</li>
<li>防止数据被误改动</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/python-basic/mind-map/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/python-basic/mind-map/" class="post-title-link" itemprop="url">思维导图</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 13:53:36" itemprop="dateCreated datePublished" datetime="2020-02-15T13:53:36+08:00">2020-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-29 10:34:01" itemprop="dateModified" datetime="2020-02-29T10:34:01+08:00">2020-02-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">Python 基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>思维导图的作用主要是理清思路，用的时候顺藤摸瓜，能够随时联想到需要用到的知识点。</p>
<p>此外，也能更快索引。查阅笔记资料时，更加得心应手，效率高。</p>
<h3 id="推荐平台"><a href="#推荐平台" class="headerlink" title="推荐平台"></a>推荐平台</h3><ul>
<li><a href="https://www.processon.com/" target="_blank" rel="noopener">ProcessOn</a><ul>
<li>在线编辑，随处任何一台电脑都可以操作</li>
<li>分享方便，任何人不许额外安装任何程序即可查看</li>
<li>随时自动保存，文件在云端，几乎不会因意外原因丢失数据</li>
<li>免费</li>
</ul>
</li>
<li><a href="https://www.xmind.cn/" target="_blank" rel="noopener">XMind</a><ul>
<li>专注制作思维导图，设计很好看，很精致</li>
<li>断网时可以使用，且不受网速限制</li>
<li>可以付费升级专业版，免费版功能能应付大部分日常使用</li>
</ul>
</li>
</ul>
<h3 id="核心三个按键"><a href="#核心三个按键" class="headerlink" title="核心三个按键"></a>核心三个按键</h3><ol>
<li>空格（输入内容）</li>
<li>回车（生成同级节点）</li>
<li>Tab（生成次级节点）</li>
</ol>
<h3 id="制作技巧"><a href="#制作技巧" class="headerlink" title="制作技巧"></a>制作技巧</h3><ul>
<li>按照树形结构，从粗到细有序进行</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/translation/raspberry-gpio-python-examples/output/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/translation/raspberry-gpio-python-examples/output/" class="post-title-link" itemprop="url">GPIO 输出</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 13:53:14" itemprop="dateCreated datePublished" datetime="2020-02-15T13:53:14+08:00">2020-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-21 17:36:12" itemprop="dateModified" datetime="2020-02-21T17:36:12+08:00">2020-02-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91/" itemprop="url" rel="index"><span itemprop="name">官方文档翻译</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>GPIO模块的输出方法使用实例。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/translation/raspberry-gpio-python-examples/output/">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/python-basic/while-cycle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/python-basic/while-cycle/" class="post-title-link" itemprop="url">while 循环</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 13:53:10" itemprop="dateCreated datePublished" datetime="2020-02-15T13:53:10+08:00">2020-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-29 10:34:01" itemprop="dateModified" datetime="2020-02-29T10:34:01+08:00">2020-02-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">Python 基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="while-循环基本结构"><a href="#while-循环基本结构" class="headerlink" title="while 循环基本结构"></a>while 循环基本结构</h3><p>循环就是不断地重复着某件事情。<code>while</code> 是 while 循环的关键字。</p>
<p>while循环的基本结构：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> 条件:</span><br><span class="line">缩进 循环体</span><br></pre></td></tr></table></figure>

<p>典型 while 循环示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="number">1111</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:   <span class="comment"># 死循环</span></span><br><span class="line">    print(<span class="string">"坚强"</span>)</span><br><span class="line">    print(<span class="string">"过火"</span>)</span><br><span class="line">    print(<span class="string">"鸡你太美"</span>)</span><br><span class="line">    print(<span class="string">"大碗宽面"</span>)</span><br><span class="line">print(<span class="number">333</span>)</span><br></pre></td></tr></table></figure>

<p>上面的例子中，第一步，先打印 <code>1111</code>。第二步，进入 while 语句，判断 <code>while</code> 后的条件是否为真。<code>while</code> 后的语句是 <code>True</code>，为真，进入循环体中。第三步，打印 <code>坚强</code>。第四五六步分别打印出 <code>过火</code>、<code>鸡你太美</code> 和 <code>大碗宽面</code>。循环体中的内容运行完毕，程序又返回到 while 语句。第七步，继续判断 <code>while</code> 后的条件是否为真。然后继续进入循环体，重新打印内容。随后又返回到 while 语句中。因为 while 语句后面的条件一直都是 <code>True</code>，故而循环往复，永不停息，成为了死循环。最后一条的 <code>333</code> 永远也打印不出来。</p>
<img src="/python-basic/while-cycle/1567757718914.png" class="" width="1567757718914">

<h3 id="break-语句"><a href="#break-语句" class="headerlink" title="break 语句"></a>break 语句</h3><p>很显然，这样的死循环并不能满足我们日常编程的需要。如果能有办法限制循环次数，将会十分实用。在这里，我们可以引入 break 语句。break 可以终止当前循环。结合 if 条件语句，可以把死循环转换成有限的循环。例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 循环5次</span></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:  <span class="comment"># 死循环</span></span><br><span class="line">    count = count + <span class="number">1</span>  <span class="comment"># 先执行 = 右边的内容</span></span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">5</span>:</span><br><span class="line">        print(count)</span><br><span class="line">        <span class="keyword">break</span> <span class="comment"># 有限循环</span></span><br></pre></td></tr></table></figure>

<p>运行的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>在这个例子中，我们先定义了一个变量 <code>count</code> 用来计数，也称为 <code>计数器</code>。每一次循环，<code>count</code> 就会增加 <code>1</code>。当 <code>count</code> 等于 <code>5</code> 时，if 语句的条件成立，打印出当前 <code>count</code> 的数值，运行 <code>break</code>，退出循环。我们就成功把死循环转换成了有限循环。</p>
<img src="/python-basic/while-cycle/1567758395997.png" class="" width="1567758395997">

<h3 id="continue-语句"><a href="#continue-语句" class="headerlink" title="continue 语句"></a>continue 语句</h3><p>除了 <code>break</code>，while 循环中还有一个很重要的语句 <code>continue</code>。<code>continue</code> 语句的意思是跳出本次循环，继续下次循环。用通俗的话来讲，<code>continue</code> 就是伪装成循环体中最后一行代码。例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:  <span class="comment"># 死循环</span></span><br><span class="line">    count = count + <span class="number">1</span>  <span class="comment"># 先执行 = 右边的内容</span></span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">5</span>:</span><br><span class="line">        print(<span class="number">111</span>)</span><br><span class="line">        <span class="keyword">continue</span>  <span class="comment"># continue 就是伪装成循环体中最后一行代码</span></span><br><span class="line">    print(count)</span><br></pre></td></tr></table></figure>

<p>很显然，这还是一个死循环。只不过当计数器 <code>count</code> 等于 <code>5</code> 的时候，会打印一次 <code>111</code>，并且这次的 <code>count</code>，也就是 <code>5</code>，不会被打印出来。</p>
<img src="/python-basic/while-cycle/QQ%E5%9B%BE%E7%89%8720190906145135.png" class="" title="QQ图片20190906145135">

<h3 id="条件控制循环"><a href="#条件控制循环" class="headerlink" title="条件控制循环"></a>条件控制循环</h3><p>除了通过使用 break 关键字来终止循环，我们还可以通过 while 后面的条件来控制循环次数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count &lt; <span class="number">2</span>:</span><br><span class="line">    print(count)</span><br><span class="line">    count = count + <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>打印出的结果为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>在上面的例子中，最开始计数器 <code>count</code> 的值为 <code>0</code>。然后运行到 while 条件，<code>count &lt; 2</code> 是成立的，于是进入循环体。首先把 <code>count</code> 的内容 <code>0</code> 打印出来，然后 <code>count</code> 增加 <code>1</code>，进入下一次循环。第二次循环也一样，打印 <code>1</code> 之后，<code>count</code> 变成了 <code>2</code>，再回到 while 判断语句。此时，<code>count &lt; 2</code> 不成立，循环终止。</p>
<img src="/python-basic/while-cycle/QQ%E5%9B%BE%E7%89%8720190906145142.png" class="" title="QQ图片20190906145142">

<h3 id="while-else-语句"><a href="#while-else-语句" class="headerlink" title="while else 语句"></a>while else 语句</h3><p>while 语句也有判断的行为，所以也可以配合 else 语句使用。while else 结构和 if else 结构很相似。只有当 while 后判断的条件不成立时，才会执行 else 中的语句。如果循环中没有 break，else 语句中的内容将在循环结束后执行；如果循环中有 break，else 语句中的内容有可能不被执行。观察下面两个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="number">222</span>)</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count &lt; <span class="number">3</span>:</span><br><span class="line">    print(count)</span><br><span class="line">    count = count + <span class="number">1</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="number">111</span>)</span><br><span class="line"><span class="comment"># 运行结果: 222 0 1 2 111</span></span><br><span class="line"></span><br><span class="line">print(<span class="number">222</span>)</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count &lt; <span class="number">3</span>:</span><br><span class="line">    print(count)</span><br><span class="line">    count = count + <span class="number">1</span></span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="number">111</span>)</span><br><span class="line"><span class="comment"># 运行结果: 222 0</span></span><br></pre></td></tr></table></figure>

<p>在第一个例子中，经过三次循环后，计数器 <code>count</code> 的值将增加到 <code>3</code>。此时，条件 <code>count &lt; 3</code> 不再满足，跳出循环，执行 <code>else</code> 语句，打印出 <code>111</code> 来。而第二个例子中，在第一次循环中就遇到了 <code>break</code>，循环被强行终止，并没有再次判断 <code>count &lt; 3</code>，于是就不会进入到 <code>else</code> 中，<code>111</code> 便打印不出来。</p>
<h3 id="while-循环小结"><a href="#while-循环小结" class="headerlink" title="while 循环小结"></a>while 循环小结</h3><ul>
<li><p>while循环基本结构：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> 条件:</span><br><span class="line">缩进 循环体</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>break</code>：终止当前循环</p>
</li>
<li><p><code>continue</code>：跳出本次循环，继续下次循环（就是伪装成循环体中最后一行代码）</p>
</li>
<li><p><code>continue</code> 和 <code>break</code> 下方的代码都不会执行</p>
</li>
<li><p><code>while</code> 循环可以通过条件控制循环的次数</p>
</li>
<li><p><code>while</code> 语句可以和 <code>else</code> 语句配合使用，当 <code>while</code> 后的条件不满足时，将会运行 <code>else</code> 中的语句。</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/python-basic/var-const-com/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/python-basic/var-const-com/" class="post-title-link" itemprop="url">变量、常量和注释</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 13:53:08" itemprop="dateCreated datePublished" datetime="2020-02-15T13:53:08+08:00">2020-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-29 10:34:01" itemprop="dateModified" datetime="2020-02-29T10:34:01+08:00">2020-02-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">Python 基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>先介绍一个 <code>print</code> 函数，用来打印（输出）数据。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="number">111</span>)</span><br><span class="line"><span class="number">111</span></span><br></pre></td></tr></table></figure>

<p>变量的官方定义：将程序中运行的中间值，临时存储起来，以便再次使用。</p>
<p>通俗来讲，变量就是给数据起一个昵称，方便调用。</p>
<p>下面的是一个典型的赋值变量的语句：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">"alex"</span></span><br></pre></td></tr></table></figure>

<p>其中，<code>alex</code> 是赋值给变量的值，也就是数据；<code>=</code> 代表的是赋值操作；<code>name</code> 是变量名。通过 <code>print(name)</code> 操作来使用定义的变量名：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = <span class="string">"alex"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(name)</span><br><span class="line">alex</span><br></pre></td></tr></table></figure>

<p>变量名（其他 Python 中的标识符如函数名、类名、模块名等也要遵循这个规则）命名规范：</p>
<ol>
<li>变量名只能由数字、字母和下划线组成</li>
<li>不能以数字开头</li>
<li>禁止使用python中的关键字</li>
<li>变量名要具有可描述性</li>
<li>变量名要区分大小写</li>
<li>不能使用中文和拼音</li>
<li>推荐写法：<ul>
<li>驼峰体</li>
<li>下划线（官方推荐）</li>
</ul>
</li>
</ol>
<p>以数字为开头命名变量会报错：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span>a = <span class="string">'alex'</span></span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span></span><br><span class="line">    <span class="number">1</span>a = <span class="string">'alex'</span></span><br><span class="line">     ^</span><br><span class="line">SyntaxError: invalid syntax</span><br></pre></td></tr></table></figure>

<p>驼峰体和下划线命名变量示例，很显然下划线的命名法更直观些：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AlexOfOldboy = <span class="number">89</span>	<span class="comment"># 这是驼峰体</span></span><br><span class="line">alex_of_oldboy = <span class="number">89</span>	<span class="comment"># 这是下划线</span></span><br></pre></td></tr></table></figure>

<p>Python 中的变量名是区分大小写的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = <span class="string">'alex'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Name = <span class="string">'leo'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(name)</span><br><span class="line">alex</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(Name)</span><br><span class="line">leo</span><br></pre></td></tr></table></figure>

<p>Python 中的关键字：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'False'</span>, <span class="string">'None'</span>, <span class="string">'True'</span>, <span class="string">'and'</span>, <span class="string">'as'</span>, <span class="string">'assert'</span>, <span class="string">'break'</span>, <span class="string">'class'</span>, <span class="string">'continue'</span>, <span class="string">'def'</span>, <span class="string">'del'</span>, <span class="string">'elif'</span>, <span class="string">'else'</span>, <span class="string">'except'</span>, <span class="string">'finally'</span>, <span class="string">'for'</span>, <span class="string">'from'</span>, <span class="string">'global'</span>, <span class="string">'if'</span>, <span class="string">'import'</span>, <span class="string">'in'</span>, <span class="string">'is'</span>, <span class="string">'lambda'</span>, <span class="string">'nonlocal'</span>, <span class="string">'not'</span>, <span class="string">'or'</span>,<span class="string">'pass'</span>, <span class="string">'raise'</span>, <span class="string">'return'</span>, <span class="string">'try'</span>, <span class="string">'while'</span>, <span class="string">'with'</span>, <span class="string">'yield'</span>]</span><br></pre></td></tr></table></figure>

<p><code>print</code> 可以打印多个内容，以逗号分隔：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>age1 = <span class="number">19</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(age, age1)</span><br><span class="line"><span class="number">18</span> <span class="number">19</span></span><br></pre></td></tr></table></figure>

<p>请看下面一段赋值操作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">age = <span class="number">18</span></span><br><span class="line">age1 = age</span><br><span class="line">age2 = age1</span><br><span class="line">age = <span class="number">20</span></span><br><span class="line">age1 = <span class="number">19</span></span><br><span class="line">print(age, age1, age2)</span><br></pre></td></tr></table></figure>

<p>最终打印出来的结果是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">20</span> <span class="number">19</span> <span class="number">18</span></span><br></pre></td></tr></table></figure>

<p>具体的赋值操作如下图所示：</p>
<img src="/python-basic/var-const-com/QQ%E5%9B%BE%E7%89%8720190905213207.png" class="" title="QQ图片20190905213207">

<p>第一步，在内存中开辟一块内存，把 <code>18</code> 储存在内存中。然后变量名 <code>age</code> 指向 <code>18</code> 对应的内存地址。第二步和第三步，<code>age1</code> 和 <code>age2</code> 也分别指向 <code>18</code> 的内存地址。第四步，变量名 <code>age</code> 指向 <code>20</code> 对应的内存地址，同时不再指向 <code>18</code>。第五步，变量名 <code>age1</code> 指向 <code>19</code> 对应的内存地址，同时不再指向 <code>18</code>。最终的结果是，<code>age2</code> 指向 <code>18</code>，<code>age1</code> 指向 <code>19</code>，<code>age</code> 指向 <code>20</code>。</p>
<h3 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h3><p>在 Python 中，没有严格意义的常量。大家约定俗成的是，变量名大写的变量就被视为常量，在程序执行过程中一般不会被轻易修改。例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ID = <span class="number">110120130140150</span></span><br><span class="line">ID = <span class="string">"123123213"</span>    <span class="comment"># 不建议在程序执行过程中随意修改</span></span><br></pre></td></tr></table></figure>

<p>变量与常量的应用场景：</p>
<ul>
<li>变量用于我们后期开发使用</li>
<li>常量用于配置文件中</li>
</ul>
<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p>注释的作用是给一些晦涩难懂的代码进行标注或解释。被注释的代码不会被执行。</p>
<p>Python 中的注释分为两种：</p>
<ul>
<li>单行注释（当行注释）：用 <code>#</code> 开头表示</li>
<li>多行注释：用三对 <code>“ ”</code> 或 <code>‘ ’</code> 包裹，可以换行</li>
</ul>
<p>具体示例为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这个是单行注释的示例</span></span><br><span class="line"><span class="comment"># 换行之后要在开头加一个#</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">窗前明月光,</span></span><br><span class="line"><span class="string">玻璃好上霜.</span></span><br><span class="line"><span class="string">要不及时擦,</span></span><br><span class="line"><span class="string">整不好就脏.</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sliu.vip/notes/django-distribute-static/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="刘硕">
      <meta itemprop="description" content="不成为自己讨厌的人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘硕的技术查阅手册">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/notes/django-distribute-static/" class="post-title-link" itemprop="url">使用 Django 搭建静态文件分发服务器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 13:53:03" itemprop="dateCreated datePublished" datetime="2020-02-15T13:53:03+08:00">2020-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-02-29 10:34:01" itemprop="dateModified" datetime="2020-02-29T10:34:01+08:00">2020-02-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习实践笔记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="问题的产生"><a href="#问题的产生" class="headerlink" title="问题的产生"></a>问题的产生</h2><p>CRM 项目已经想好，想要部署到线上。</p>
<p>将 Django 项目部署项目之前，将 settings 中的 DEBUG 变量设置成 False，并指定授权访问的 IP：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DEBUG = <span class="literal">False</span></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">'*'</span>]    <span class="comment"># '*'代表允许所有 IP 访问项目</span></span><br></pre></td></tr></table></figure>

<p>然后以 <code>0.0.0.0:80</code> 启动 Django 项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo python3 manage.py runserver 0.0.0.0:80</span><br></pre></td></tr></table></figure>

<p>浏览器输入服务器的 IP 访问项目。却发现什么样式都不见了。</p>
<img src="/notes/django-distribute-static/1579001343615.png" class="" width="1579001343615">

<p>造成这种情况的原因是，Django 线上模式的静态文件托管是无效的。因为 Django 的静态文件托管很脆弱，无法应对复杂的线上环境。</p>
<p>我们知道这是 Django 的好心。可是对我来说却坏透了：除了 Django 之外，我不知道别的静态文件托管方式。</p>
<p>老师说，可以使用 Nginx 托管静态文件，但是这东西我也只知其名，根本不会用。</p>
<p>也就是说，现在的我处在一个尴尬的空窗期：能用 Django 把项目写出来，但是没办法部署到线上。</p>
<p>上次的 rbac 项目我成功使用码云的 <code>Gitee Pages</code> 服务托管了静态文件。但是一来，我不能过分依赖别人——码云服务器并不稳定，而且偶尔会拒绝外部访问。二来，这次我试图用码云托管静态文件时，出现了错误， <code>Gitee Pages</code> 服务干脆不能启动。</p>
<img src="/notes/django-distribute-static/1579001813164.png" class="" width="1579001813164">

<p>如果慢慢研究，我或许能找出其中的问题。但有一个念头出现在我的脑海，其实这个想法我一直都有，那就是，我可不可以<strong>把静态文件也部署到服务器上</strong>，使用除 80 之外的端口（比如：8080）。而项目中的静态文件也不使用 Django 托管，而是让它去服务器中拿。</p>
<p>我觉得这是可行。一不做二不休，干起来呀~</p>
<h2 id="静态文件托管项目"><a href="#静态文件托管项目" class="headerlink" title="静态文件托管项目"></a>静态文件托管项目</h2><p>新建一个 Django 项目，把需要部署的静态文件放到一个文件夹中。为了图方便，我直接放在了 template 文件夹中。这是不规范的，因为 template 文件夹一般放的都是 html 文件。因为是权宜之计，而且也没有指望在这个项目里放什么 html 文件，让这个目录空着也不太好不是。</p>
<img src="/notes/django-distribute-static/1579002751188.png" class="" width="1579002751188">

<p>文件拷贝完成，就该指定规则。</p>
<p>我的思路是，当有访问请求过来时，<strong>根据访问请求的路径，返回他需要的静态文件</strong>。比如，当访问请求是 <code>IP:PORT/NBCrm/adminAuth/css/style.css</code> 时，就返回给他 <code>\templates\NBCrm\auth\css\style.css</code> 这个文件。</p>
<p>若根据不同请求分别配置 url 路由显然是不恰当的。首先，静态文件太多，我不可能给每个文件都分配路由，写视图函数。然后，那样的写法可移植性太差。如果我需要增加静态文件，还要再分配路由，再写视图函数。也会有大量重复代码。总是，是很不合理的。</p>
<p>既然要处理所有的请求，我何不干脆在中间件针对所有的请求进行处理呢？也就是说，当访问请求过来时，先在中间件处理。中间件拿到请求的路径，直接把文件返回给访问者，就不去找路由了。这样一来，路径就成了参数，我们只需要写一个函数就能完成文件处理了。</p>
<p>写成的代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> StreamingHttpResponse</span><br><span class="line"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StaticDirect</span><span class="params">(MiddlewareMixin)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        base_dir = settings.BASE_DIR</span><br><span class="line">        <span class="comment"># URL路径之间以“/”分隔，但是Windows系统中的路径分隔符是“\”，所以要拆分重组</span></span><br><span class="line">        request_path_list = request.path.split(<span class="string">'/'</span>)</span><br><span class="line">        <span class="comment"># 拼接文件路径，我的静态文件放在了 templates 文件夹下</span></span><br><span class="line">        file_path = os.path.join(base_dir, <span class="string">'templates'</span>, *request_path_list)</span><br><span class="line">        file_name = os.path.basename(file_path)</span><br><span class="line">        <span class="comment"># 以下是返回文件的基本操作</span></span><br><span class="line">        file = open(file_path, <span class="string">'rb'</span>)</span><br><span class="line">        response = StreamingHttpResponse(file)</span><br><span class="line">        response[<span class="string">'Content-Type'</span>] = <span class="string">'application/octet-stream'</span></span><br><span class="line">        response[<span class="string">'Content-Disposition'</span>] = <span class="string">f'attachment;filename="<span class="subst">&#123;file_name&#125;</span>"'</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p>不要忘了在 settings.py 的设置中加入我们的中间件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">'django.middleware.security.SecurityMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.common.CommonMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.csrf.CsrfViewMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages.middleware.MessageMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,</span><br><span class="line">    <span class="string">'app01.mymiddlewares.mymiddleware.LoginAuth'</span>,</span><br><span class="line">    <span class="string">'rbac.mymiddleware.auth.Auth'</span>,    <span class="comment"># 也就是这一行</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>至此，我们静态文件托管项目已经基本完成。非常容易对不对~</p>
<h2 id="原项目（CRM）的修改"><a href="#原项目（CRM）的修改" class="headerlink" title="原项目（CRM）的修改"></a>原项目（CRM）的修改</h2><p>我最开始的想法是，让静态文件托管项目在本地运行，也就是把 IP 设置成 <code>127.0.0.1</code>。那么如果我要访问静态文件，比如刚刚的 <code>style.css</code>，只需要把 css 样式的引入方式写成：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://127.0.0.1:8080/NBCrm/adminAuth/css/style.css"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们在调试时，css 文件的引入方式为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'auth/css/style.css' %&#125;"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们发现，如果我们使用新的写法，会对原来的写法有较大改动，一条一条改起来很麻烦。</p>
<p>另一方面，我们或许会改变 IP 和端口号。对于前面的写法，修改起来是极麻烦的。</p>
<p>于是，我决定通过自定义标签的方式对原来的代码进行修改。自定义标签这样写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> template</span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line">register = template.Library()</span><br><span class="line"></span><br><span class="line"><span class="meta">@register.simple_tag</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">static_url</span><span class="params">(static_path)</span>:</span></span><br><span class="line">    static_list = static_path.split(<span class="string">'/'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'/'</span>.join([settings.STATIC_HOST] + static_list)</span><br></pre></td></tr></table></figure>

<p>静态文件托管项目的ip和端口信息记录在 <code>setting.py</code> 文件的 <code>STATIC_HOST</code> 中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STATIC_HOST = <span class="string">'http://127.0.0.1:8080'</span></span><br></pre></td></tr></table></figure>

<p>我给自定义标签取的名字为 <code>static_url</code>。这样，我只需要修改少量代码就可以顺利指向我们的静态文件托管项目上来：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static_url 'NBCrm/auth/css/style.css' %&#125;"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>路径前面加了一个 NBCrm 是因为要区分 CRM 项目 和 rbac 项目而分别建立的两个文件夹。其实不这样做也是可以的，仅仅是为了增加程序的规范性（时而要规范，时而不规范，真香~）。</p>
<p>把所有的静态文件都按此格式修改，就算大功告成。以后要想修改 IP 地址或端口，直接去 <code>settings.py</code> 文件中修改相应的内容即可。</p>
<h2 id="静态文件托管在-127-0-0-1-测试"><a href="#静态文件托管在-127-0-0-1-测试" class="headerlink" title="静态文件托管在 127.0.0.1 测试"></a>静态文件托管在 <code>127.0.0.1</code> 测试</h2><p>现在，我们完成了静态文件托管项目的创建和原项目为使用托管项目而做出的修改。万事俱备，只欠东风。</p>
<p>把项目传到服务器上。可以使用 ftp，也可以使用 git，都挺好用的。</p>
<p>然后，按预定的思路，先在 <code>127.0.0.1:8080</code> 下，以 nohub 模式启动静态文件托管系统（首先当然要用 cd 命令把工作目录转到静态文件托管系统项目目录下）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nohup python3 manage.py runserver 127.0.0.1:8080 &amp;</span><br></pre></td></tr></table></figure>

<p>接着，在 80 端口，以线上模式部署 CRM 项目（当然也要先 cd 目录）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo python3 manage.py runserver 0.0.0.0:80</span><br></pre></td></tr></table></figure>

<p>打开浏览器测试。果然不出所料，没有成功/(ㄒoㄒ)/~~</p>
<img src="/notes/django-distribute-static/1579005785237.png" class="" width="1579005785237">

<p>思考一下浏览器请求的顺序，便可恍然大悟。首先，浏览器向服务器发送访问请求。CRM项目，也就是 Django 帮我们渲染好页面，并返回给我们。注意下图中的第三步我加粗的部分：渲染出来的 IP 是 <code>127.0.0.1</code>。这些内容会以 HTML 页面的形式返回到我们的浏览器中。浏览器解析页面，当发现这个样式外链时，自然会去相应的地址发出请求。而这个地址是 <code>127.0.0.1</code>，也就是指代用户的电脑。于是就向用户电脑发送访问请求。很显然，用户电脑上是没有静态文件托管系统的，于是什么静态文件也拿不到。而对于我们服务器上的静态文件托管系统，却无人对其访问。![静态文件托管系统ip问题 (django-distribute-static.assets\静态文件托管系统ip问题 (1).png)](C:\Users\Sure\OneDrive - RLS ,inc\Downloads\静态文件托管系统ip问题 (1).png)</p>
<p>这样看来，将静态文件托管到本地回环地址 <code>127.0.0.1</code> 是不合理的。把它以线上模式部署也变成了理所当然的选择。</p>
<h2 id="静态文件以线上模式托管"><a href="#静态文件以线上模式托管" class="headerlink" title="静态文件以线上模式托管"></a>静态文件以线上模式托管</h2><p>上文说到，静态文件不该托管在  <code>127.0.0.1</code>。若要以线上模式托管，就要修改 <code>settings.py</code> 的配置。文章最开始的地方已经提到了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DEBUG = <span class="literal">False</span></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">'*'</span>]</span><br></pre></td></tr></table></figure>

<p>Django 文件可以在不停止项目运行的情况下修改，所以一般情况无需终止进程。不过这次我们要修改 IP，所以还是要终止一下。</p>
<p>首先，使用命令找到 Django 的进程号：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep <span class="string">"python"</span></span><br></pre></td></tr></table></figure>

<p>得到的结果是这样的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root       924     1  0  2019 ?        00:00:00 /usr/bin/python3 /usr/bin/networkd-dispatcher --run-startup-triggers</span><br><span class="line">root       962     1  0  2019 ?        00:00:00 /usr/bin/python3 /usr/share/unattended-upgrades/unattended-upgrade-shutdown --<span class="built_in">wait</span>-for-signal</span><br><span class="line">root      8618 26216  0 21:17 pts/0    00:00:00 sudo nohup python3 manage.py runserver 127.0.0.1:8080</span><br><span class="line">root      8619  8618  0 21:17 pts/0    00:00:00 python3 manage.py runserver 127.0.0.1:8080</span><br><span class="line">root      8630  8619  1 21:17 pts/0    00:00:00 /usr/bin/python3 manage.py runserver 127.0.0.1:8080</span><br><span class="line">ubuntu    8718 26216  0 21:18 pts/0    00:00:00 grep --color=auto python</span><br><span class="line">root     25109     1  0 Jan12 ?        00:00:00 sudo nohup python3 manage.py runserver 0.0.0.0:80</span><br><span class="line">root     25110 25109  0 Jan12 ?        00:00:00 python3 manage.py runserver 0.0.0.0:80</span><br><span class="line">root     25117 25110  0 Jan12 ?        00:20:57 /usr/bin/python3 manage.py runserver 0.0.0.0:80</span><br></pre></td></tr></table></figure>

<p>我们找到 <code>/usr/bin/python3 manage.py runserver 127.0.0.1:8080</code> 对应的进程，其编号是 8630，使用命令将其终止：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">kill</span> -s 9 8630</span><br></pre></td></tr></table></figure>

<p>然后，以线上模式运行我们的静态文件托管项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nohup python3 manage.py runserver 0.0.0.0:8080 &amp;</span><br></pre></td></tr></table></figure>

<p>再次访问，就会发现，页面成了这个样子：</p>
<img src="/notes/django-distribute-static/1579008162415.png" class="" width="1579008162415">

<p>这怎么说呢？成功一半：图片成功返回，但是样式全部失效。其实也可以说，我们成功了一多半：图片顺利出现，说明连接已经顺利建立，我们成功和静态文件托管系统通信。而且如果我们使用浏览器的控制台查看网络情况就会发现，其实我们的 css 和 js 文件也都接收到了，只是样式没有生效而已：</p>
<img src="/notes/django-distribute-static/1579009110902.png" class="" width="1579009110902">

<p>此时，其实已经超出我所学的范围了。不过我还是有一个不置可否地猜测：是不是浏览器在接收样式文件时需要声明一下文件类型，才能应用样式呢？</p>
<p>于是，我开始进行对返回文档格式进行指定的尝试。</p>
<h2 id="指定静态文件的格式"><a href="#指定静态文件的格式" class="headerlink" title="指定静态文件的格式"></a>指定静态文件的格式</h2><p>我的这个猜想并不是凭空产生的。还记得我们在写静态文件托管项目的时候，我说，有一段是返回文件的固定写法吗？也就是这段代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">file = open(file_path, <span class="string">'rb'</span>)</span><br><span class="line">response = StreamingHttpResponse(file)</span><br><span class="line">response[<span class="string">'Content-Type'</span>] = <span class="string">'application/octet-stream'</span></span><br><span class="line">response[<span class="string">'Content-Disposition'</span>] = <span class="string">f'attachment;filename="<span class="subst">&#123;file_name&#125;</span>"'</span></span><br></pre></td></tr></table></figure>

<p>按道理讲，这四行代码，每一行都改有其存在的意义，也就是有修改的必要。否则，应该封装到方法中，而不是每次都要进行配置。出第三行外，每一行代码的作用都显而易见，我也不必多说。</p>
<p>唯独这第三行代码，从名称上看，该是指定文件的类型的。但是我一直都是使用这种写法，从来没有改过。但既然可以指定，就应该能指定成其他形式。想到在 css 样式的格式似乎是 “text/css”，js 的格式该是“text/javascript”。抱着试试看的态度，我把代码写成了这个样子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">f_extension = os.path.splitext(file_name)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> f_extension == <span class="string">'.css'</span>:</span><br><span class="line">    print(<span class="string">'css'</span>)</span><br><span class="line">    response[<span class="string">'Content-Type'</span>] = <span class="string">'text/css'</span></span><br><span class="line"><span class="keyword">elif</span> f_extension == <span class="string">'.js'</span>:</span><br><span class="line">    print(<span class="string">'js'</span>)</span><br><span class="line">    response[<span class="string">'Content-Type'</span>] = <span class="string">'text/javascript'</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    response[<span class="string">'Content-Type'</span>] = <span class="string">'application/octet-stream'</span></span><br></pre></td></tr></table></figure>

<p>再次刷新运行，终于，得偿所愿，所有样式全部出现：</p>
<img src="/notes/django-distribute-static/1579009847425.png" class="" width="1579009847425">

<p>不过故事到这里还没有完全结束，因为很显然，文件类型不仅仅有 css 和 js 两种。对于其他数据类型，尤其是各种图片，万一也需要指定格式，岂不是又无法识别了吗？</p>
<p>我猜想，这种格式要求应该是 http 协议簇中有规定的。于是在网上一搜，果不其然，搜到 HTTP content-type 对照表。针对不同的文件扩展名，给出特定的 content-type 规范写法，比如：</p>
<table>
<thead>
<tr>
<th align="left">文件扩展名</th>
<th align="left">Content-Type(Mime-Type)</th>
<th align="left">文件扩展名</th>
<th align="left">Content-Type(Mime-Type)</th>
</tr>
</thead>
<tbody><tr>
<td align="left">.*（ 二进制流，不知道下载文件类型）</td>
<td align="left">application/octet-stream</td>
<td align="left">.tif</td>
<td align="left">image/tiff</td>
</tr>
<tr>
<td align="left">.001</td>
<td align="left">application/x-001</td>
<td align="left">.301</td>
<td align="left">application/x-301</td>
</tr>
<tr>
<td align="left">.323</td>
<td align="left">text/h323</td>
<td align="left">.906</td>
<td align="left">application/x-906</td>
</tr>
<tr>
<td align="left">.907</td>
<td align="left">drawing/907</td>
<td align="left">.a11</td>
<td align="left">application/x-a11</td>
</tr>
<tr>
<td align="left">.acp</td>
<td align="left">audio/x-mei-aac</td>
<td align="left">.ai</td>
<td align="left">application/postscript</td>
</tr>
<tr>
<td align="left">.aif</td>
<td align="left">audio/aiff</td>
<td align="left">.aifc</td>
<td align="left">audio/aiff</td>
</tr>
</tbody></table>
<p>更加详细的可以参见 <a href="https://www.runoob.com/http/http-content-type.html" target="_blank" rel="noopener">HTTP content-type</a> 。</p>
<p>使用简单的脚本，即可得到文件扩展名和 content-type 作为键值对的字典。这个字典我贴在了文章的最底下，各位朋友若有需要，请自便。</p>
<p>有了这个字典，稍加修饰，便让代码更加简洁，通用性也更强：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StaticDirect</span><span class="params">(MiddlewareMixin)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        base_dir = settings.BASE_DIR</span><br><span class="line">        print(request.path)</span><br><span class="line">        request_path_list = request.path.split(<span class="string">'/'</span>)</span><br><span class="line">        file_path = os.path.join(base_dir, <span class="string">'templates'</span>, *request_path_list)</span><br><span class="line">        file_name = os.path.basename(file_path)</span><br><span class="line">        file = open(file_path, <span class="string">'rb'</span>)</span><br><span class="line">        response = StreamingHttpResponse(file)</span><br><span class="line">        f_extension = os.path.splitext(file_name)[<span class="number">1</span>]</span><br><span class="line">        response[<span class="string">'Content-Type'</span>] = content_type_dict.get(f_extension) <span class="keyword">or</span> content_type_dict.get(<span class="string">'.*'</span>)</span><br><span class="line">        response[<span class="string">'Content-Disposition'</span>] = <span class="string">f'attachment;filename="<span class="subst">&#123;file_name&#125;</span>"'</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p>倒数第二行代码我使用了一个短路操作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response[<span class="string">'Content-Type'</span>] = content_type_dict.get(f_extension) <span class="keyword">or</span> content_type_dict.get(<span class="string">'.*'</span>)</span><br></pre></td></tr></table></figure>

<p>意思是，如果字典中没有找到相应的后缀名，就用通用模式返回数据。</p>
<h1 id="HTTP-content-type-与扩展名对应字典"><a href="#HTTP-content-type-与扩展名对应字典" class="headerlink" title="HTTP content-type 与扩展名对应字典"></a>HTTP content-type 与扩展名对应字典</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br></pre></td><td class="code"><pre><span class="line">content_type_dict=&#123;</span><br><span class="line">    <span class="string">'.*'</span>: <span class="string">'application/octet-stream'</span>,</span><br><span class="line">    <span class="string">'.tif'</span>: <span class="string">'application/x-tif'</span>,</span><br><span class="line">    <span class="string">'.001'</span>: <span class="string">'application/x-001'</span>,</span><br><span class="line">    <span class="string">'.301'</span>: <span class="string">'application/x-301'</span>,</span><br><span class="line">    <span class="string">'.323'</span>: <span class="string">'text/h323'</span>,</span><br><span class="line">    <span class="string">'.906'</span>: <span class="string">'application/x-906'</span>,</span><br><span class="line">    <span class="string">'.907'</span>: <span class="string">'drawing/907'</span>,</span><br><span class="line">    <span class="string">'.a11'</span>: <span class="string">'application/x-a11'</span>,</span><br><span class="line">    <span class="string">'.acp'</span>: <span class="string">'audio/x-mei-aac'</span>,</span><br><span class="line">    <span class="string">'.ai'</span>: <span class="string">'application/postscript'</span>,</span><br><span class="line">    <span class="string">'.aif'</span>: <span class="string">'audio/aiff'</span>,</span><br><span class="line">    <span class="string">'.aifc'</span>: <span class="string">'audio/aiff'</span>,</span><br><span class="line">    <span class="string">'.aiff'</span>: <span class="string">'audio/aiff'</span>,</span><br><span class="line">    <span class="string">'.anv'</span>: <span class="string">'application/x-anv'</span>,</span><br><span class="line">    <span class="string">'.asa'</span>: <span class="string">'text/asa'</span>,</span><br><span class="line">    <span class="string">'.asf'</span>: <span class="string">'video/x-ms-asf'</span>,</span><br><span class="line">    <span class="string">'.asp'</span>: <span class="string">'text/asp'</span>,</span><br><span class="line">    <span class="string">'.asx'</span>: <span class="string">'video/x-ms-asf'</span>,</span><br><span class="line">    <span class="string">'.au'</span>: <span class="string">'audio/basic'</span>,</span><br><span class="line">    <span class="string">'.avi'</span>: <span class="string">'video/avi'</span>,</span><br><span class="line">    <span class="string">'.awf'</span>: <span class="string">'application/vnd.adobe.workflow'</span>,</span><br><span class="line">    <span class="string">'.biz'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.bmp'</span>: <span class="string">'application/x-bmp'</span>,</span><br><span class="line">    <span class="string">'.bot'</span>: <span class="string">'application/x-bot'</span>,</span><br><span class="line">    <span class="string">'.c4t'</span>: <span class="string">'application/x-c4t'</span>,</span><br><span class="line">    <span class="string">'.c90'</span>: <span class="string">'application/x-c90'</span>,</span><br><span class="line">    <span class="string">'.cal'</span>: <span class="string">'application/x-cals'</span>,</span><br><span class="line">    <span class="string">'.cat'</span>: <span class="string">'application/vnd.ms-pki.seccat'</span>,</span><br><span class="line">    <span class="string">'.cdf'</span>: <span class="string">'application/x-netcdf'</span>,</span><br><span class="line">    <span class="string">'.cdr'</span>: <span class="string">'application/x-cdr'</span>,</span><br><span class="line">    <span class="string">'.cel'</span>: <span class="string">'application/x-cel'</span>,</span><br><span class="line">    <span class="string">'.cer'</span>: <span class="string">'application/x-x509-ca-cert'</span>,</span><br><span class="line">    <span class="string">'.cg4'</span>: <span class="string">'application/x-g4'</span>,</span><br><span class="line">    <span class="string">'.cgm'</span>: <span class="string">'application/x-cgm'</span>,</span><br><span class="line">    <span class="string">'.cit'</span>: <span class="string">'application/x-cit'</span>,</span><br><span class="line">    <span class="string">'.class'</span>: <span class="string">'java/*'</span>,</span><br><span class="line">    <span class="string">'.cml'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.cmp'</span>: <span class="string">'application/x-cmp'</span>,</span><br><span class="line">    <span class="string">'.cmx'</span>: <span class="string">'application/x-cmx'</span>,</span><br><span class="line">    <span class="string">'.cot'</span>: <span class="string">'application/x-cot'</span>,</span><br><span class="line">    <span class="string">'.crl'</span>: <span class="string">'application/pkix-crl'</span>,</span><br><span class="line">    <span class="string">'.crt'</span>: <span class="string">'application/x-x509-ca-cert'</span>,</span><br><span class="line">    <span class="string">'.csi'</span>: <span class="string">'application/x-csi'</span>,</span><br><span class="line">    <span class="string">'.css'</span>: <span class="string">'text/css'</span>,</span><br><span class="line">    <span class="string">'.cut'</span>: <span class="string">'application/x-cut'</span>,</span><br><span class="line">    <span class="string">'.dbf'</span>: <span class="string">'application/x-dbf'</span>,</span><br><span class="line">    <span class="string">'.dbm'</span>: <span class="string">'application/x-dbm'</span>,</span><br><span class="line">    <span class="string">'.dbx'</span>: <span class="string">'application/x-dbx'</span>,</span><br><span class="line">    <span class="string">'.dcd'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.dcx'</span>: <span class="string">'application/x-dcx'</span>,</span><br><span class="line">    <span class="string">'.der'</span>: <span class="string">'application/x-x509-ca-cert'</span>,</span><br><span class="line">    <span class="string">'.dgn'</span>: <span class="string">'application/x-dgn'</span>,</span><br><span class="line">    <span class="string">'.dib'</span>: <span class="string">'application/x-dib'</span>,</span><br><span class="line">    <span class="string">'.dll'</span>: <span class="string">'application/x-msdownload'</span>,</span><br><span class="line">    <span class="string">'.doc'</span>: <span class="string">'application/msword'</span>,</span><br><span class="line">    <span class="string">'.dot'</span>: <span class="string">'application/msword'</span>,</span><br><span class="line">    <span class="string">'.drw'</span>: <span class="string">'application/x-drw'</span>,</span><br><span class="line">    <span class="string">'.dtd'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.dwf'</span>: <span class="string">'application/x-dwf'</span>,</span><br><span class="line">    <span class="string">'.dwg'</span>: <span class="string">'application/x-dwg'</span>,</span><br><span class="line">    <span class="string">'.dxb'</span>: <span class="string">'application/x-dxb'</span>,</span><br><span class="line">    <span class="string">'.dxf'</span>: <span class="string">'application/x-dxf'</span>,</span><br><span class="line">    <span class="string">'.edn'</span>: <span class="string">'application/vnd.adobe.edn'</span>,</span><br><span class="line">    <span class="string">'.emf'</span>: <span class="string">'application/x-emf'</span>,</span><br><span class="line">    <span class="string">'.eml'</span>: <span class="string">'message/rfc822'</span>,</span><br><span class="line">    <span class="string">'.ent'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.epi'</span>: <span class="string">'application/x-epi'</span>,</span><br><span class="line">    <span class="string">'.eps'</span>: <span class="string">'application/postscript'</span>,</span><br><span class="line">    <span class="string">'.etd'</span>: <span class="string">'application/x-ebx'</span>,</span><br><span class="line">    <span class="string">'.exe'</span>: <span class="string">'application/x-msdownload'</span>,</span><br><span class="line">    <span class="string">'.fax'</span>: <span class="string">'image/fax'</span>,</span><br><span class="line">    <span class="string">'.fdf'</span>: <span class="string">'application/vnd.fdf'</span>,</span><br><span class="line">    <span class="string">'.fif'</span>: <span class="string">'application/fractals'</span>,</span><br><span class="line">    <span class="string">'.fo'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.frm'</span>: <span class="string">'application/x-frm'</span>,</span><br><span class="line">    <span class="string">'.g4'</span>: <span class="string">'application/x-g4'</span>,</span><br><span class="line">    <span class="string">'.gbr'</span>: <span class="string">'application/x-gbr'</span>,</span><br><span class="line">    <span class="string">'.'</span>: <span class="string">'application/x-'</span>,</span><br><span class="line">    <span class="string">'.gif'</span>: <span class="string">'image/gif'</span>,</span><br><span class="line">    <span class="string">'.gl2'</span>: <span class="string">'application/x-gl2'</span>,</span><br><span class="line">    <span class="string">'.gp4'</span>: <span class="string">'application/x-gp4'</span>,</span><br><span class="line">    <span class="string">'.hgl'</span>: <span class="string">'application/x-hgl'</span>,</span><br><span class="line">    <span class="string">'.hmr'</span>: <span class="string">'application/x-hmr'</span>,</span><br><span class="line">    <span class="string">'.hpg'</span>: <span class="string">'application/x-hpgl'</span>,</span><br><span class="line">    <span class="string">'.hpl'</span>: <span class="string">'application/x-hpl'</span>,</span><br><span class="line">    <span class="string">'.hqx'</span>: <span class="string">'application/mac-binhex40'</span>,</span><br><span class="line">    <span class="string">'.hrf'</span>: <span class="string">'application/x-hrf'</span>,</span><br><span class="line">    <span class="string">'.hta'</span>: <span class="string">'application/hta'</span>,</span><br><span class="line">    <span class="string">'.htc'</span>: <span class="string">'text/x-component'</span>,</span><br><span class="line">    <span class="string">'.htm'</span>: <span class="string">'text/html'</span>,</span><br><span class="line">    <span class="string">'.html'</span>: <span class="string">'text/html'</span>,</span><br><span class="line">    <span class="string">'.htt'</span>: <span class="string">'text/webviewhtml'</span>,</span><br><span class="line">    <span class="string">'.htx'</span>: <span class="string">'text/html'</span>,</span><br><span class="line">    <span class="string">'.icb'</span>: <span class="string">'application/x-icb'</span>,</span><br><span class="line">    <span class="string">'.ico'</span>: <span class="string">'application/x-ico'</span>,</span><br><span class="line">    <span class="string">'.iff'</span>: <span class="string">'application/x-iff'</span>,</span><br><span class="line">    <span class="string">'.ig4'</span>: <span class="string">'application/x-g4'</span>,</span><br><span class="line">    <span class="string">'.igs'</span>: <span class="string">'application/x-igs'</span>,</span><br><span class="line">    <span class="string">'.iii'</span>: <span class="string">'application/x-iphone'</span>,</span><br><span class="line">    <span class="string">'.img'</span>: <span class="string">'application/x-img'</span>,</span><br><span class="line">    <span class="string">'.ins'</span>: <span class="string">'application/x-internet-signup'</span>,</span><br><span class="line">    <span class="string">'.isp'</span>: <span class="string">'application/x-internet-signup'</span>,</span><br><span class="line">    <span class="string">'.IVF'</span>: <span class="string">'video/x-ivf'</span>,</span><br><span class="line">    <span class="string">'.java'</span>: <span class="string">'java/*'</span>,</span><br><span class="line">    <span class="string">'.jfif'</span>: <span class="string">'image/jpeg'</span>,</span><br><span class="line">    <span class="string">'.jpe'</span>: <span class="string">'application/x-jpe'</span>,</span><br><span class="line">    <span class="string">'.jpeg'</span>: <span class="string">'image/jpeg'</span>,</span><br><span class="line">    <span class="string">'.jpg'</span>: <span class="string">'application/x-jpg'</span>,</span><br><span class="line">    <span class="string">'.js'</span>: <span class="string">'application/x-javascript'</span>,</span><br><span class="line">    <span class="string">'.jsp'</span>: <span class="string">'text/html'</span>,</span><br><span class="line">    <span class="string">'.la1'</span>: <span class="string">'audio/x-liquid-file'</span>,</span><br><span class="line">    <span class="string">'.lar'</span>: <span class="string">'application/x-laplayer-reg'</span>,</span><br><span class="line">    <span class="string">'.latex'</span>: <span class="string">'application/x-latex'</span>,</span><br><span class="line">    <span class="string">'.lavs'</span>: <span class="string">'audio/x-liquid-secure'</span>,</span><br><span class="line">    <span class="string">'.lbm'</span>: <span class="string">'application/x-lbm'</span>,</span><br><span class="line">    <span class="string">'.lmsff'</span>: <span class="string">'audio/x-la-lms'</span>,</span><br><span class="line">    <span class="string">'.ls'</span>: <span class="string">'application/x-javascript'</span>,</span><br><span class="line">    <span class="string">'.ltr'</span>: <span class="string">'application/x-ltr'</span>,</span><br><span class="line">    <span class="string">'.m1v'</span>: <span class="string">'video/x-mpeg'</span>,</span><br><span class="line">    <span class="string">'.m2v'</span>: <span class="string">'video/x-mpeg'</span>,</span><br><span class="line">    <span class="string">'.m3u'</span>: <span class="string">'audio/mpegurl'</span>,</span><br><span class="line">    <span class="string">'.m4e'</span>: <span class="string">'video/mpeg4'</span>,</span><br><span class="line">    <span class="string">'.mac'</span>: <span class="string">'application/x-mac'</span>,</span><br><span class="line">    <span class="string">'.man'</span>: <span class="string">'application/x-troff-man'</span>,</span><br><span class="line">    <span class="string">'.math'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.mdb'</span>: <span class="string">'application/x-mdb'</span>,</span><br><span class="line">    <span class="string">'.mfp'</span>: <span class="string">'application/x-shockwave-flash'</span>,</span><br><span class="line">    <span class="string">'.mht'</span>: <span class="string">'message/rfc822'</span>,</span><br><span class="line">    <span class="string">'.mhtml'</span>: <span class="string">'message/rfc822'</span>,</span><br><span class="line">    <span class="string">'.mi'</span>: <span class="string">'application/x-mi'</span>,</span><br><span class="line">    <span class="string">'.mid'</span>: <span class="string">'audio/mid'</span>,</span><br><span class="line">    <span class="string">'.midi'</span>: <span class="string">'audio/mid'</span>,</span><br><span class="line">    <span class="string">'.mil'</span>: <span class="string">'application/x-mil'</span>,</span><br><span class="line">    <span class="string">'.mml'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.mnd'</span>: <span class="string">'audio/x-musicnet-download'</span>,</span><br><span class="line">    <span class="string">'.mns'</span>: <span class="string">'audio/x-musicnet-stream'</span>,</span><br><span class="line">    <span class="string">'.mocha'</span>: <span class="string">'application/x-javascript'</span>,</span><br><span class="line">    <span class="string">'.movie'</span>: <span class="string">'video/x-sgi-movie'</span>,</span><br><span class="line">    <span class="string">'.mp1'</span>: <span class="string">'audio/mp1'</span>,</span><br><span class="line">    <span class="string">'.mp2'</span>: <span class="string">'audio/mp2'</span>,</span><br><span class="line">    <span class="string">'.mp2v'</span>: <span class="string">'video/mpeg'</span>,</span><br><span class="line">    <span class="string">'.mp3'</span>: <span class="string">'audio/mp3'</span>,</span><br><span class="line">    <span class="string">'.mp4'</span>: <span class="string">'video/mpeg4'</span>,</span><br><span class="line">    <span class="string">'.mpa'</span>: <span class="string">'video/x-mpg'</span>,</span><br><span class="line">    <span class="string">'.mpd'</span>: <span class="string">'application/vnd.ms-project'</span>,</span><br><span class="line">    <span class="string">'.mpe'</span>: <span class="string">'video/x-mpeg'</span>,</span><br><span class="line">    <span class="string">'.mpeg'</span>: <span class="string">'video/mpg'</span>,</span><br><span class="line">    <span class="string">'.mpg'</span>: <span class="string">'video/mpg'</span>,</span><br><span class="line">    <span class="string">'.mpga'</span>: <span class="string">'audio/rn-mpeg'</span>,</span><br><span class="line">    <span class="string">'.mpp'</span>: <span class="string">'application/vnd.ms-project'</span>,</span><br><span class="line">    <span class="string">'.mps'</span>: <span class="string">'video/x-mpeg'</span>,</span><br><span class="line">    <span class="string">'.mpt'</span>: <span class="string">'application/vnd.ms-project'</span>,</span><br><span class="line">    <span class="string">'.mpv'</span>: <span class="string">'video/mpg'</span>,</span><br><span class="line">    <span class="string">'.mpv2'</span>: <span class="string">'video/mpeg'</span>,</span><br><span class="line">    <span class="string">'.mpw'</span>: <span class="string">'application/vnd.ms-project'</span>,</span><br><span class="line">    <span class="string">'.mpx'</span>: <span class="string">'application/vnd.ms-project'</span>,</span><br><span class="line">    <span class="string">'.mtx'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.mxp'</span>: <span class="string">'application/x-mmxp'</span>,</span><br><span class="line">    <span class="string">'.net'</span>: <span class="string">'image/pnetvue'</span>,</span><br><span class="line">    <span class="string">'.nrf'</span>: <span class="string">'application/x-nrf'</span>,</span><br><span class="line">    <span class="string">'.nws'</span>: <span class="string">'message/rfc822'</span>,</span><br><span class="line">    <span class="string">'.odc'</span>: <span class="string">'text/x-ms-odc'</span>,</span><br><span class="line">    <span class="string">'.out'</span>: <span class="string">'application/x-out'</span>,</span><br><span class="line">    <span class="string">'.p10'</span>: <span class="string">'application/pkcs10'</span>,</span><br><span class="line">    <span class="string">'.p12'</span>: <span class="string">'application/x-pkcs12'</span>,</span><br><span class="line">    <span class="string">'.p7b'</span>: <span class="string">'application/x-pkcs7-certificates'</span>,</span><br><span class="line">    <span class="string">'.p7c'</span>: <span class="string">'application/pkcs7-mime'</span>,</span><br><span class="line">    <span class="string">'.p7m'</span>: <span class="string">'application/pkcs7-mime'</span>,</span><br><span class="line">    <span class="string">'.p7r'</span>: <span class="string">'application/x-pkcs7-certreqresp'</span>,</span><br><span class="line">    <span class="string">'.p7s'</span>: <span class="string">'application/pkcs7-signature'</span>,</span><br><span class="line">    <span class="string">'.pc5'</span>: <span class="string">'application/x-pc5'</span>,</span><br><span class="line">    <span class="string">'.pci'</span>: <span class="string">'application/x-pci'</span>,</span><br><span class="line">    <span class="string">'.pcl'</span>: <span class="string">'application/x-pcl'</span>,</span><br><span class="line">    <span class="string">'.pcx'</span>: <span class="string">'application/x-pcx'</span>,</span><br><span class="line">    <span class="string">'.pdf'</span>: <span class="string">'application/pdf'</span>,</span><br><span class="line">    <span class="string">'.pdx'</span>: <span class="string">'application/vnd.adobe.pdx'</span>,</span><br><span class="line">    <span class="string">'.pfx'</span>: <span class="string">'application/x-pkcs12'</span>,</span><br><span class="line">    <span class="string">'.pgl'</span>: <span class="string">'application/x-pgl'</span>,</span><br><span class="line">    <span class="string">'.pic'</span>: <span class="string">'application/x-pic'</span>,</span><br><span class="line">    <span class="string">'.pko'</span>: <span class="string">'application/vnd.ms-pki.pko'</span>,</span><br><span class="line">    <span class="string">'.pl'</span>: <span class="string">'application/x-perl'</span>,</span><br><span class="line">    <span class="string">'.plg'</span>: <span class="string">'text/html'</span>,</span><br><span class="line">    <span class="string">'.pls'</span>: <span class="string">'audio/scpls'</span>,</span><br><span class="line">    <span class="string">'.plt'</span>: <span class="string">'application/x-plt'</span>,</span><br><span class="line">    <span class="string">'.png'</span>: <span class="string">'application/x-png'</span>,</span><br><span class="line">    <span class="string">'.pot'</span>: <span class="string">'application/vnd.ms-powerpoint'</span>,</span><br><span class="line">    <span class="string">'.ppa'</span>: <span class="string">'application/vnd.ms-powerpoint'</span>,</span><br><span class="line">    <span class="string">'.ppm'</span>: <span class="string">'application/x-ppm'</span>,</span><br><span class="line">    <span class="string">'.pps'</span>: <span class="string">'application/vnd.ms-powerpoint'</span>,</span><br><span class="line">    <span class="string">'.ppt'</span>: <span class="string">'application/x-ppt'</span>,</span><br><span class="line">    <span class="string">'.pr'</span>: <span class="string">'application/x-pr'</span>,</span><br><span class="line">    <span class="string">'.prf'</span>: <span class="string">'application/pics-rules'</span>,</span><br><span class="line">    <span class="string">'.prn'</span>: <span class="string">'application/x-prn'</span>,</span><br><span class="line">    <span class="string">'.prt'</span>: <span class="string">'application/x-prt'</span>,</span><br><span class="line">    <span class="string">'.ps'</span>: <span class="string">'application/postscript'</span>,</span><br><span class="line">    <span class="string">'.ptn'</span>: <span class="string">'application/x-ptn'</span>,</span><br><span class="line">    <span class="string">'.pwz'</span>: <span class="string">'application/vnd.ms-powerpoint'</span>,</span><br><span class="line">    <span class="string">'.r3t'</span>: <span class="string">'text/vnd.rn-realtext3d'</span>,</span><br><span class="line">    <span class="string">'.ra'</span>: <span class="string">'audio/vnd.rn-realaudio'</span>,</span><br><span class="line">    <span class="string">'.ram'</span>: <span class="string">'audio/x-pn-realaudio'</span>,</span><br><span class="line">    <span class="string">'.ras'</span>: <span class="string">'application/x-ras'</span>,</span><br><span class="line">    <span class="string">'.rat'</span>: <span class="string">'application/rat-file'</span>,</span><br><span class="line">    <span class="string">'.rdf'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.rec'</span>: <span class="string">'application/vnd.rn-recording'</span>,</span><br><span class="line">    <span class="string">'.red'</span>: <span class="string">'application/x-red'</span>,</span><br><span class="line">    <span class="string">'.rgb'</span>: <span class="string">'application/x-rgb'</span>,</span><br><span class="line">    <span class="string">'.rjs'</span>: <span class="string">'application/vnd.rn-realsystem-rjs'</span>,</span><br><span class="line">    <span class="string">'.rjt'</span>: <span class="string">'application/vnd.rn-realsystem-rjt'</span>,</span><br><span class="line">    <span class="string">'.rlc'</span>: <span class="string">'application/x-rlc'</span>,</span><br><span class="line">    <span class="string">'.rle'</span>: <span class="string">'application/x-rle'</span>,</span><br><span class="line">    <span class="string">'.rm'</span>: <span class="string">'application/vnd.rn-realmedia'</span>,</span><br><span class="line">    <span class="string">'.rmf'</span>: <span class="string">'application/vnd.adobe.rmf'</span>,</span><br><span class="line">    <span class="string">'.rmi'</span>: <span class="string">'audio/mid'</span>,</span><br><span class="line">    <span class="string">'.rmj'</span>: <span class="string">'application/vnd.rn-realsystem-rmj'</span>,</span><br><span class="line">    <span class="string">'.rmm'</span>: <span class="string">'audio/x-pn-realaudio'</span>,</span><br><span class="line">    <span class="string">'.rmp'</span>: <span class="string">'application/vnd.rn-rn_music_package'</span>,</span><br><span class="line">    <span class="string">'.rms'</span>: <span class="string">'application/vnd.rn-realmedia-secure'</span>,</span><br><span class="line">    <span class="string">'.rmvb'</span>: <span class="string">'application/vnd.rn-realmedia-vbr'</span>,</span><br><span class="line">    <span class="string">'.rmx'</span>: <span class="string">'application/vnd.rn-realsystem-rmx'</span>,</span><br><span class="line">    <span class="string">'.rnx'</span>: <span class="string">'application/vnd.rn-realplayer'</span>,</span><br><span class="line">    <span class="string">'.rp'</span>: <span class="string">'image/vnd.rn-realpix'</span>,</span><br><span class="line">    <span class="string">'.rpm'</span>: <span class="string">'audio/x-pn-realaudio-plugin'</span>,</span><br><span class="line">    <span class="string">'.rsml'</span>: <span class="string">'application/vnd.rn-rsml'</span>,</span><br><span class="line">    <span class="string">'.rt'</span>: <span class="string">'text/vnd.rn-realtext'</span>,</span><br><span class="line">    <span class="string">'.rtf'</span>: <span class="string">'application/x-rtf'</span>,</span><br><span class="line">    <span class="string">'.rv'</span>: <span class="string">'video/vnd.rn-realvideo'</span>,</span><br><span class="line">    <span class="string">'.sam'</span>: <span class="string">'application/x-sam'</span>,</span><br><span class="line">    <span class="string">'.sat'</span>: <span class="string">'application/x-sat'</span>,</span><br><span class="line">    <span class="string">'.sdp'</span>: <span class="string">'application/sdp'</span>,</span><br><span class="line">    <span class="string">'.sdw'</span>: <span class="string">'application/x-sdw'</span>,</span><br><span class="line">    <span class="string">'.sit'</span>: <span class="string">'application/x-stuffit'</span>,</span><br><span class="line">    <span class="string">'.slb'</span>: <span class="string">'application/x-slb'</span>,</span><br><span class="line">    <span class="string">'.sld'</span>: <span class="string">'application/x-sld'</span>,</span><br><span class="line">    <span class="string">'.slk'</span>: <span class="string">'drawing/x-slk'</span>,</span><br><span class="line">    <span class="string">'.smi'</span>: <span class="string">'application/smil'</span>,</span><br><span class="line">    <span class="string">'.smil'</span>: <span class="string">'application/smil'</span>,</span><br><span class="line">    <span class="string">'.smk'</span>: <span class="string">'application/x-smk'</span>,</span><br><span class="line">    <span class="string">'.snd'</span>: <span class="string">'audio/basic'</span>,</span><br><span class="line">    <span class="string">'.sol'</span>: <span class="string">'text/plain'</span>,</span><br><span class="line">    <span class="string">'.sor'</span>: <span class="string">'text/plain'</span>,</span><br><span class="line">    <span class="string">'.spc'</span>: <span class="string">'application/x-pkcs7-certificates'</span>,</span><br><span class="line">    <span class="string">'.spl'</span>: <span class="string">'application/futuresplash'</span>,</span><br><span class="line">    <span class="string">'.spp'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.ssm'</span>: <span class="string">'application/streamingmedia'</span>,</span><br><span class="line">    <span class="string">'.sst'</span>: <span class="string">'application/vnd.ms-pki.certstore'</span>,</span><br><span class="line">    <span class="string">'.stl'</span>: <span class="string">'application/vnd.ms-pki.stl'</span>,</span><br><span class="line">    <span class="string">'.stm'</span>: <span class="string">'text/html'</span>,</span><br><span class="line">    <span class="string">'.sty'</span>: <span class="string">'application/x-sty'</span>,</span><br><span class="line">    <span class="string">'.svg'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.swf'</span>: <span class="string">'application/x-shockwave-flash'</span>,</span><br><span class="line">    <span class="string">'.tdf'</span>: <span class="string">'application/x-tdf'</span>,</span><br><span class="line">    <span class="string">'.tg4'</span>: <span class="string">'application/x-tg4'</span>,</span><br><span class="line">    <span class="string">'.tga'</span>: <span class="string">'application/x-tga'</span>,</span><br><span class="line">    <span class="string">'.tiff'</span>: <span class="string">'image/tiff'</span>,</span><br><span class="line">    <span class="string">'.tld'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.top'</span>: <span class="string">'drawing/x-top'</span>,</span><br><span class="line">    <span class="string">'.torrent'</span>: <span class="string">'application/x-bittorrent'</span>,</span><br><span class="line">    <span class="string">'.tsd'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.txt'</span>: <span class="string">'text/plain'</span>,</span><br><span class="line">    <span class="string">'.uin'</span>: <span class="string">'application/x-icq'</span>,</span><br><span class="line">    <span class="string">'.uls'</span>: <span class="string">'text/iuls'</span>,</span><br><span class="line">    <span class="string">'.vcf'</span>: <span class="string">'text/x-vcard'</span>,</span><br><span class="line">    <span class="string">'.vda'</span>: <span class="string">'application/x-vda'</span>,</span><br><span class="line">    <span class="string">'.vdx'</span>: <span class="string">'application/vnd.visio'</span>,</span><br><span class="line">    <span class="string">'.vml'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.vpg'</span>: <span class="string">'application/x-vpeg005'</span>,</span><br><span class="line">    <span class="string">'.vsd'</span>: <span class="string">'application/x-vsd'</span>,</span><br><span class="line">    <span class="string">'.vss'</span>: <span class="string">'application/vnd.visio'</span>,</span><br><span class="line">    <span class="string">'.vst'</span>: <span class="string">'application/x-vst'</span>,</span><br><span class="line">    <span class="string">'.vsw'</span>: <span class="string">'application/vnd.visio'</span>,</span><br><span class="line">    <span class="string">'.vsx'</span>: <span class="string">'application/vnd.visio'</span>,</span><br><span class="line">    <span class="string">'.vtx'</span>: <span class="string">'application/vnd.visio'</span>,</span><br><span class="line">    <span class="string">'.vxml'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.wav'</span>: <span class="string">'audio/wav'</span>,</span><br><span class="line">    <span class="string">'.wax'</span>: <span class="string">'audio/x-ms-wax'</span>,</span><br><span class="line">    <span class="string">'.wb1'</span>: <span class="string">'application/x-wb1'</span>,</span><br><span class="line">    <span class="string">'.wb2'</span>: <span class="string">'application/x-wb2'</span>,</span><br><span class="line">    <span class="string">'.wb3'</span>: <span class="string">'application/x-wb3'</span>,</span><br><span class="line">    <span class="string">'.wbmp'</span>: <span class="string">'image/vnd.wap.wbmp'</span>,</span><br><span class="line">    <span class="string">'.wiz'</span>: <span class="string">'application/msword'</span>,</span><br><span class="line">    <span class="string">'.wk3'</span>: <span class="string">'application/x-wk3'</span>,</span><br><span class="line">    <span class="string">'.wk4'</span>: <span class="string">'application/x-wk4'</span>,</span><br><span class="line">    <span class="string">'.wkq'</span>: <span class="string">'application/x-wkq'</span>,</span><br><span class="line">    <span class="string">'.wks'</span>: <span class="string">'application/x-wks'</span>,</span><br><span class="line">    <span class="string">'.wm'</span>: <span class="string">'video/x-ms-wm'</span>,</span><br><span class="line">    <span class="string">'.wma'</span>: <span class="string">'audio/x-ms-wma'</span>,</span><br><span class="line">    <span class="string">'.wmd'</span>: <span class="string">'application/x-ms-wmd'</span>,</span><br><span class="line">    <span class="string">'.wmf'</span>: <span class="string">'application/x-wmf'</span>,</span><br><span class="line">    <span class="string">'.wml'</span>: <span class="string">'text/vnd.wap.wml'</span>,</span><br><span class="line">    <span class="string">'.wmv'</span>: <span class="string">'video/x-ms-wmv'</span>,</span><br><span class="line">    <span class="string">'.wmx'</span>: <span class="string">'video/x-ms-wmx'</span>,</span><br><span class="line">    <span class="string">'.wmz'</span>: <span class="string">'application/x-ms-wmz'</span>,</span><br><span class="line">    <span class="string">'.wp6'</span>: <span class="string">'application/x-wp6'</span>,</span><br><span class="line">    <span class="string">'.wpd'</span>: <span class="string">'application/x-wpd'</span>,</span><br><span class="line">    <span class="string">'.wpg'</span>: <span class="string">'application/x-wpg'</span>,</span><br><span class="line">    <span class="string">'.wpl'</span>: <span class="string">'application/vnd.ms-wpl'</span>,</span><br><span class="line">    <span class="string">'.wq1'</span>: <span class="string">'application/x-wq1'</span>,</span><br><span class="line">    <span class="string">'.wr1'</span>: <span class="string">'application/x-wr1'</span>,</span><br><span class="line">    <span class="string">'.wri'</span>: <span class="string">'application/x-wri'</span>,</span><br><span class="line">    <span class="string">'.wrk'</span>: <span class="string">'application/x-wrk'</span>,</span><br><span class="line">    <span class="string">'.ws'</span>: <span class="string">'application/x-ws'</span>,</span><br><span class="line">    <span class="string">'.ws2'</span>: <span class="string">'application/x-ws'</span>,</span><br><span class="line">    <span class="string">'.wsc'</span>: <span class="string">'text/scriptlet'</span>,</span><br><span class="line">    <span class="string">'.wsdl'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.wvx'</span>: <span class="string">'video/x-ms-wvx'</span>,</span><br><span class="line">    <span class="string">'.xdp'</span>: <span class="string">'application/vnd.adobe.xdp'</span>,</span><br><span class="line">    <span class="string">'.xdr'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.xfd'</span>: <span class="string">'application/vnd.adobe.xfd'</span>,</span><br><span class="line">    <span class="string">'.xfdf'</span>: <span class="string">'application/vnd.adobe.xfdf'</span>,</span><br><span class="line">    <span class="string">'.xhtml'</span>: <span class="string">'text/html'</span>,</span><br><span class="line">    <span class="string">'.xls'</span>: <span class="string">'application/x-xls'</span>,</span><br><span class="line">    <span class="string">'.xlw'</span>: <span class="string">'application/x-xlw'</span>,</span><br><span class="line">    <span class="string">'.xml'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.xpl'</span>: <span class="string">'audio/scpls'</span>,</span><br><span class="line">    <span class="string">'.xq'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.xql'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.xquery'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.xsd'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.xsl'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.xslt'</span>: <span class="string">'text/xml'</span>,</span><br><span class="line">    <span class="string">'.xwd'</span>: <span class="string">'application/x-xwd'</span>,</span><br><span class="line">    <span class="string">'.x_b'</span>: <span class="string">'application/x-x_b'</span>,</span><br><span class="line">    <span class="string">'.sis'</span>: <span class="string">'application/vnd.symbian.install'</span>,</span><br><span class="line">    <span class="string">'.sisx'</span>: <span class="string">'application/vnd.symbian.install'</span>,</span><br><span class="line">    <span class="string">'.x_t'</span>: <span class="string">'application/x-x_t'</span>,</span><br><span class="line">    <span class="string">'.ipa'</span>: <span class="string">'application/vnd.iphone'</span>,</span><br><span class="line">    <span class="string">'.apk'</span>: <span class="string">'application/vnd.android.package-archive'</span>,</span><br><span class="line">    <span class="string">'.xap'</span>: <span class="string">'application/x-silverlight-app'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="刘硕"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">刘硕</p>
  <div class="site-description" itemprop="description">不成为自己讨厌的人</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">221</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:liushuo432@outlook.com" title="E-Mail → mailto:liushuo432@outlook.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/2436055290" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;2436055290" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">辽ICP备20001451号 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘硕</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.2" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  
<script src="//cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
<script src="//cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script>
<script src="/js/algolia-search.js"></script>














  

  

  

  <script type="text/javascript" src="/js/love.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/Epsilon2.1.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"left","hOffset":-30,"vOffset":-40},"mobile":{"show":false,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false,"tagMode":false});</script></body>
</html>
